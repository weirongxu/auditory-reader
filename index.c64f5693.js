(()=>{"use strict";var e={9237:function(e,t,n){n.d(t,{P:function(){return S},n:function(){return m}});var i=n(2790),a=n(3747),r=n(1479),o=n(3062),s=n(4210),l=n.n(s),c=n(6513),d=n.n(c),u=n(6092),h=n(9883),p=n(891),f=n(2359);function*g(e,t,n){let[i,...a]=t;if(!i){if(n)for(let t of e.querySelectorAll(n))yield t;else yield e;return}for(let t of e.children)("*"===i||t.tagName.toLowerCase()===i.toLowerCase())&&(yield*g(t,a,n))}let m='nav[epub\\:type="toc"]';var v=new WeakMap,y=new WeakMap,x=new WeakMap,w=new WeakMap,k=new WeakMap,b=new WeakMap,j=new WeakMap,C=new WeakMap;class S extends f.L{static async getRootPath(e){var t;let n=await e.htmlDom("META-INF/container.xml");if(!n){console.error("Parse META-INF/container.xml error");return}let i=null===(t=n.querySelector("rootfile"))||void 0===t?void 0:t.getAttribute("full-path");if(!i){console.error("rootfile full-path not found");return}return d().join("/",i)}static async read(e){let t=await l().loadAsync(e),n=new p.H(t),i=await this.getRootPath(n);if(!i){console.error(`epub root-path(${i}) not found`);return}let a=await n.xmlDom(i);if(!a){console.error("epub root document not found");return}return new S(t,n,a,d().dirname(i))}get version(){if(!(0,i._)(this,v)){let e=this.rootPkg.getAttribute("version")??"2.0";(0,r._)(this,v,parseFloat(e)>=3?3:2)}return(0,i._)(this,v)}get title(){if(!(0,i._)(this,y)){var e,t;let n=null===(e=this.rootPkg.findDescendant("metadata"))||void 0===e?void 0:e.findDescendant("dc:title");(0,r._)(this,y,(null==n?void 0:null===(t=n.text())||void 0===t?void 0:t.trim())??null)}return(0,i._)(this,y)}get language(){if(!(0,i._)(this,x)){var e,t;let n=null===(e=this.rootPkg.findDescendant("metadata"))||void 0===e?void 0:e.findDescendant("dc:language");(0,r._)(this,x,(null==n?void 0:null===(t=n.text())||void 0===t?void 0:t.trim())??null)}return(0,i._)(this,x)}get manifestItems(){if(!(0,i._)(this,w)){var e;let t=(null===(e=this.rootPkg.findDescendant("manifest"))||void 0===e?void 0:e.childrenFilter("item"))??[];(0,r._)(this,w,t.map(e=>({id:e.getAttribute("id"),href:d().join(this.rootDir,e.getAttribute("href")),mediaType:e.getAttribute("media-type"),properties:e.getAttribute("properties")??void 0})))}return(0,i._)(this,w)}get spine(){if(!(0,i._)(this,k)&&((0,r._)(this,k,this.rootPkg.findDescendant("spine")??void 0),!(0,i._)(this,k)))throw Error("spine not found");return(0,i._)(this,k)}get spineItems(){return!(0,i._)(this,b)&&(0,r._)(this,b,(0,u.oA)([...this.spine.childrenFilter("itemref")].map(e=>{let t=e.getAttribute("idref"),n=this.manifestItems.find(e=>e.id===t);if(n)return{manifest:n,idref:t,linear:e.getAttribute("linear")}}))),(0,i._)(this,b)}get spines(){return!(0,i._)(this,j)&&(0,r._)(this,j,this.spineItems.map(e=>({href:e.manifest.href,id:e.idref}))),(0,i._)(this,j)}async file(e){let t=await this.xmlLoader.file(e);if(!t)return;let n=await t.arrayBuffer(),i=(0,h.ym)(n),a=e.startsWith("/")?e:`/${e}`,r=this.manifestItems.find(e=>e.href==a);return{buffer:i,mediaType:null==r?void 0:r.mediaType}}async cover(){var e;let t=null===(e=this.rootPkg.findDescendant("metadata"))||void 0===e?void 0:e.findDescendants("meta").find(e=>"cover"===e.getAttribute("name"));if(!t)return;let n=t.getAttribute("content");if(!n)return;let i=this.manifestItems.find(e=>e.id===n);if(!(null==i?void 0:i.href))return;let a=await this.xmlLoader.file(i.href);if(!!a)return{buffer:(0,h.ym)(await a.arrayBuffer()),mediaType:i.mediaType}}async content(e){return this.xmlLoader.content(e)}async xmlDom(e){return this.xmlLoader.xmlDom(e)}async htmlDom(e){return this.xmlLoader.htmlDom(e)}dirBySpineIndex(e){let t=this.spineItems[e];if(t)return d().dirname(t.manifest.href)}getSpineIndexByHref(e){let t=this.spineItems.findIndex(t=>t.manifest.href===e);if(-1!==t)return t}async loadNav3(){let e=this.manifestItems.find(e=>"nav"===e.properties);if(!e)return this.loadNav2();let t=await this.htmlDom(e.href),n=d().dirname(e.href);if(!t)return[];let i=t.querySelector(`${m}>ol`);return i?this.parseNav3(i,n):[]}parseNav3(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,u.oA)(Array.from(g(e,["li"])).map(e=>{var i;let a,r,o,s;let l=Array.from(e.children).find(e=>"ol"!==e.tagName.toLowerCase());if(!l)return;let c=l.textContent??"";if("a"===l.tagName.toLowerCase()){let e=l.getAttribute("href");e&&(a=d().join(t,e),[r,o]=a.split("#",2),r&&(s=this.getSpineIndexByHref(r)))}let u=g(e,["ol"],void 0).next().value??null;return{level:n,label:c,href:a,hrefBase:r,hrefAnchor:o,spineIndex:s,children:u?this.parseNav3(u,t,n+1):[]}}))}async loadNav2(){let e=this.spine.getAttribute("toc")??"ncx",t=this.manifestItems.find(t=>t.id===e);if(!t)return[];let n=await this.xmlDom(t.href),i=d().dirname(t.href);if(!n)return[];let a=n.findDescendant("navMap");return a?this.parseNav2(a,i):[]}parseNav2(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,u.oA)(e.childrenFilter("navPoint").map(e=>{var i,a,r;let o,s,l,c;let u=null===(a=e.findChild("navLabel"))||void 0===a?void 0:null===(i=a.findChild("text"))||void 0===i?void 0:i.text();if(!u)return;let h=null===(r=e.findChild("content"))||void 0===r?void 0:r.getAttribute("src");return h&&(o=d().join(t,h),[s,l]=o.split("#",2),s&&(c=this.getSpineIndexByHref(s))),{level:n,label:u,href:o,hrefBase:s,hrefAnchor:l,spineIndex:c,children:this.parseNav2(e,t,n+1)}}))}async navs(){return!(0,i._)(this,C)&&(this.version>=3?(0,r._)(this,C,await this.loadNav3()):(0,r._)(this,C,await this.loadNav2())),(0,i._)(this,C)}constructor(e,t,n,i){super(),(0,o._)(this,"zip",void 0),(0,o._)(this,"xmlLoader",void 0),(0,o._)(this,"rootPkg",void 0),(0,o._)(this,"rootDir",void 0),(0,a._)(this,v,{writable:!0,value:void 0}),(0,a._)(this,y,{writable:!0,value:void 0}),(0,a._)(this,x,{writable:!0,value:void 0}),(0,a._)(this,w,{writable:!0,value:void 0}),(0,a._)(this,k,{writable:!0,value:void 0}),(0,a._)(this,b,{writable:!0,value:void 0}),(0,a._)(this,j,{writable:!0,value:void 0}),(0,a._)(this,C,{writable:!0,value:void 0}),this.zip=e,this.xmlLoader=t,this.rootPkg=n,this.rootDir=i}}},107:function(e,t,n){n.d(t,{A4:function(){return d},HQ:function(){return p},JK:function(){return h},TO:function(){return l},TX:function(){return r},Xp:function(){return a},b6:function(){return i},i9:function(){return f},is:function(){return c},jM:function(){return u},lc:function(){return o},n1:function(){return g},pJ:function(){return s}});let i="__para_box__",a="__para_ignore__",r="__para_active__",o="__para_annotation__",s="__root_annotation_highlight__",l="__root_keyword_highlight__",c="__root_utterer_highlight__",d="__img_max_width__",u="__img_max_height__",h="__color_scheme_dark__",p="__column_break__",f={妳:{word:"乃",pinyin:"naǐ"},她:{word:"伊",pinyin:"yī"},它:{word:"牠",pinyin:"tu\xf3"}},g="$tmp"},6340:function(e,t,n){n.d(t,{O:function(){return u}});var i=n(9296),a=n.n(i),r=n(6513),o=n.n(r),s=n(9835),l=n(6756);let c=s.jU?{}:JSON.parse(a().readFileSync("auditory-reader.config.json","utf8")),d=c.appPublicPath||"/auditory-reader/",u={isProduction:!0,appMode:"service-worker",appPort:c.appPort??4001,appBodyLimit:c.appBodyLimit??"20mb",appPublicRoot:d,appApiRoot:o().join(d,"api"),dataPath:"server-data",sessionKey:c.sessionKey||(0,l.O1)(40),accounts:c.accounts??[]}},3098:function(e,t,n){n.d(t,{Wx:function(){return s},sF:function(){return d}});var i=n(5271),a=n(6092);let r=[{code:"ab",name:"Abkhazian"},{code:"aa",name:"Afar"},{code:"af",name:"Afrikaans"},{code:"ak",name:"Akan"},{code:"sq",name:"Albanian"},{code:"am",name:"Amharic"},{code:"ar",name:"Arabic"},{code:"an",name:"Aragonese"},{code:"hy",name:"Armenian"},{code:"as",name:"Assamese"},{code:"av",name:"Avaric"},{code:"ae",name:"Avestan"},{code:"ay",name:"Aymara"},{code:"az",name:"Azerbaijani"},{code:"bm",name:"Bambara"},{code:"ba",name:"Bashkir"},{code:"eu",name:"Basque"},{code:"be",name:"Belarusian"},{code:"bn",name:"Bengali (Bangla)"},{code:"bh",name:"Bihari"},{code:"bi",name:"Bislama"},{code:"bs",name:"Bosnian"},{code:"br",name:"Breton"},{code:"bg",name:"Bulgarian"},{code:"my",name:"Burmese"},{code:"ca",name:"Catalan"},{code:"ch",name:"Chamorro"},{code:"ce",name:"Chechen"},{code:"ny",name:"Chichewa, Chewa, Nyanja"},{code:"zh",name:"Chinese"},{code:"cv",name:"Chuvash"},{code:"kw",name:"Cornish"},{code:"co",name:"Corsican"},{code:"cr",name:"Cree"},{code:"hr",name:"Croatian"},{code:"cs",name:"Czech"},{code:"da",name:"Danish"},{code:"dv",name:"Divehi, Dhivehi, Maldivian"},{code:"nl",name:"Dutch"},{code:"dz",name:"Dzongkha"},{code:"en",name:"English"},{code:"eo",name:"Esperanto"},{code:"et",name:"Estonian"},{code:"ee",name:"Ewe"},{code:"fo",name:"Faroese"},{code:"fj",name:"Fijian"},{code:"fi",name:"Finnish"},{code:"fr",name:"French"},{code:"ff",name:"Fula, Fulah, Pulaar, Pular"},{code:"gl",name:"Galician"},{code:"gd",name:"Gaelic (Scottish)"},{code:"gv",name:"Gaelic (Manx)"},{code:"ka",name:"Georgian"},{code:"de",name:"German"},{code:"el",name:"Greek"},{code:"kl",name:"Greenlandic"},{code:"gn",name:"Guarani"},{code:"gu",name:"Gujarati"},{code:"ht",name:"Haitian Creole"},{code:"ha",name:"Hausa"},{code:"he",name:"Hebrew"},{code:"hz",name:"Herero"},{code:"hi",name:"Hindi"},{code:"ho",name:"Hiri Motu"},{code:"hu",name:"Hungarian"},{code:"is",name:"Icelandic"},{code:"io",name:"Ido"},{code:"ig",name:"Igbo"},{code:"id, in",name:"Indonesian"},{code:"ia",name:"Interlingua"},{code:"ie",name:"Interlingue"},{code:"iu",name:"Inuktitut"},{code:"ik",name:"Inupiak"},{code:"ga",name:"Irish"},{code:"it",name:"Italian"},{code:"ja",name:"Japanese"},{code:"jv",name:"Javanese"},{code:"kl",name:"Kalaallisut, Greenlandic"},{code:"kn",name:"Kannada"},{code:"kr",name:"Kanuri"},{code:"ks",name:"Kashmiri"},{code:"kk",name:"Kazakh"},{code:"km",name:"Khmer"},{code:"ki",name:"Kikuyu"},{code:"rw",name:"Kinyarwanda (Rwanda)"},{code:"rn",name:"Kirundi"},{code:"ky",name:"Kyrgyz"},{code:"kv",name:"Komi"},{code:"kg",name:"Kongo"},{code:"ko",name:"Korean"},{code:"ku",name:"Kurdish"},{code:"kj",name:"Kwanyama"},{code:"lo",name:"Lao"},{code:"la",name:"Latin"},{code:"lv",name:"Latvian (Lettish)"},{code:"li",name:"Limburgish ( Limburger)"},{code:"ln",name:"Lingala"},{code:"lt",name:"Lithuanian"},{code:"lu",name:"Luga-Katanga"},{code:"lg",name:"Luganda, Ganda"},{code:"lb",name:"Luxembourgish"},{code:"gv",name:"Manx"},{code:"mk",name:"Macedonian"},{code:"mg",name:"Malagasy"},{code:"ms",name:"Malay"},{code:"ml",name:"Malayalam"},{code:"mt",name:"Maltese"},{code:"mi",name:"Maori"},{code:"mr",name:"Marathi"},{code:"mh",name:"Marshallese"},{code:"mo",name:"Moldavian"},{code:"mn",name:"Mongolian"},{code:"na",name:"Nauru"},{code:"nv",name:"Navajo"},{code:"ng",name:"Ndonga"},{code:"nd",name:"Northern Ndebele"},{code:"ne",name:"Nepali"},{code:"no",name:"Norwegian"},{code:"nb",name:"Norwegian bokm\xe5l"},{code:"nn",name:"Norwegian nynorsk"},{code:"ii",name:"Nuosu"},{code:"oc",name:"Occitan"},{code:"oj",name:"Ojibwe"},{code:"cu",name:"Old Church Slavonic, Old Bulgarian"},{code:"or",name:"Oriya"},{code:"om",name:"Oromo (Afaan Oromo)"},{code:"os",name:"Ossetian"},{code:"pi",name:"Pāli"},{code:"ps",name:"Pashto, Pushto"},{code:"fa",name:"Persian (Farsi)"},{code:"pl",name:"Polish"},{code:"pt",name:"Portuguese"},{code:"pa",name:"Punjabi (Eastern)"},{code:"qu",name:"Quechua"},{code:"rm",name:"Romansh"},{code:"ro",name:"Romanian"},{code:"ru",name:"Russian"},{code:"se",name:"Sami"},{code:"sm",name:"Samoan"},{code:"sg",name:"Sango"},{code:"sa",name:"Sanskrit"},{code:"sr",name:"Serbian"},{code:"sh",name:"Serbo-Croatian"},{code:"st",name:"Sesotho"},{code:"tn",name:"Setswana"},{code:"sn",name:"Shona"},{code:"ii",name:"Sichuan Yi"},{code:"sd",name:"Sindhi"},{code:"si",name:"Sinhalese"},{code:"ss",name:"Siswati"},{code:"sk",name:"Slovak"},{code:"sl",name:"Slovenian"},{code:"so",name:"Somali"},{code:"nr",name:"Southern Ndebele"},{code:"es",name:"Spanish"},{code:"su",name:"Sundanese"},{code:"sw",name:"Swahili (Kiswahili)"},{code:"ss",name:"Swati"},{code:"sv",name:"Swedish"},{code:"tl",name:"Tagalog"},{code:"ty",name:"Tahitian"},{code:"tg",name:"Tajik"},{code:"ta",name:"Tamil"},{code:"tt",name:"Tatar"},{code:"te",name:"Telugu"},{code:"th",name:"Thai"},{code:"bo",name:"Tibetan"},{code:"ti",name:"Tigrinya"},{code:"to",name:"Tonga"},{code:"ts",name:"Tsonga"},{code:"tr",name:"Turkish"},{code:"tk",name:"Turkmen"},{code:"tw",name:"Twi"},{code:"ug",name:"Uyghur"},{code:"uk",name:"Ukrainian"},{code:"ur",name:"Urdu"},{code:"uz",name:"Uzbek"},{code:"ve",name:"Venda"},{code:"vi",name:"Vietnamese"},{code:"vo",name:"Volap\xfck"},{code:"wa",name:"Wallon"},{code:"cy",name:"Welsh"},{code:"wo",name:"Wolof"},{code:"fy",name:"Western Frisian"},{code:"xh",name:"Xhosa"},{code:"yi",name:"Yiddish"},{code:"ji",name:"Yiddish"},{code:"yo",name:"Yoruba"},{code:"za",name:"Zhuang, Chuang"},{code:"zu",name:"Zulu"}],o=r.map(e=>e.code),s=e=>{if(!e)return;if(e.includes("-")&&(e=e.split("-")[0]),!!e){if(e.includes("_")&&(e=e.split("_")[0]),e){if(e=e.toLowerCase(),!o.includes(e))return;return e}}},l=()=>(0,i.useMemo)(()=>n.g.navigator.languages,[]),c=()=>{let e=l();return(0,i.useMemo)(()=>(0,a.Xo)(r,"asc",t=>-1===e.indexOf(t.code)?0:1),[e])},d=()=>{let e=c();return(0,i.useMemo)(()=>e.map((e,t)=>({key:t,value:e.code,label:`${e.name} (${e.code})`})),[e])}},5016:function(e,t,n){n.d(t,{A9:function(){return c},BH:function(){return p},Pk:function(){return d},Pq:function(){return h},sN:function(){return u}});var i=n(3062),a=n(6513),r=n.n(a),o=n(5271),s=n(5),l=n(6340);class c extends Error{constructor(){super()}}class d extends Error{constructor(e){super(),(0,i._)(this,"message",void 0),this.message=e}}class u extends Error{constructor(e){super(),(0,i._)(this,"data",void 0),this.data=e}}function h(e){return r().join(l.O.appApiRoot,e)}function p(e,t,n){let i=(0,s.s0)(),a=(0,o.useRef)(t);a.current=t;let r=JSON.stringify(t),l=(0,o.useRef)(n);l.current=n;let[d,u]=(0,o.useState)(),[h,p]=(0,o.useState)(),f=(0,o.useCallback)(t=>{e.action(a.current).then(e=>{!t.aborted&&u(e)}).catch(e=>{if(!t.aborted){if(e instanceof c)return i("/login"),null;else p(e)}})},[i,e]),g=(0,o.useCallback)(e=>{var t;(null===(t=l.current)||void 0===t?void 0:t.clearWhenReload)!==!1&&(u(void 0),p(void 0)),f((null==e?void 0:e.signal)??new AbortController().signal)},[f]);return(0,o.useEffect)(()=>{if(!r||(null==n?void 0:n.request)===!1)return;let e=new AbortController;return g({signal:e.signal}),()=>{e.abort()}},[r,null==n?void 0:n.request,g]),{data:d,reload:g,error:h}}},6689:function(e,t,n){n.d(t,{xx:function(){return i}}),n(3062),n(6340);class i extends Error{}},9835:function(e,t,n){n.d(t,{G6:function(){return s},jU:function(){return a},oL:function(){return r},tq:function(){return o},vU:function(){return l}});var i=n(2257);let a=!!n.g.window||!!n.g.navigator,r="ontouchstart"in(a?n.g.window??{}:{}),o=a&&(0,i.Z)(navigator.userAgent).any,s=a&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent),l=a&&navigator.userAgent.toLowerCase().includes("firefox")},6092:function(e,t,n){function i(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e<t?1:-1,i=[];if(n>0)for(let a=e;a<t;a+=n)i.push(a);else if(n<0)for(let a=e;a>t;a+=n)i.push(a);return i}function a(e){return e.filter(e=>!!e)}function r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length-1,i=n;for(;i>=0;){let n=e[i];if(!!n){if(t(n,i,e))return[n,i];i-=1}}return[void 0,void 0]}function o(e,t,n){return r(e,t,n)[1]}function s(e,t,n){return r(e,t,n)[0]}function l(e,t,n){let i=[...e.entries()],a=(e,t)=>{if("string"==typeof e&&"string"==typeof t)return e.localeCompare(t);if("number"==typeof e&&"number"==typeof t)return e-t;if("boolean"==typeof e&&"boolean"==typeof t)return Number(e)-Number(t);else if(Array.isArray(e)&&Array.isArray(t)){for(let[n,i]of e.entries()){let e=t.at(n);if(void 0===e)break;let r=a(i,e);if(0!==r)return r}return 0}else throw Error(`no support order by type(${typeof e} vs ${typeof t})`)};return i.sort((t,i)=>{let[r,o]=t,[s,l]=i,c=n(o,r,e);return a(c,n(l,s,e))}),"desc"===t&&i.reverse(),i.map(e=>e[1])}function c(e){return e.reduce((e,t)=>e+t,0)}n.d(t,{L_:function(){return r},Sm:function(){return c},Xo:function(){return l},dF:function(){return s},oA:function(){return a},qr:function(){return o},w6:function(){return i}})},9883:function(e,t,n){n.d(t,{RG:function(){return r},sM:function(){return a},ym:function(){return o}});var i=n(9835);function a(e){if(!i.jU)return Buffer.from(e).toString("base64");{let t="";for(let n of new Uint8Array(e))t+=String.fromCharCode(n);return window.btoa(t)}}function r(e){return i.jU?Uint8Array.from(window.atob(e),e=>e.charCodeAt(0)):Uint8Array.from(Buffer.from(e,"base64"))}function o(e){let t=Buffer.alloc(e.byteLength),n=new Uint8Array(e);for(let e=0;e<t.length;++e)t[e]=n[e];return t}},5224:function(e,t,n){n.d(t,{BM:function(){return d},cK:function(){return o},eP:function(){return p},hO:function(){return g},kK:function(){return u},lJ:function(){return m},pC:function(){return h},rV:function(){return s},tp:function(){return c}});var i=n(7791),a=n(9835);let r=Symbol("DOMView");function o(e){return!!(e instanceof Element&&["textarea","input"].includes(e.tagName.toLowerCase()))||!1}async function s(e){if(a.jU){let t=new window.DOMParser().parseFromString(e,"text/html");return t[r]=window,{view:window,doc:t}}{let{JSDOM:t}=await Promise.resolve().then(function(){var e=Error("Cannot find module 'jsdom'");throw e.code="MODULE_NOT_FOUND",e}),n=new t("",{pretendToBeVisual:!0}),i=new n.window.DOMParser().parseFromString(e,"text/html");return i[r]=n.window,{view:n.window,doc:i}}}function l(e){var t,n;return(null==e?void 0:e.defaultView)||(null==e?void 0:null===(t=e.ownerDocument)||void 0===t?void 0:t.defaultView)||(null==e?void 0:null===(n=e.ownerDocument)||void 0===n?void 0:n[r])}function c(e){let t=l(e);if(!t)throw Error("no dom view");return t}function d(e){let t=l(e);return!!t&&e instanceof t.Text}function u(e){let t=l(e);return!!t&&e instanceof t.HTMLElement}function h(e){let t=l(e);return!!t&&e instanceof t.HTMLImageElement}async function p(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=new URL(e),r=[...t.querySelectorAll("img")],o=new Headers({...n.referrer?{Referer:n.referrer??void 0}:{}});for(let e of r){let t=e.src||e.getAttribute("data-src");if(t)try{if(t.startsWith("//")&&(t=`${a.protocol}:${t}`),!(0,i.C)(t))return;let n=await fetch(t,{headers:o}),r=n.headers.get("Content-Type"),s=await n.arrayBuffer();e.src=`data:${r};base64,${Buffer.from(s).toString("base64")}`}catch(e){console.error(e)}}}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[...e.querySelectorAll("image")],i=new Headers({...t.referrer?{Referer:t.referrer??void 0}:{}});for(let e of n){let n=e.href.baseVal;if(!n)continue;let a=t.baseURL?new URL(n,t.baseURL):n;try{let t=await fetch(a,{headers:i}),n=t.headers.get("Content-Type"),r=await t.arrayBuffer();e.setAttribute("href",`data:${n};base64,${Buffer.from(r).toString("base64")}`)}catch(e){console.error(e)}}}async function g(e,t){let n=e.cloneNode(!0);await f(n,{baseURL:t}),n.setAttribute("width",`${e.clientWidth}px`);let i=new XMLSerializer().serializeToString(n);e.cloneNode();let a=window.btoa(i);return`data:image/svg+xml;base64,${a}`}function m(e){e.preventDefault(),e.stopPropagation()}},8205:function(e,t,n){function i(e){return e.split(/\r?\n/)}function a(e){return e.split(/\r?\n\r?\n/)}function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}function o(e,t){function n(e,t){let n=[],i=0,a=e.length;for(;i<a;){let a=e.indexOf(t,i);if(-1===a)break;n.push(a),i=a+t.length}return n}let i=n(e,t.keyword).map(e=>[e,t.keyword.length]),a=[];if(t.alias)for(let r of t.alias){let t=r.length,o=n(e,r).filter(e=>!i.some(n=>n[0]<=e&&n[0]+n[1]>=e+t));a.push(...o.map(e=>[e,t]))}return[...i,...a]}n.d(t,{Rh:function(){return o},WM:function(){return a},kC:function(){return r},uq:function(){return i}})},7791:function(e,t,n){function i(e){let[t,n]=e.split("#",2);return[decodeURIComponent(t??""),decodeURIComponent(n??"")]}function a(e){try{return new URL(e),!0}catch{return!1}}n.d(t,{C:function(){return a},c:function(){return i}})},33:function(e,t,n){n.d(t,{E8:function(){return d},JB:function(){return u},c1:function(){return p},x1:function(){return f}});var i=n(2743),a=n(3496),r=n(887),o=n(8355),s=n(2854),l=n(5271);let c=(0,i.cn)(null),d=()=>{let e=s.c.get(c);return e?e:r.ZP};function u(){let[e,t]=r.ZP.useNotification({placement:"top",duration:3}),[,n]=(0,a.KO)(c);return(0,l.useEffect)(()=>{n(e)},[e,n]),t}let h=(0,i.cn)(null),p=()=>{let e=s.c.get(h);return e?e:o.ZP};function f(){let[e,t]=o.ZP.useMessage({duration:3}),[,n]=(0,a.KO)(h);return(0,l.useEffect)(()=>{n(e)},[e,n]),t}},9860:function(e,t,n){let i,a;var r=n("2676"),o=n("8751"),s=n("5525"),l=n("6444"),c=n("5683"),d=n("4790"),u=n("5291"),h=n("7363");window.API={book:{add:async e=>await l.Z.action(e),fetchUrlInfo:async e=>await c.z.action(e),addByUrl:async e=>await s.f.action(e),async update(e){await h.r.action(e)},async top(e){await d.s.action(e)},search:async e=>await u.g.action(e)}};var p=n("5688");n("2110");var f=n("3496"),g=n("5271"),m=n("6892"),v=n("4679"),y=n("107"),x=n("6258"),w=n("7147"),k=n("6174"),b=n("2753"),j=n("5411"),C=n("2743"),S=n("6092"),L=n("5224"),P=n("8205");let _=(0,C.cn)({win:null});var E=n("2854");let R="hotkeyList-X2vODR",N=(0,C.cn)([]),A="";function T(e){if(Array.isArray(e))return e.map(T).join(" ");if("string"==typeof e)return e.toLowerCase();{let t="";return e.shift&&(t+="shift+"),e.ctrl&&(t+="ctrl+"),e.alt&&(t+="alt+"),t+=e.key.toLowerCase()}}function I(e){let t="";return e.length>1?t+=(0,P.kC)(e):" "===e?t+="Space":t+=e,t}function M(){let e=(0,g.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=E.c.get(N),i=[];for(let[a,r,o]of e){let e=T(a),s=function e(t){if(Array.isArray(t))return t.map(e).flat();if("string"==typeof t)return[I(t)];{let e="",n=t.shift||t.ctrl||t.alt;return n&&(e+="<"),t.shift&&(e+="Shift-"),t.ctrl&&(e+="Ctrl-"),t.alt&&(e+="Alt-"),e+=I(t.key),n&&(e+=">"),[e]}}(a),l=t.level??1,c=n.find(t=>{let[n]=t;return n===e});if(c){if(c[3].has(l))throw Error(`Hotkey ${JSON.stringify(a)} level: ${l} already exists`);c[3].set(l,o)}else c=[e,s,r,new Map([[l,o]])],n.push(c);i.push({item:c,level:l})}return E.c.set(N,[...n]),function(){let e=E.c.get(N),t=[];for(let{item:e,level:n}of i)e[3].delete(n),!e[3].size&&t.push(e);E.c.set(N,e.filter(e=>!t.includes(e)))}},[]);return{addHotkey:(0,g.useCallback)(function(t,n,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e([[t,n,i]],a)},[e]),addHotkeys:e}}function Z(){return e=>{if((0,L.cK)(e.target))return;let t=E.c.get(N),n=T({shift:e.shiftKey,ctrl:e.ctrlKey,alt:e.altKey,key:e.key.toLowerCase()});console.log("triggered-key:",n);let a=A+n,r=a+" ",o=t.find(e=>{let[t]=e;return t===a}),s=t.find(e=>{let[t]=e;return t.startsWith(r)});if(o||s){if((0,L.lJ)(e),A="",clearTimeout(i),s)A=r,i=setTimeout(()=>{A=""},1e3);else if(o){var l;let e=Math.max(...o[3].keys());e&&(null===(l=o[3].get(e))||void 0===l||l())}}}}function $(){let[e,t]=(0,g.useState)(!1),{addHotkey:n}=M(),[i]=(0,f.KO)(N);return!function(){let[e]=(0,f.KO)(_);(0,g.useEffect)(()=>{let e=Z();return window.addEventListener("keydown",e,{passive:!1}),()=>{window.removeEventListener("keydown",e)}},[]),(0,g.useEffect)(()=>{if(!e.win)return;let t=Z();return e.win.addEventListener("keydown",t,{passive:!1}),()=>{var n;null===(n=e.win)||void 0===n||n.removeEventListener("keydown",t)}},[e])}(),(0,g.useEffect)(()=>n({shift:!0,key:"?"},(0,j.t)("hotkey.helper"),()=>{t(!0)}),[n]),O(()=>{t(!1)},{enable:e,level:200}),(0,r.jsx)(w.Z,{open:e,width:"auto",style:{maxWidth:"1000px"},onCancel:()=>{t(!1)},title:(0,j.t)("hotkey.title"),footer:!1,zIndex:1e4,children:(0,r.jsx)("ul",{className:R,children:(0,S.Xo)(i,"asc",e=>{let[t]=e;return t}).map((e,t)=>{let[,n,i]=e;return(0,r.jsxs)("li",{children:[(0,r.jsx)("div",{className:"keys",children:n.map((e,t)=>(0,r.jsx)("kbd",{children:e},t))}),(0,r.jsx)("div",{className:"desc",children:i})]},t)})})})}function O(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{enable:n=!0,level:i=100}=t,a=(0,g.useRef)(e),{addHotkey:r}=M();(0,g.useEffect)(()=>{a.current=e},[e]),(0,g.useEffect)(()=>{if(n)return r("escape",(0,j.t)("hotkey.escape"),()=>{a.current()},{level:i})},[r,n,i])}var W=n("2803");function F(e){let{icon:t,size:n,style:i,onClick:a,color:o}=e;return(0,r.jsx)(W.G,{icon:t,size:n??"lg",color:o,style:{paddingLeft:"6px",paddingRight:"6px",...i},onClick:a})}var B=n("3663");let z=(0,C.cn)(null);function K(e){return new Promise(t=>{E.c.set(z,{...e,okCallback:()=>t(!0),cancelCallback:()=>t(!1)})})}let D=e=>{let{enable:t=!0,onOk:n,onClose:i,level:a=100}=e,{addHotkey:r}=M(),o=(0,x.x)(n),s=(0,x.x)(i);(0,g.useEffect)(()=>{if(t)return r("Enter",(0,j.t)("hotkey.ok"),()=>{o.current()},{level:a})},[r,t,a,o]),O(()=>{var e;null===(e=s.current)||void 0===e||e.call(s)},{enable:!!t&&!!i})};function U(){let[e,t]=(0,f.KO)(z),n=(0,g.useCallback)(()=>{t(null)},[t]),i=(0,g.useCallback)(()=>{null==e||e.cancelCallback(),n()},[e,n]),a=(0,g.useCallback)(()=>{null==e||e.okCallback(),n()},[e,n]);return D({enable:!!e,onOk:a,onClose:i}),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(w.Z,{open:!!e,onOk:a,onCancel:n,title:(0,r.jsxs)(k.Z,{children:[(0,r.jsx)(F,{icon:B.Fuz,size:"lg",color:"#ff4d4f"}),null==e?void 0:e.title]}),footer:!1,children:(0,r.jsxs)(k.Z,{direction:"vertical",children:[null==e?void 0:e.description,(0,r.jsxs)(k.Z,{children:[(0,r.jsx)(b.ZP,{type:"primary",onClick:n,children:(0,j.t)("confirm.cancel")}),(0,r.jsx)(b.ZP,{type:"primary",onClick:a,children:(0,j.t)("confirm.ok")})]})]})})})}function H(){let[e]=(0,f.KO)(z);return e?(0,r.jsx)(U,{}):(0,r.jsx)(r.Fragment,{})}let V="hint-cMFGU8",q=(0,C.cn)(null);function G(){let[e]=(0,f.KO)(q);return(0,r.jsx)("div",{className:V,style:{display:e?"inline-block":"none"},children:e})}var J=n("33");let X="overlay-RAuidH",Y="container-s1K_V6",Q="center-V6m0hj";function ee(e,t){return Math.hypot(t.clientX-e.clientX,t.clientY-e.clientY)}function et(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}let en=e=>{let t=e.deltaY;return 0===t?0:t<0?1.1:.9},ei=(e,t,n)=>{let i=!1,a=null,r=e.getBoundingClientRect(),o={x:0,y:0,scale:1},s={x:0,y:0,scale:1},l=()=>{t.style.transform=`translate(${o.x}px, ${o.y}px) scale(${o.scale})`},c=()=>{s={...o={...et(r),scale:1}},l()};c();let d=e=>{Math.hypot(e.x,e.y)>=10&&(i=!0),o.x=s.x+e.x,o.y=s.y+e.y,l()},u=t=>{let n=s.scale*t.rate;if(n<.01)return;o.scale=n;let i=e.getBoundingClientRect(),a=t.pageX-i.left-s.x,r=t.pageY-i.top-s.y;o.x=s.x+a*(1-t.rate),o.y=s.y+r*(1-t.rate),l()},h=()=>{s.x=o.x,s.y=o.y,s.scale=o.scale},p=[];function f(t,n){e.addEventListener(t,n),p.push(()=>e.removeEventListener(t,n))}return f("touchstart",e=>{(0,L.lJ)(e);let t=e.touches[0];if(!t)return;let n=e.touches[1];a=n?{type:"pinch",range:ee(t,n)}:{type:"move",x:t.clientX,y:t.clientY},i=!1}),f("touchmove",e=>{if((0,L.lJ)(e),!a)return;let t=e.touches[0];if(!t)return;let n=e.touches[1];switch(a.type){case"move":d({x:t.clientX-a.x,y:t.clientY-a.y});break;case"pinch":if(n){var i,r;u({...(i=t,r=n,{pageX:(i.pageX+r.pageX)/2,pageY:(i.pageY+r.pageY)/2}),rate:ee(t,n)/a.range})}}}),f("touchend",e=>{(0,L.lJ)(e),a&&("move"===a.type&&!i&&n(),a=null,h())}),f("mousedown",e=>{(0,L.lJ)(e),a={type:"move",x:e.clientX,y:e.clientY},i=!1}),f("mousemove",e=>{(0,L.lJ)(e),a&&"move"===a.type&&d({x:e.clientX-a.x,y:e.clientY-a.y})}),f("mouseup",e=>{(0,L.lJ)(e),a&&("move"===a.type&&!i&&n(),a=null,h(),!i&&n())}),f("wheel",e=>{(0,L.lJ)(e),u({pageX:e.pageX,pageY:e.pageY,rate:en(e)}),h()}),{move:e=>{d(e),h()},scale:e=>{let t=et(r);u({...e,pageX:t.x,pageY:t.y}),h()},reset:()=>{c()},dispose:()=>{p.forEach(e=>e())}}};function ea(e){let{onClose:t,children:n}=e,i=(0,g.useRef)(null),a=(0,g.useRef)(null),o=(0,g.useRef)(),{addHotkeys:s}=M();return O(()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.call(o)}),(0,g.useEffect)(()=>{o.current=t},[t]),(0,g.useEffect)(()=>{let e=i.current,t=a.current;if(!e||!t)return;let{move:n,scale:r,reset:l,dispose:c}=ei(e,t,()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.call(o)}),d=()=>{n({x:0,y:-10})},u=()=>{n({x:0,y:10})},h=()=>{n({x:-10,y:0})},p=()=>{n({x:10,y:0})},f=s([["k",(0,j.t)("hotkey.pinchUp"),d],["j",(0,j.t)("hotkey.pinchDown"),u],["h",(0,j.t)("hotkey.pinchLeft"),h],["l",(0,j.t)("hotkey.pinchRight"),p],["ArrowUp",(0,j.t)("hotkey.pinchUp"),d],["ArrowDown",(0,j.t)("hotkey.pinchDown"),u],["ArrowLeft",(0,j.t)("hotkey.pinchLeft"),h],["ArrowRight",(0,j.t)("hotkey.pinchRight"),p],["=",(0,j.t)("hotkey.pinchZoomIn"),()=>{r({rate:1.1})}],["-",(0,j.t)("hotkey.pinchZoomOut"),()=>{r({rate:.9})}],["Backspace",(0,j.t)("hotkey.pinchReset"),l]],{level:100});return()=>{c(),f()}},[s]),(0,g.useEffect)(()=>{},[s]),(0,r.jsx)("div",{ref:i,className:X,onKeyDown:e=>{var t;"escape"===e.key.toLowerCase()&&(null===(t=o.current)||void 0===t||t.call(o))},children:(0,r.jsx)("div",{className:Y,ref:a,children:(0,r.jsx)("div",{className:Q,children:n})})})}let er=(0,C.cn)(null);function eo(){let[e,t]=(0,f.KO)(er);return e?(0,r.jsx)(ea,{onClose:()=>{t(null)},children:(0,r.jsx)("img",{src:e,onLoad:e=>{let t=e.currentTarget,n=t.naturalWidth/t.naturalHeight;n>window.innerWidth/window.innerHeight?t.naturalWidth>window.innerWidth&&(t.width=window.innerWidth,t.height=window.innerWidth/n):t.naturalHeight>window.innerHeight&&(t.height=window.innerHeight,t.width=window.innerHeight*n)},alt:"preview"})}):(0,r.jsx)(r.Fragment,{})}var es=n("4600");function el(e){return(0,r.jsx)(es.Z,{fullscreen:!0,size:"large",...e})}function ec(e){return(0,r.jsx)(es.Z,{...e,style:{width:"100%",padding:20,...e.style}})}var ed=n("1484");let eu="Auditory Reader",eh=(0,C.cn)([]),ep=(0,C.cn)(e=>{let t=e(eh).at(0);return null==t?void 0:t.title});function ef(){let[e]=(0,f.KO)(ep);return e}function eg(){let e=ef();return(0,g.useEffect)(()=>{document.title=e?`${e}: ${eu}`:eu},[e]),(0,r.jsx)(r.Fragment,{})}var em=n("5"),ev=n("571"),ey=n("6917"),ex=n("5016"),ew=n("9835");let ek=(0,C.cn)([]);if(ew.jU){let e=()=>{E.c.set(ek,speechSynthesis.getVoices())};e(),"addEventListener"in window.speechSynthesis&&window.speechSynthesis.addEventListener("voiceschanged",e)}function eb(e){let{storeKey:t,read:n,write:i}=e,a=(0,C.cn)(n(localStorage.getItem(t)));return()=>{let[e,n]=(0,f.KO)(a),r=(0,g.useCallback)(a=>{let r;n(r="function"==typeof a?a(e):a);let o=i(r);o?localStorage.setItem(t,o):localStorage.removeItem(t)},[e,n]);return[e,r]}}let ej=e=>"nav"===e||"annotation"===e||"keyword"===e?e:"none",eC=eb({storeKey:"viewPanelType",read:ej,write:ej}),eS=eb({storeKey:"langVoiceURIDict",read:e=>e?JSON.parse(e):{},write:e=>JSON.stringify(e)}),eL=()=>{let[e]=eS(),[t]=(0,f.KO)(ek),n=(0,g.useCallback)(e=>(0,S.Xo)(t,"desc",t=>[t.lang.startsWith(`${e.langCode}-`),!t.localService]),[t]);return{getVoice:(0,g.useCallback)(t=>{let i=n(t),a=e[t.langCode];return(a?i.find(e=>e.voiceURI===a):null)??i.at(0)??null},[e,n]),getAllSortedVoices:n}},eP=e=>{let[t,n]=eS(),i=(0,g.useMemo)(()=>t[e.langCode]??null,[e.langCode,t]);return[i,(0,g.useCallback)(i=>{let a={...t};i?a[e.langCode]=i:delete a[e.langCode],n(a)},[e.langCode,t,n])]},e_=e=>{let[t,n]=eP(e),{getAllSortedVoices:i,getVoice:a}=eL(),r=(0,g.useMemo)(()=>i(e),[e,i]),o=(0,g.useMemo)(()=>{var e;return t??(null===(e=r[0])||void 0===e?void 0:e.voiceURI)??null},[r,t]),s=(0,g.useCallback)(e=>{n(e)},[n]),l=(0,g.useMemo)(()=>a(e)??null,[e,a]),c=(0,g.useCallback)(e=>{s((null==e?void 0:e.voiceURI)??null)},[s]);return{voiceURI:o,setVoiceURI:s,voice:l,setVoice:c,allSortedVoices:r}},eE=eb({storeKey:"autoSection",read:e=>!e||"1"===e,write:e=>e?"1":"0"}),eR=eb({storeKey:"stopTimer",read:e=>!e||"1"===e,write:e=>e?"1":"0"}),eN=eb({storeKey:"stopTimerSeconds",read:e=>e?Number(e):1800,write:e=>e.toString()}),eA=eb({storeKey:"personReplace",read:e=>!!e&&"1"===e,write:e=>e?"1":"0"}),eT=eb({storeKey:"speechSpeed",read:e=>e?Number(e):1,write:e=>e.toString()}),eI=["system","dark","light"],eM=eb({storeKey:"userColorScheme",read:e=>e??"system",write:e=>e}),eZ=eb({storeKey:"paragraphRepeat",read:e=>e?Number(e):1,write:e=>e.toString()}),e$=["none","auto","single","double"],eO=eb({storeKey:"pageList",read:e=>e$.includes(e)?e:"auto",write:e=>e}),eW=eb({storeKey:"fontSize",read:e=>e?Math.min(Math.max(Number(e),8),30):16,write:e=>e.toString()}),eF=eb({storeKey:"disabledVertical",read:e=>!!e&&"1"===e,write:e=>e?"1":"0"});function eB(e){let{title:t}=e,n=(0,em.s0)(),{addHotkeys:i}=M();return(0,g.useEffect)(()=>i([["u",(0,j.t)("hotkey.goBack"),()=>n("../../")]]),[i,n]),(0,r.jsx)(p.Z,{type:"error",message:`The ${t} not found`,description:`The ${t} not found`})}function ez(e){let{dir:t="column",gap:n=0,flex:i,style:a,children:o,...s}=e;return(0,r.jsx)("div",{style:{display:"flex",flexDirection:t,gap:n,flex:i,...a},...s,children:o})}function eK(e){let{to:t,children:n}=e;return n((0,em.oQ)(t))}function eD(){let{uuid:e}=(0,em.UO)();return e?(0,r.jsxs)(ez,{gap:4,children:[(0,r.jsx)(p.Z,{type:"success",message:(0,j.t)("desc.bookAddedSuccessful")}),(0,r.jsx)(eK,{to:`/books/view/${e}`,children:e=>(0,r.jsx)(b.ZP,{type:"primary",href:e,icon:(0,r.jsx)(F,{icon:B.Mdf}),children:(0,j.t)("view")})})]}):(0,r.jsx)(eB,{title:"book"})}var eU=n("3829"),eH=n("6916"),eV=n("6513"),eq=n.n(eV),eG=n("9237"),eJ=n("3098"),eX=n("9883");let eY=e=>{e().catch(console.error)},eQ=e=>new Promise(t=>{setTimeout(t,e)});var e0=n("4800");let e1="fileInput-jzkJ9C",e3=e=>{let{accept:t,prompt:n,value:i,onChange:a}=e,[o,s]=(0,g.useState)([]);return(0,g.useEffect)(()=>{s(i??[])},[i]),(0,r.jsxs)("label",{className:e1,children:[(0,r.jsx)("input",{style:{display:"none"},accept:t,multiple:!0,type:"file",onChange:e=>{let t=[...e.target.files??[]];s(t),null==a||a(t)}}),o.length?(0,r.jsx)(ez,{gap:5,children:o.map((e,t)=>(0,r.jsxs)(ez,{dir:"row",gap:5,style:{alignItems:"center"},children:[(0,r.jsx)(F,{icon:B.cf$}),(0,r.jsx)("div",{children:e.name})]},t))}):(0,r.jsx)(ez,{gap:2,style:{justifyContent:"center"},children:n&&(0,r.jsx)(e0.Z,{children:n})})]})};var e2=n("8731");let e6=(e,t)=>!!t&&"string"==typeof t.label&&t.label.toLowerCase().includes(e.toLowerCase());function e4(e){let{value:t,onChange:n}=e,i=(0,eJ.sF)(),[a,o]=(0,g.useState)(""),s=(0,g.useMemo)(()=>{if(!a)return i;let e=a.toLowerCase(),t=i.filter(t=>t.value===e);return t.length?t:i},[i,a]);return(0,r.jsx)(e2.Z,{showSearch:!0,filterOption:(e,t)=>(o(e),e6(e,t)),popupMatchSelectWidth:!1,value:t,onChange:n,placeholder:(0,j.t)("prompt.selectLanguage"),options:s})}function e8(){let e=(0,em.s0)(),[t,n]=(0,g.useState)(!1),[i]=eU.Z.useForm(),a=eU.Z.useWatch("file",i);return(0,g.useEffect)(()=>{eY(async()=>{if(a.name.endsWith(".epub")){let e=await a.arrayBuffer(),t=await eG.P.read(e);if(!t)return;let n=eq().extname(a.name),r=eq().basename(a.name,n);i.setFieldValue("name",t.title??r);let o=(0,eJ.Wx)(t.language);o&&i.setFieldValue("langCode",o)}})},[a,i]),(0,r.jsxs)(eU.Z,{form:i,style:{margin:"20px auto 0",maxWidth:"800px"},initialValues:{name:"",langCode:null,file:null},onFinish:t=>{eY(async()=>{try{if(n(!0),t.file.name.endsWith(".epub")){let n=await t.file.arrayBuffer(),i=(0,eX.sM)(n),a=await l.Z.action({name:t.name,langCode:t.langCode,bufferBase64:i,type:"epub"});e(`/books/added-successful/${a.uuid}`)}else if(t.file.name.endsWith(".txt")){let n=await t.file.arrayBuffer(),i=(0,eX.sM)(n),a=await l.Z.action({name:t.name,langCode:t.langCode,bufferBase64:i,type:"text"});e(`/books/added-successful/${a.uuid}`)}}finally{n(!1)}})},children:[(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("bookName"),name:"name",rules:[{required:!0}],children:(0,r.jsx)(eH.Z,{placeholder:(0,j.t)("prompt.inputBookName")})}),(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("language"),name:"langCode",rules:[{required:!0}],children:(0,r.jsx)(e4,{})}),(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("file"),name:"file",rules:[{required:!0}],children:(0,r.jsx)(e3,{onChange:e=>{e.at(0)&&eY(async()=>{})},prompt:(0,j.t)("prompt.uploadBook")})}),(0,r.jsx)(eU.Z.Item,{children:(0,r.jsx)(b.ZP,{block:!0,type:"primary",htmlType:"submit",loading:t,children:(0,j.t)("add")})})]})}function e9(e){let{...t}=e;return(0,r.jsx)(eH.Z.TextArea,{rows:4,onKeyDown:e=>{if(e.ctrlKey&&"Enter"===e.key){var t;let n=e.target;(0,L.lJ)(e),null===(t=n.closest("form"))||void 0===t||t.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))}},...t})}function e5(){let e=(0,em.s0)(),[t,n]=(0,g.useState)(!1),[i]=eU.Z.useForm(),a=eU.Z.useWatch("content",i);return(0,g.useEffect)(()=>{if(!!a){if(!i.getFieldValue("name")){let e=(0,P.uq)(a).find(e=>!!e.trim());e&&i.setFieldValue("name",e)}}},[a,i]),(0,r.jsxs)(eU.Z,{form:i,style:{margin:"20px auto 0",maxWidth:"800px"},initialValues:{name:"",langCode:null,content:""},onFinish:t=>{eY(async()=>{try{n(!0);let i=new TextEncoder().encode(t.content),a=(0,eX.sM)(i),r=await l.Z.action({name:t.name,langCode:t.langCode,bufferBase64:a,type:"text"});e(`/books/added-successful/${r.uuid}`)}finally{n(!1)}})},children:[(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("bookName"),name:"name",rules:[{required:!0}],children:(0,r.jsx)(eH.Z,{placeholder:(0,j.t)("prompt.inputBookName")})}),(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("language"),name:"langCode",rules:[{required:!0}],children:(0,r.jsx)(e4,{})}),(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("bookContent"),name:"content",rules:[{required:!0}],children:(0,r.jsx)(e9,{rows:6})}),(0,r.jsx)(eU.Z.Item,{children:(0,r.jsx)(b.ZP,{block:!0,htmlType:"submit",type:"primary",loading:t,children:(0,j.t)("add")})})]})}function e7(){let e=(0,em.s0)(),[t,n]=(0,g.useState)(!1),[i,a]=(0,g.useState)(!1),[o]=eU.Z.useForm();return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(eU.Z,{form:o,style:{margin:"20px auto 0",maxWidth:"800px"},initialValues:{name:"",langCode:null,url:""},onFinish:t=>{eY(async()=>{try{a(!0);let n=await s.f.action({name:t.name,langCode:t.langCode,url:t.url});e(`/books/added-successful/${n.uuid}`)}finally{a(!1)}})},children:[(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("bookName"),name:"name",rules:[{required:!0}],children:(0,r.jsx)(eH.Z,{placeholder:(0,j.t)("prompt.inputBookName")})}),(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("language"),name:"langCode",rules:[{required:!0}],children:(0,r.jsx)(e4,{})}),(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("url"),name:"url",rules:[{required:!0}],children:(0,r.jsxs)(k.Z.Compact,{style:{width:"100%"},children:[(0,r.jsx)(eH.Z,{}),(0,r.jsx)(b.ZP,{style:{alignSelf:"center"},type:"primary",loading:t,onClick:()=>{let e=o.getFieldValue("url");e&&(n(!0),c.z.action({url:e}).then(e=>{o.setFieldValue("name",e.title),e.lang&&o.setFieldValue("langCode",e.lang)}).catch(console.error).finally(()=>n(!1)))},children:(0,j.t)("extractUrlInfo")})]})}),(0,r.jsx)(eU.Z.Item,{children:(0,r.jsx)(b.ZP,{block:!0,htmlType:"submit",type:"primary",loading:i,children:(0,j.t)("add")})})]})})}var te=n("279");function tt(){let[e,t]=(0,g.useState)("text");return(0,r.jsx)(te.Z,{defaultActiveKey:e,onChange:e=>t(e),destroyInactiveTabPane:!0,items:[{key:"text",label:(0,j.t)("text"),children:(0,r.jsx)(e5,{})},{key:"file",label:(0,j.t)("file"),children:(0,r.jsx)(e8,{})},{key:"url",label:(0,j.t)("url"),children:(0,r.jsx)(e7,{})}]})}var tn=n("4254");function ti(e){let{book:t,reload:n}=e,[i]=eU.Z.useForm();return(0,r.jsxs)(eU.Z,{form:i,initialValues:{name:t.name,langCode:t.langCode},onFinish:e=>{eY(async()=>{await h.r.action({uuid:t.uuid,update:{name:e.name,langCode:e.langCode}}),n()})},children:[(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("bookName"),name:"name",rules:[{required:!0}],children:(0,r.jsx)(eH.Z,{autoFocus:!0,placeholder:(0,j.t)("prompt.inputBookName")})}),(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("language"),name:"langCode",rules:[{required:!0}],children:(0,r.jsx)(e4,{})}),(0,r.jsx)(eU.Z.Item,{children:(0,r.jsx)(b.ZP,{block:!0,htmlType:"submit",type:"primary",children:(0,j.t)("update")})})]})}function ta(e){let{uuid:t,reload:n}=e,{data:i}=(0,ex.BH)(tn._,{uuid:t});return i?(0,r.jsx)(ti,{book:i,reload:n}):(0,r.jsx)(ec,{})}let tr=(0,C.cn)({uuid:null,reloads:[]});function to(e){let t=(0,x.x)(e),[,n]=(0,f.KO)(tr),i=(0,g.useCallback)(e=>{n(t=>({...t,uuid:e}))},[n]);return(0,g.useEffect)(()=>{let e=()=>{t.current()};return n(t=>({...t,reloads:[...t.reloads,e]})),()=>{n(t=>({...t,reloads:t.reloads.filter(t=>t!==e)}))}},[t,n]),{openBookEdit:i}}function ts(){let[e,t]=(0,f.KO)(tr),n=(0,g.useCallback)(()=>{t(e=>({...e,uuid:null}))},[t]);return(0,r.jsx)(w.Z,{open:!!e.uuid,onCancel:n,title:(0,j.t)("editBook"),footer:!1,children:e.uuid&&(0,r.jsx)(ta,{uuid:e.uuid,reload:()=>{n(),e.reloads.forEach(e=>e())}})})}var tl=n("690"),tc=n("5297"),td=n("9932"),tu=n("5871"),th=n("1863"),tp=n("7166"),tf=n("6414"),tg=n("2199"),tm=n("9418"),tv=n("6504"),ty=n("6689");let tx=new tv.p("books/cover",{method:"get"}).routeLogined(async e=>{let{req:t,res:n,userInfo:i}=e,a=t.searchParams.get("uuid");if(!a)throw new ty.xx("uuid parameter required");let r=await tm.E.book(i.account,a),o=await r.cover();if(!o)throw new ty.xx("cover in book not found");return o.mediaType&&n.header("Content-Type",o.mediaType.toString()),o.buffer}),tw=e=>`${tx.fullRoutePath}?uuid=${e}`;var tk=n("7864"),tb=n("5719"),tj=n("9878"),tC=n("390");let tS=["default","reverse","name","name-reverse"];var tL=n("3062"),tP=n("7356");let t_=n.p+"static/media/keyboard.983b6fe1.mp3",tE=n.p+"static/media/rain-loop.769e8d4a.mp3",tR=n.p+"static/media/next-page.2cb810bd.mp3",tN=n.p+"static/media/shutter.37b7999d.mp3",tA=n.p+"static/media/rewind.3bbb7b0e.mp3",tT=new tP.Howl({src:[tN]});async function tI(){tT.play(),await new Promise(e=>{tT.once("end",e)})}let tM=new tP.Howl({src:[t_]});async function tZ(){tM.play(),await new Promise(e=>{tM.once("end",e)})}let t$=new tP.Howl({src:[tR]});async function tO(){t$.play(),await new Promise(e=>{t$.once("end",e)})}let tW=new tP.Howl({src:[tE]});tW.loop(!0),tW.fade(0,.5,500);function tF(){tW.playing()&&tW.pause()}let tB=new tP.Howl({src:[tA],volume:.5});async function tz(){tB.play(),await new Promise(e=>{tB.once("end",e)})}class tK{aliasReplace(e,t){if(!t.length)return{text:e,highlightOffsets:[]};let n=[],i=new Map;for(let n of t){let t=-1;for(;-1!==(t=e.indexOf(n.source,t+1));){;!i.has(t)&&i.set(t,n)}}let a=(0,S.Xo)([...i.entries()],"asc",e=>{let[t]=e;return t}),r=0;for(let[t,{source:i,target:o}]of a){e=e.replace(i,o);let a=i.length-o.length;if(0===a)continue;let s=t-r;for(let e of(n.push([s,r]),(0,S.w6)(1,o.length)))n.push([s+e,r+Math.floor(a*(e/o.length))]);r+=a}return{text:e,highlightOffsets:n}}cancel(){this.state="cancel",speechSynthesis.speaking&&speechSynthesis.cancel()}async speak(e,t){let{speed:n,voice:i,isPersonReplace:a,quote:r=!0,alias:o,onBoundary:s}=t;this.state="speaking",e=a?function(e){for(let[t,n]of Object.entries(y.i9))e=e.replaceAll(t,n.word);return e}(e):e;let l=[];if(r){let t=function(e){let t=[];for(let[n,i]of[...e.matchAll(/"|'/g)].entries())n%2==0?t.push({type:"start",charIndex:i.index}):t.push({type:"end",charIndex:i.index});for(let n of e.matchAll(/“|‘|「|『/g))t.push({type:"start",charIndex:n.index});for(let n of e.matchAll(/”|’|」|』/g))t.push({type:"end",charIndex:n.index});return(0,S.Xo)(t,"asc",e=>e.charIndex)}(e);l.push(e=>{let n=(0,S.qr)(t,t=>t.charIndex<=e.charIndex);if(void 0===n)return tF();let i=t.slice(0,n+1),a=i.filter(e=>"start"===e.type),r=i.filter(e=>"end"===e.type);a.length>r.length?tW.playing()||tW.play():tF()})}if(s){if(o&&o.length){let t=this.aliasReplace(e,o);e=t.text;let n=t.highlightOffsets,i=n.length?e=>{let t=(0,S.dF)(n,t=>{let[n]=t;return n<=e.charIndex});if(!t)return e;let i=e.charIndex+e.charLength,a=(0,S.dF)(n,e=>{let[t]=e;return t<=i});if(!a)return e;let r=e.charIndex+(t.at(1)??0),o=i+(a.at(1)??0)-r;return{charIndex:r,charLength:o}}:e=>e;l.push(e=>{s(i(e))})}else l.push(e=>{s(e)})}for(let e of l)this.utterance.addEventListener("boundary",e);this.utterance.rate=n,this.utterance.voice=i,this.utterance.text=e,speechSynthesis.speak(this.utterance);let c=await new Promise((e,t)=>{this.utterance.addEventListener("end",()=>{e("cancel"===this.state?"cancel":"done")},{once:!0}),this.utterance.addEventListener("error",n=>{"cancel"===this.state?e("cancel"):t(n)},{once:!0})});for(let e of l)this.utterance.removeEventListener("boundary",e);return tF(),this.state="none",c}constructor(){(0,tL._)(this,"utterance",void 0),(0,tL._)(this,"state","none"),this.utterance=new SpeechSynthesisUtterance}}var tD=n("7207"),tU=n("9693");let tH=(0,C.cn)({topLeft:null,topRight:null,settings:null,bottomLeft:null,bottomRight:null}),tV=e=>{let{topLeft:t,topRight:n,settings:i,bottomLeft:a,bottomRight:r}=e,[,o]=(0,f.KO)(tH);(0,g.useEffect)(()=>{o({topLeft:t,topRight:n,settings:i,bottomLeft:a,bottomRight:r})},[t,n,i,a,r,o]),(0,tU.z)(()=>{o({topLeft:null,topRight:null,settings:null,bottomLeft:null,bottomRight:null})})},tq=(0,C.cn)(1),tG=(0,C.cn)(15),tJ=(0,C.cn)(0),tX=(0,C.cn)(!1),tY=(0,C.cn)(!1),tQ=(0,C.cn)(""),t0=(0,C.cn)("default"),t1=()=>{let[e,t]=(0,f.KO)(tq),[,n]=(0,f.KO)(tJ);return[e,(0,g.useCallback)(e=>{n(0),t(e)},[n,t])]},t3={hover:"hover-MhvhD5",table:"table-OXXVHq"},t2="book";function t6(e){return`/books/view/${e}`}let t4=async(e,t,n)=>{if(0===n)return;let i=e.at(t);if(!i)return;let a=i.uuid,r=t+n;if(r<=0)return await d.s.action({uuid:a});let o=e.at(r<t?r-1:r);o&&await tb.y.action({uuid:a,afterUuid:o.uuid})};function t8(e){return(0,g.useCallback)(t=>{eY(async()=>{if(await K({title:(0,j.t)("remove"),description:(0,r.jsx)("ul",{children:t.map(e=>(0,r.jsx)("li",{children:e.name},e.uuid))})})){for(let e of t)await tC.f.action({uuid:e.uuid});e()}})},[e])}function t9(e){let{book:t,reload:n}=e,{openBookEdit:i}=to(n),a=(0,g.useCallback)(()=>{window.open(`${tk.c.fullRoutePath}?uuid=${t.uuid}`,"_blank")},[t.uuid]),o=t8(n);return(0,r.jsx)(tc.Z,{trigger:["click"],menu:{items:[{key:"edit",label:(0,j.t)("edit"),onClick:()=>i(t.uuid)},{key:"archive",label:t.isArchived?(0,j.t)("unarchive"):(0,j.t)("archive"),onClick:()=>{eY(async()=>{await h.r.action({uuid:t.uuid,update:{isArchived:!t.isArchived}}),n()})}},{key:"export",label:`${(0,j.t)("export")} Epub`,onClick:()=>a()},{key:"remove",label:(0,j.t)("remove"),onClick:()=>o([t])}]},children:(0,r.jsx)(b.ZP,{shape:"circle",type:"text",children:(0,r.jsx)(F,{icon:B.Uwo})})})}function t5(e){let{index:t,activated:n,book:i,books:a,onHoverMove:o,onDrop:s,onCancel:l,selectedUuids:c,selectTo:d,reload:u,hasOrder:p}=e,m=(0,em.s0)(),[,v]=(0,f.KO)(tJ),y=(0,g.useRef)(null),[,x]=(0,tf.L)({accept:t2,hover(e){let n=a.findIndex(t=>t.uuid===e.uuid);if(-1===n)return;if(n!==t)o(n,t),e.hoverIndex=t},drop(e){s(e)}}),[{isDragging:w},k]=(0,tg.c)({type:t2,item:()=>({name:i.name,uuid:i.uuid,startIndex:t,hoverIndex:t}),collect:e=>({isDragging:e.isDragging()}),end(e,t){!t.didDrop()&&l()}});(0,g.useEffect)(()=>{var e;n&&(null===(e=y.current)||void 0===e||e.scrollIntoView({block:"center"}))},[n,x]);let[b,C]=(0,g.useState)(!1),S=`${tw(i.uuid)}`;return!p&&x(y),(0,r.jsxs)("tr",{ref:y,style:{opacity:w?.2:1,background:n?"var(--main-bg-active)":"var(--main-bg)"},children:[(0,r.jsx)("td",{ref:k,style:{cursor:"move"},children:!p&&(0,r.jsx)(F,{size:"lg",icon:B.g$q,style:{marginLeft:4}})}),(0,r.jsx)("td",{children:(0,r.jsx)(td.Z,{checked:c.includes(i.uuid),onClick:e=>{d(t,e.shiftKey)}})}),(0,r.jsx)("td",{align:"center",style:{cursor:"pointer"},children:i.isFavorited?(0,r.jsx)(F,{icon:B.Tab,onClick:()=>{eY(async()=>{await h.r.action({uuid:i.uuid,update:{isFavorited:!1}}),u()})}}):(0,r.jsx)(F,{icon:tl.Tab,onClick:()=>{eY(async()=>{await h.r.action({uuid:i.uuid,update:{isFavorited:!0}}),u()})}})}),(0,r.jsx)("td",{children:(0,r.jsx)("div",{className:"cell-center",children:(0,r.jsx)("img",{onClick:()=>{E.c.set(er,S)},onLoad:()=>{C(!0)},style:{visibility:b?"visible":"hidden",cursor:"pointer"},src:S,alt:`${i.name} ${(0,j.t)("cover")}`})})}),(0,r.jsx)("td",{className:t3.hover,title:i.createdAt.toLocaleString(),onClick:()=>{v(t),m(t6(i.uuid))},children:i.name}),(0,r.jsx)("td",{children:(0,r.jsx)(t9,{book:i,reload:u})})]},i.uuid)}function t7(e){let{onRemove:t}=e,[{canDrop:n,isOver:i},a]=(0,tf.L)({accept:t2,drop(e){t(e.uuid)},collect:e=>({isOver:e.isOver(),canDrop:e.canDrop()})});return n?(0,r.jsx)(tu.Z,{ref:a,color:i?"error":"warning",icon:i?(0,r.jsx)(F,{icon:B.$aW}):null,children:(0,j.t)("prompt.dropHereToRemove")}):(0,r.jsx)(r.Fragment,{})}function ne(){let[e,t]=t1(),[n,i]=(0,f.KO)(tG),[a,o]=(0,f.KO)(tJ),[s,l]=(0,f.KO)(tX),[c,u]=(0,f.KO)(tY),[m,v]=(0,f.KO)(tQ),y=function(e,t,n){let[i,a]=(0,tD.G)(e,500,void 0);return(0,g.useEffect)(()=>{a(e)},[a,e]),i}(m,500),x=(0,g.useRef)(null),[w,C]=(0,f.KO)(t0),S="default"!==w,{data:L,reload:P}=(0,ex.BH)(tj.N,{filter:{archive:s?"archived":"active",favorite:c?"favorited":"all",search:y,order:w},page:{page:e,perPage:n}},{clearWhenReload:!1}),[_,E]=(0,g.useState)(!1),[R,N]=(0,g.useState)(null),A=(0,g.useCallback)(()=>{N(L?[...L.items]:null)},[L]);(0,g.useEffect)(()=>{A()},[A]);let{selectedBooks:T,allSelected:I,selectedUuids:Z,selectTo:$,selectAll:O}=function(e){let[t,n]=(0,g.useState)(),[i,a]=(0,g.useState)([]),r=(0,g.useMemo)(()=>(null==e?void 0:e.filter(e=>i.includes(e.uuid)))??[],[e,i]),o=(0,g.useMemo)(()=>null==e?void 0:e.every(e=>i.includes(e.uuid)),[e,i]);(0,g.useEffect)(()=>{e&&a([])},[e]);let s=(0,g.useCallback)((r,o)=>{let s;let l=null==e?void 0:e[r];if(!l)return;n(r);let c=!1;void 0!==t&&t!==r&&o?(s=t<r?e.slice(t,r+1).map(e=>e.uuid):e.slice(r,t+1).map(e=>e.uuid),c=!0):(s=[l.uuid],c=!i.includes(l.uuid));let d=[...i];for(let e of s)c?!d.includes(e)&&(d=[...d,e]):d=d.filter(t=>t!==e),a(d)},[e,t,i]),l=(0,g.useCallback)(()=>{o?a([]):a((null==e?void 0:e.map(e=>e.uuid))??[])},[o,e]);return{selectedBooks:r,allSelected:o,selectedUuids:i,selectTo:s,selectAll:l}}(R),W=(0,g.useCallback)(()=>{x.current&&x.current.focus()},[]),z=(0,g.useCallback)(()=>{let e=tS.indexOf(w),t=tS[e-1];if(t)C(t);else{let e=tS[tS.length-1];e&&C(e)}},[w,C]),K=(0,g.useCallback)(()=>{let e=tS.indexOf(w),t=tS[e+1];t?C(t):C(tS["0"])},[w,C]),D=t8(P),U=(0,g.useCallback)(async e=>{for(let t of[...e.reverse()])await d.s.action({uuid:t.uuid});t(1),P()},[P,t]);!function(e){let{focusSearchInput:t,orderSelectPrev:n,orderSelectNext:i,dataBooks:a,selectTo:r,selectAll:o,selectedBooks:s,reload:l,moveBooksTop:c,removeBooks:d,hasOrder:u}=e,[p,m]=(0,f.KO)(tJ),[,v]=t1(),[,y]=(0,f.KO)(tX),[,x]=(0,f.KO)(tY),[w]=eA(),[k]=eT(),{getVoice:b}=eL(),{addHotkeys:C}=M(),{openBookEdit:S}=to(l),L=(0,em.s0)(),P=(0,g.useMemo)(()=>null==a?void 0:a.items[p],[p,a]),_=(0,g.useMemo)(()=>s.length?s:P?[P]:[],[P,s]);(0,g.useEffect)(()=>{let e=(null==a?void 0:a.items.length)??0,s=()=>{m(e=>e>0?e-1:0)},f=()=>{m(0)},g=()=>{m(t=>t<e-1?t+1:t)},E=()=>{m(e-1)},R=()=>{a&&v(e=>e>1?e-1:a.pageCount)},N=()=>{a&&v(1)},A=()=>{a&&v(e=>e<a.pageCount?e+1:1)},T=()=>{a&&v(a.pageCount)},I=async()=>{P&&a&&(s(),await t4(a.items,p,-1),l())},M=async()=>{P&&a&&(g(),await t4(a.items,p,1),l())},Z=e=>{r(p,e)},$=()=>{P&&d(_)},O=new tK,W=[["k",(0,j.t)("hotkey.goPrev"),s],["j",(0,j.t)("hotkey.goNext"),g],["ArrowUp",(0,j.t)("hotkey.goPrev"),s],["ArrowDown",(0,j.t)("hotkey.goNext"),g],["h",(0,j.t)("hotkey.goPagePrev"),R],["l",(0,j.t)("hotkey.goPageNext"),A],["ArrowLeft",(0,j.t)("hotkey.goPagePrev"),R],["ArrowRight",(0,j.t)("hotkey.goPageNext"),A],[["g","g"],(0,j.t)("hotkey.goTop"),f],[{shift:!0,key:"g"},(0,j.t)("hotkey.goBottom"),E],[{shift:!0,key:"h"},(0,j.t)("hotkey.goPageFirst"),N],[{shift:!0,key:"l"},(0,j.t)("hotkey.goPageLast"),T],[{shift:!0,key:"ArrowUp"},(0,j.t)("hotkey.goTop"),f],[{shift:!0,key:"ArrowDown"},(0,j.t)("hotkey.goBottom"),E],[{shift:!0,key:"ArrowLeft"},(0,j.t)("hotkey.goPageFirst"),N],[{shift:!0,key:"ArrowRight"},(0,j.t)("hotkey.goPageLast"),T],[["s",{shift:!0,key:"E"}],(0,j.t)("hotkey.listArchive"),()=>{y(e=>!e)}],[["s","b"],(0,j.t)("hotkey.listFavorite"),()=>{x(e=>!e)}],["b",(0,j.t)("hotkey.favorite"),()=>{eY(async()=>{for(let e of _)await h.r.action({uuid:e.uuid,update:{isFavorited:!e.isFavorited}});l()})}],[{shift:!0,key:"E"},(0,j.t)("hotkey.archive"),()=>{eY(async()=>{for(let e of _)await h.r.action({uuid:e.uuid,update:{isArchived:!e.isArchived}});l()})}],["/",(0,j.t)("hotkey.search"),t],[["s","s","n"],(0,j.t)("hotkey.sortOrder"),i],[["s","s","p"],(0,j.t)("hotkey.sortOrder"),n],["x",(0,j.t)("hotkey.select"),()=>Z(!1)],["v",(0,j.t)("hotkey.select"),()=>Z(!1)],[{shift:!0,key:"x"},(0,j.t)("hotkey.selectShift"),()=>Z(!0)],[{shift:!0,key:"v"},(0,j.t)("hotkey.selectShift"),()=>Z(!0)],[{shift:!0,key:"a"},(0,j.t)("hotkey.selectAll"),()=>o()],["t",(0,j.t)("hotkey.goMoveTop"),()=>{P&&c(_)}],["e",(0,j.t)("hotkey.edit"),()=>P&&S(P.uuid)],["Enter",(0,j.t)("hotkey.open"),()=>{P&&L(t6(P.uuid))}],[{shift:!0,key:"#"},(0,j.t)("hotkey.remove"),$],[["d","d"],(0,j.t)("hotkey.remove"),$],[{shift:!0,key:"K"},(0,j.t)("hotkey.speakBookName"),()=>{if(!P)return;let e=b(P);e&&O.speak(P.name,{voice:e,speed:k,isPersonReplace:w})}]];return!u&&W.push([{ctrl:!0,key:"k"},(0,j.t)("hotkey.goMovePrev"),I],[{ctrl:!0,key:"j"},(0,j.t)("hotkey.goMoveNext"),M],[{ctrl:!0,key:"ArrowUp"},(0,j.t)("hotkey.goMovePrev"),I],[{ctrl:!0,key:"ArrowDown"},(0,j.t)("hotkey.goMoveNext"),M]),C(W)},[_,p,C,P,a,t,b,u,w,c,L,S,i,n,l,d,o,r,m,y,x,v,k])}({focusSearchInput:W,orderSelectPrev:z,orderSelectNext:K,dataBooks:L,reload:P,selectTo:$,selectAll:O,selectedBooks:T,moveBooksTop:U,removeBooks:D,hasOrder:S});let H=(0,g.useCallback)((e,t)=>{if(!R)return;let n=[...R],[i]=n.splice(e,1);i&&n.splice(t,0,i),N(n)},[R]),V=(0,g.useCallback)(e=>{eY(async()=>{L&&(E(!0),await t4(L.items,e.startIndex,e.hoverIndex-e.startIndex),P(),E(!1))})},[L,P]),q=(0,g.useCallback)(()=>{A()},[A]),G=(0,g.useCallback)(e=>{A();let t=null==R?void 0:R.find(t=>t.uuid===e);t&&D([t])},[R,D,A]),J=(0,g.useMemo)(()=>!!Z.length&&(0,r.jsxs)(b.ZP.Group,{children:[(0,r.jsx)(b.ZP,{type:"primary",size:"small",onClick:()=>{eY(async()=>{await U(T),P()})},children:(0,j.t)("top")}),(0,r.jsx)(b.ZP,{type:"primary",size:"small",danger:!0,onClick:()=>{D(T)},children:(0,j.t)("remove")})]}),[U,P,D,T,Z.length]),X=(0,g.useMemo)(()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t7,{onRemove:G}),J]}),[J,G]);if(tV({topRight:X,bottomRight:(0,g.useMemo)(()=>(0,r.jsx)(eK,{to:"/books/add",children:e=>(0,r.jsx)(b.ZP,{type:"text",shape:"circle",href:e,title:(0,j.t)("add"),children:(0,r.jsx)(F,{icon:B.XSk})})}),[])}),(0,g.useEffect)(()=>{R&&(R.length<=0?e>1&&t(1):a>R.length-1&&o(R.length-1))},[a,R,e,o,t]),_||!L||!R)return(0,r.jsx)(ec,{});let Y=L.pageCount>1?(0,r.jsx)(th.Z,{onChange:e=>t(e),pageSize:n,onShowSizeChange:(e,t)=>i(t),current:e,total:L.count}):null;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(k.Z,{direction:"vertical",style:{width:"100%"},children:[(0,r.jsxs)(eU.Z,{layout:"inline",children:[(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("archive"),children:(0,r.jsx)(tp.Z,{checked:s,onChange:e=>l(e)})}),(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("favorite"),children:(0,r.jsx)(tp.Z,{checked:c,onChange:e=>u(e)})}),(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("search"),children:(0,r.jsx)(eH.Z,{value:m,placeholder:(0,j.t)("search"),onChange:e=>v(e.target.value),ref:x,onKeyDown:e=>{var t;"Escape"===e.key&&(null===(t=x.current)||void 0===t||t.blur())}})}),(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("sortOrder.label"),children:(0,r.jsx)(e2.Z,{showSearch:!0,filterOption:e6,popupMatchSelectWidth:!1,value:w,onChange:e=>C(e),options:[{label:(0,j.t)("sortOrder.item.default"),value:"default"},{label:(0,j.t)("sortOrder.item.reverse"),value:"reverse"},{label:(0,j.t)("sortOrder.item.name"),value:"name"},{label:(0,j.t)("sortOrder.item.nameReverse"),value:"name-reverse"}]})})]}),R.length<=0?(0,r.jsx)(p.Z,{type:"warning",message:(0,j.t)("prompt.noBooks")}):(0,r.jsxs)(r.Fragment,{children:[Y,(0,r.jsxs)("table",{className:t3.table,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{}),(0,r.jsx)("th",{children:(0,r.jsx)(td.Z,{title:(0,j.t)("all"),checked:I,onClick:()=>{O()}})}),(0,r.jsx)("th",{children:(0,j.t)("favorite")}),(0,r.jsx)("th",{children:(0,j.t)("cover")}),(0,r.jsx)("th",{children:(0,j.t)("bookName")}),(0,r.jsx)("th",{})]})}),(0,r.jsx)("tbody",{children:R.map((e,t)=>(0,r.jsx)(t5,{book:e,books:R,index:t,activated:a===t,onHoverMove:H,onDrop:V,onCancel:q,selectTo:$,selectedUuids:Z,reload:P,hasOrder:S},e.uuid))})]}),Y]})]})})}var nt=n("4196"),nn=n("5627"),ni=n("1636");let na=(0,C.cn)(null),nr=()=>{let[e]=(0,f.KO)(na);if(!e)throw Error("BookContext must be used within a BookProvider");return e},no="contentWrapper-xRbIAt";var ns=n("2610"),nl=n("619"),nc=n("3343"),nd=n("3844");let{defaultAlgorithm:nu,darkAlgorithm:nh}=nl.Z,np=()=>{let e=(0,ns.a)("(prefers-color-scheme: dark)"),[t]=eM();return"system"===t?e?"dark":"light":t},nf=e=>{let{children:t}=e,n=np();return(0,r.jsx)(nc.ZP,{theme:{algorithm:"dark"===n?nh:nu,components:{InputNumber:{handleVisible:!0}}},children:(0,r.jsx)(nd.Z,{className:"app",children:t})})};var ng=n("2790"),nm=n("3747"),nv=n("1479"),ny=new WeakMap;class nx{on(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={cb:e,options:{...this.defaultOptions,...t}};return(0,ng._)(this,ny).push(n),()=>{this.off(n)}}fire(e){for(let t of[...(0,ng._)(this,ny)])t.options.once&&this.off(t),Promise.resolve(t.cb(e)).catch(console.error)}off(e){let t=(0,ng._)(this,ny).findIndex(()=>e);-1!==t&&(0,ng._)(this,ny).splice(t,1)}constructor(e={}){(0,tL._)(this,"defaultOptions",void 0),(0,nm._)(this,ny,{writable:!0,value:void 0}),this.defaultOptions=e,(0,nv._)(this,ny,[])}}var nw=new WeakMap;class nk{on(e,t){let n=(0,ng._)(this,nw).get(e);return!n&&(n=new nx,(0,ng._)(this,nw).set(e,n)),n.on(t)}fire(e,t){let n=(0,ng._)(this,nw).get(e);n&&Promise.resolve(n.fire(t)).catch(console.error)}off(e){(0,ng._)(this,nw).delete(e)}constructor(){(0,nm._)(this,nw,{writable:!0,value:new Map})}}var nb=new WeakMap;class nj extends nk{on(e,t){return super.on(e,n=>t(n,(0,ng._)(this,nb).get(e)))}fire(e,t){(!(0,ng._)(this,nb).has(e)||(0,ng._)(this,nb).get(e)!==t)&&((0,ng._)(this,nb).set(e,t),super.fire(e,t))}constructor(...e){super(...e),(0,nm._)(this,nb,{writable:!0,value:new Map})}}var nC=new WeakMap,nS=new WeakMap;class nL{get started(){return(0,ng._)(this,nC).started}set started(e){(0,ng._)(this,nC).started=e,this.events.fire("started",e)}get pos(){return(0,ng._)(this,nC).pos}set pos(e){(0,ng._)(this,nC).pos=e,this.events.fire("pos",e)}set activeNavs(e){(0,ng._)(this,nC).activeNavs=e,this.events.fire("activeNavs",e)}get loading(){return(0,ng._)(this,nC).loading}set loading(e){(0,ng._)(this,nC).loading=e,this.events.fire("loading",e)}get scrollPercent(){return(0,ng._)(this,nC).scrollPercent}set scrollPercent(e){(0,ng._)(this,nC).scrollPercent=e,this.events.fire("scrollPercent",e)}get selection(){return(0,ng._)(this,nC).selection}set selection(e){(0,ng._)(this,nC).selection=e,this.events.fire("selection",e)}get annotations(){return(0,ng._)(this,nS).annotations}get keywords(){return(0,ng._)(this,nS).keywords}get voice(){return(0,ng._)(this,nS).voice}get isPersonReplace(){return(0,ng._)(this,nS).isPersonReplace}get speechSpeed(){return(0,ng._)(this,nS).speechSpeed}get autoNextSection(){return(0,ng._)(this,nS).autoNextSection}get paragraphRepeat(){return(0,ng._)(this,nS).paragraphRepeat}get pageList(){return(0,ng._)(this,nS).pageList}get fontSize(){return(0,ng._)(this,nS).fontSize}get disabledVertical(){return(0,ng._)(this,nS).disabledVertical}get docVisible(){return"visible"===document.visibilityState}get canManipulateDOM(){return this.docVisible||!ew.tq}syncUIState(e,t){(0,ng._)(this,nS)[e]=t,this.uiEvents.fire(e,t)}constructor(){(0,nm._)(this,nC,{writable:!0,value:{started:!1,pos:{section:0,paragraph:0},activeNavs:[],loading:!1,scrollPercent:void 0,selection:void 0}}),(0,tL._)(this,"events",new nj),(0,nm._)(this,nS,{writable:!0,value:{annotations:[],keywords:[],isPersonReplace:!1,speechSpeed:1,voice:null,autoNextSection:!1,paragraphRepeat:1,pageList:"double",fontSize:16,disabledVertical:!1}}),(0,tL._)(this,"uiEvents",new nj)}}var nP=n("9154"),n_=n("1142"),nE=n("9315"),nR=n("4410"),nN=n("8872"),nA=n("8049");function nT(e){if(ew.tq){let t=1;return void 0!==e.step&&("number"==typeof e.step?t=e.step:"string"==typeof e.step&&(t=parseFloat(e.step))),(0,r.jsxs)(k.Z.Compact,{children:[(0,r.jsx)(b.ZP,{size:e.size,onClick:()=>{var n;let i=e.value??0;null===(n=e.onChange)||void 0===n||n.call(e,i-t)},children:(0,r.jsx)(W.G,{icon:B.r5q})}),(0,r.jsx)(nA.Z,{...e}),(0,r.jsx)(b.ZP,{size:e.size,onClick:()=>{var n;let i=e.value??0;null===(n=e.onChange)||void 0===n||n.call(e,i+t)},children:(0,r.jsx)(W.G,{icon:B.FPD})})]})}return(0,r.jsx)(nA.Z,{...e})}function nI(e){let{children:t}=e;return(0,r.jsx)(ez,{dir:"row",gap:8,style:{alignItems:"center",width:"100%"},children:t})}function nM(e){let{style:t,children:n}=e;return(0,r.jsx)(e0.Z,{style:{alignSelf:"start",...t},children:n})}let nZ=()=>{let[e,t]=eE();return(0,r.jsx)(nI,{children:(0,r.jsx)(td.Z,{checked:e,onChange:e=>t(e.target.checked),children:(0,j.t)("setting.autoNextSection")})})},n$=()=>{let[e,t]=eR(),[n,i]=eN();return(0,r.jsxs)(nI,{children:[(0,r.jsx)(td.Z,{checked:e,onChange:e=>{t(e.target.checked)},children:(0,j.t)("setting.timer")}),(0,r.jsx)(nT,{style:{width:"80px"},disabled:!e,value:Math.floor(n/60),onChange:e=>{null!==e&&i(Math.floor(60*e))}})]})};function nO(e){let{checked:t,onChange:n}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(td.Z,{checked:t,onChange:e=>{n(e.target.checked)},children:(0,j.t)("setting.personReplace")}),(0,r.jsx)(nP.Z,{style:{pointerEvents:"none"},content:(0,r.jsx)(nE.Z,{children:Object.entries(y.i9).map((e,t)=>{let[n,i]=e;return(0,r.jsx)(nE.Z.Item,{children:(0,r.jsxs)(k.Z,{children:[n,(0,r.jsx)(F,{icon:B.eFW}),i.word," (",i.pinyin,")"]})},t)})}),children:(0,r.jsx)("div",{children:(0,r.jsx)(F,{size:"lg",icon:B.Fuz})})})]})}let nW=()=>{let[e,t]=eA();return(0,r.jsx)(nI,{children:(0,r.jsx)(nO,{checked:e,onChange:e=>{t(e)}})})};function nF(){let[e,t]=eF();return(0,r.jsx)(nI,{children:(0,r.jsx)(td.Z,{checked:e,onChange:e=>{t(e.target.checked)},children:(0,j.t)("setting.disabledVertical")})})}let nB=()=>{let[e,t]=eT();return(0,r.jsxs)(nI,{children:[(0,r.jsx)(nM,{children:(0,j.t)("setting.speed")}),(0,r.jsxs)(ez,{style:{flex:1},children:[(0,r.jsx)(nR.Z,{value:e,onChange:e=>{t(e)},step:.1,min:.1,max:5}),(0,r.jsx)(nT,{type:"number",value:e,step:.1,onChange:e=>{null!==e&&t(e)}})]})]})},nz=()=>{let[e,t]=eM();return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(nI,{children:[(0,r.jsx)(nM,{style:{paddingTop:"4px"},children:(0,j.t)("setting.userColorScheme")}),(0,r.jsx)(nN.ZP.Group,{value:e,onChange:e=>{t(e.target.value)},children:(0,r.jsx)(k.Z,{direction:"vertical",children:eI.map(e=>(0,r.jsx)(nN.ZP,{value:e,children:(0,j.t)(e)},e))})})]})})},nK=()=>{let[e,t]=eZ();return(0,r.jsxs)(nI,{children:[(0,r.jsxs)("span",{children:[(0,j.t)("setting.paragraphRepeat"),":"]}),(0,r.jsx)(nT,{style:{width:80},value:e,onChange:e=>{e&&t(e<1?1:Math.floor(e))}})]})};function nD(){let[e,t]=eO();return(0,r.jsxs)(nI,{children:[(0,r.jsx)(nM,{style:{paddingTop:"4px"},children:(0,j.t)("setting.pageList")}),(0,r.jsx)(nN.ZP.Group,{value:e,onChange:e=>{t(e.target.value)},children:(0,r.jsx)(k.Z,{direction:"vertical",children:e$.map(e=>(0,r.jsx)(nN.ZP,{value:e,children:(0,j.t)(`setting.pageListType.${e}`)},e))})})]})}function nU(){let[e,t]=eW();return(0,r.jsxs)(nI,{children:[(0,r.jsx)("span",{children:(0,j.t)("setting.fontSize")}),(0,r.jsx)(nT,{style:{width:80},value:e,onChange:e=>{null!==e&&t(e<1?1:Math.floor(e))}})]})}let nH=()=>(0,r.jsxs)(k.Z,{direction:"vertical",children:[(0,r.jsx)(nZ,{}),(0,r.jsx)(n$,{}),(0,r.jsx)(nW,{}),(0,r.jsx)(nF,{}),(0,r.jsx)(nB,{}),(0,r.jsx)(nz,{}),(0,r.jsx)(nK,{}),(0,r.jsx)(nD,{}),(0,r.jsx)(nU,{})]});var nV=n("7291");let nq={bookSearchResult:"bookSearchResult-wN3fTI"},nG=(0,C.cn)(!1),nJ={};function nX(){return(0,g.useCallback)(async e=>{var t;null===(t=nJ.callback)||void 0===t||t.call(nJ,e)},[])}function nY(e){let{open:t,player:n,searchResponse:i}=e,[a,o]=(0,g.useState)(0),s=(0,g.useRef)(null),l=(0,g.useCallback)(async e=>{await n.gotoPos({section:e.section,paragraph:e.paragraph})},[n]);(0,g.useEffect)(()=>{if(a<0)return;let e=s.current;if(!e)return;let t=e.querySelector("li.text.selected");null==t||t.scrollIntoView({block:"center"})},[a]);let{addHotkeys:c}=M();if((0,g.useEffect)(()=>{if(!t||!i)return;let e=i.matches,n=async()=>{let t=e.at(a);t&&await l(t)};return c([["p",(0,j.t)("hotkey.prevSearchResult"),()=>{o(e=>e<=0?0:e-1)}],["n",(0,j.t)("hotkey.nextSearchResult"),()=>{o(t=>t>=e.length-1?e.length-1:t+1)}],["enter",(0,j.t)("hotkey.gotoSearchResult"),n]],{level:2})},[c,l,t,i,a]),!i)return null;if(0===i.matches.length)return(0,r.jsx)(p.Z,{type:"warning",message:(0,j.t)("prompt.noSearchMatches")});let d=i.search.length;return(0,r.jsxs)("div",{className:nq.bookSearchResult,ref:s,children:[(0,r.jsx)("ul",{children:i.matches.map((e,t)=>{let n=["text","clickable"];t===a&&n.push("selected");let s=e.text.slice(0,e.start),c=e.text.slice(e.start+d);return(0,r.jsxs)("li",{className:n.join(" "),onClick:()=>{l(e),o(t)},children:[e.nav&&(0,r.jsx)("strong",{children:e.nav}),(0,r.jsxs)("div",{children:[s,(0,r.jsx)("span",{className:"highlight",children:i.search}),c]})]},t)})}),(0,r.jsxs)("div",{className:"stats",children:[a+1," / ",i.matches.length]})]})}function nQ(e){let{refSearchInput:t,player:n}=e,[i,a]=(0,f.KO)(nG),{uuid:o}=nr(),[s,l]=(0,g.useState)(""),[c,d]=(0,g.useState)(!1),[h,p]=(0,g.useState)(null),m=nX();return nJ.callback=(0,g.useCallback)(async e=>{var n;if(a(!0),l(e),!c)p(null),d(!0),p(await u.g.action({uuid:o,search:e})),d(!1),null===(n=t.current)||void 0===n||n.blur()},[c,t,a,o]),(0,ed.n)(()=>{setTimeout(()=>{t.current&&t.current.focus()},100)}),(0,r.jsxs)(ez,{style:{width:"100%",height:"100%"},gap:8,children:[(0,r.jsxs)(ez,{dir:"row",gap:8,children:[(0,r.jsx)(eH.Z,{className:"flex-1",ref:t,value:s,onChange:e=>l(e.target.value),onKeyDown:e=>{if("Escape"===e.key){var n;(0,L.lJ)(e),null===(n=t.current)||void 0===n||n.blur()}else"Enter"===e.key&&m(s)}}),(0,r.jsx)(b.ZP,{onClick:()=>{m(s)},loading:c,children:(0,r.jsx)(W.G,{icon:B.wn1})})]}),(0,r.jsx)(nY,{open:i,player:n,searchResponse:h})]})}function n0(e){let{player:t}=e,[n,i]=(0,f.KO)(nG),a=(0,g.useRef)(null),o=(0,g.useCallback)(()=>{i(!0),setTimeout(()=>{var e;null===(e=a.current)||void 0===e||e.focus()},100)},[i]),{addHotkeys:s}=M();return(0,g.useEffect)(()=>s([["/",(0,j.t)("search"),o]],{level:2}),[s,o]),O(()=>{i(!1)},{enable:n}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.ZP,{block:!0,type:"primary",icon:(0,r.jsx)(W.G,{icon:B.wn1}),onClick:()=>{o()},children:(0,j.t)("search")}),(0,r.jsx)(nV.Z,{forceRender:!0,title:(0,j.t)("search"),open:n,onClose:()=>i(!1),children:(0,r.jsx)(nQ,{refSearchInput:a,player:t})})]})}var n1=n("6903");let n3=e=>({position:"absolute",top:0,width:e.width+10,height:"100%",display:"flex",justifyContent:"center",alignItems:"center",color:e.color??"var(--main-fg-blue)",background:e.background??"var(--main-bg-blue)",opacity:0});function n2(e){let{children:t,left:n,right:i}=e,a=(0,g.useRef)(null),[o,s]=(0,g.useState)(),[l,c]=(0,g.useState)();return(0,g.useEffect)(()=>{if(a.current)return function(e,t){let{left:n,leftElement:i,right:a,rightElement:r}=t;if(!n&&!a)return;let o=null,s=null,l=e=>{let{clientX:t,clientY:n}=e;return[t,n]},c=e=>{e.touches[0]&&(o={x:e.touches[0].clientX,y:e.touches[0].clientY},s=0)},d=t=>{if(!o)return;let c=t.touches[0];if(!c)return;let[d,u]=l(c),h=d-o.x,p=Math.abs(h);if(!(Math.abs(u-o.y)>30)){if(p>5&&(0,L.lJ)(t),n&&i&&h>0){let t=Math.min(p,n.width+10);s=t,e.style.transform=`translateX(${t}px)`,i.style.opacity=p>n.width?"1":"0.5"}else if(a&&r&&h<0){let t=Math.min(p,a.width+10);s=-t,e.style.transform=`translateX(${-t}px)`,r.style.opacity=p>a.width?"1":"0.5"}}},u=()=>{if(!!o)o=null,e.style.transform="",i&&(i.style.opacity="0"),r&&(r.style.opacity="0"),s&&(n&&s>n.width?n.trigger():a&&r&&s<-a.width&&a.trigger(),s=null)};return e.addEventListener("touchstart",c),e.addEventListener("touchmove",d),e.addEventListener("touchend",u),()=>{e.removeEventListener("touchstart",c),e.removeEventListener("touchmove",d),e.removeEventListener("touchend",u)}}(a.current,{left:n,leftElement:o,right:i,rightElement:l})},[n,o,i,l]),(0,r.jsxs)("div",{style:{position:"relative",willChange:"transform"},ref:a,children:[n&&(0,r.jsx)("div",{ref:e=>s(e??void 0),className:"swipe-left-node",style:{...n3(n),right:"100%"},children:n.node}),t,i&&(0,r.jsx)("div",{ref:e=>c(e??void 0),className:"swipe-right-node",style:{...n3(i),left:"100%"},children:i.node})]})}function n6(e){let{annotation:t,openNoteEdit:n,isSelected:i,isActivated:a,player:o}=e,s=["text","clickable"];a&&s.push("active"),i&&s.push("selected");let l=[{key:"note",icon:(0,r.jsx)(F,{icon:B.Ykk,size:"sm"}),label:(0,j.t)("note"),onClick:()=>{n(t,o)}},{key:"remove",icon:(0,r.jsx)(F,{icon:B.$aW,size:"sm"}),label:(0,j.t)("remove"),onClick:()=>{o.annotations.remove(t)}}];return(0,r.jsx)("li",{"data-pos-section":t.pos.section,"data-pos-paragraph":t.pos.paragraph,children:(0,r.jsx)(n2,{left:{node:(0,r.jsx)(F,{icon:B.Ykk,size:"sm"}),width:30,trigger:()=>{n(t,o)}},right:{node:(0,r.jsx)(F,{icon:B.$aW,size:"sm"}),width:30,trigger:()=>{o.annotations.remove(t)}},children:(0,r.jsx)(tc.Z,{menu:{items:l},trigger:["contextMenu"],children:(0,r.jsxs)("div",{className:"item",children:[(0,r.jsxs)("div",{className:s.join(" "),style:{fontSize:13},onClick:e=>{(0,L.lJ)(e),o.gotoSection(t.pos.section,t.pos.paragraph).catch(console.error)},children:[t.brief,t.range&&(0,r.jsx)("div",{className:"range",children:(0,r.jsx)("span",{className:"selected-text",children:t.range.selectedText})}),t.note&&(0,r.jsxs)("div",{className:"note",children:["note: ",t.note]})]}),!ew.tq&&(0,r.jsx)("div",{className:"btn",children:(0,r.jsx)(tc.Z,{menu:{items:l},children:(0,r.jsx)("div",{children:(0,r.jsx)(F,{icon:B.Uwo,style:{paddingLeft:"8px",paddingRight:"8px"}})})})})]})})})})}function n4(e){let{annotations:t,activeAnnotationIndex:n,closestAnnotationIndex:i,player:a}=e,{addHotkeys:o}=M(),[s,l]=(0,g.useState)(0),c=(0,g.useRef)(null),{openNoteEdit:d,NoteEditDialog:u}=function(e){let{player:t}=e,[n,i]=(0,g.useState)(null),[a,o]=(0,g.useState)();(0,g.useEffect)(()=>{n&&o(n.note)},[n]);let s=(0,g.useCallback)(()=>{n&&t.annotations.upsert({pos:n.pos,range:n.range,uuid:n.uuid},{color:n.color,group:n.group,note:a}),i(null)},[n,a,t.annotations]),l=(0,g.useCallback)(()=>{i(null)},[]);return{openNoteEdit:i,NoteEditDialog:(0,r.jsxs)(w.Z,{open:!!n,onCancel:l,footer:!1,title:`${(0,j.t)("annotation")} ${(0,j.t)("note")}`,children:[(0,r.jsx)(e0.Z,{children:null==n?void 0:n.brief}),(0,r.jsxs)("form",{onSubmit:e=>{(0,L.lJ)(e),s()},children:[(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("note"),children:(0,r.jsx)(ez,{gap:8,children:(0,r.jsx)(e9,{autoFocus:!0,value:a,onChange:e=>o(e.target.value)})})}),(0,r.jsx)(eU.Z.Item,{children:(0,r.jsx)(b.ZP,{type:"primary",htmlType:"submit",children:(0,j.t)("update")})})]})]})}}({player:a}),h=(0,g.useMemo)(()=>null==t?void 0:t.at(s),[t,s]),p=(0,g.useCallback)(async()=>{h&&await a.annotations.remove(h)},[a.annotations,h]);return(0,g.useEffect)(()=>o([["p",(0,j.t)("hotkey.prevAnnotation"),()=>{l(e=>e<=0?0:e-1)}],["n",(0,j.t)("hotkey.nextAnnotation"),()=>{t&&l(e=>e>=t.length-1?t.length-1:e+1)}],["enter",(0,j.t)("hotkey.gotoAnnotation"),()=>{let e=null==t?void 0:t[s];e&&a.gotoSection(e.pos.section,e.pos.paragraph).catch(console.error)}],[["d","b"],(0,j.t)("hotkey.annotationRemoveSelected"),()=>p()],[["g","n"],(0,j.t)("hotkey.annotationNote"),()=>d(h??null)],[{shift:!0,key:"K"},(0,j.t)("hotkey.speakAnnotation"),()=>{h&&a.utterer.speakText(h.brief).catch(console.error)}]]),[o,t,d,a,p,h,s]),(0,g.useEffect)(()=>{null!==i&&l(i)},[i]),(0,g.useEffect)(()=>{if(!h)return;let e=c.current;if(!e)return;let t=e.querySelector("div.text.selected");null==t||t.scrollIntoView({block:"center"})},[h]),(0,r.jsxs)("div",{className:"panel-content book-annotations",ref:c,children:[(null==t?void 0:t.length)?(0,r.jsx)("ul",{children:t.map((e,t)=>(0,r.jsx)(n6,{annotation:e,openNoteEdit:d,isActivated:n===t,isSelected:s===t,player:a},t))}):(0,j.t)("desc.annotationsEmpty"),u]})}function n8(e){let{navs:t,activeNavs:n,selectedNav:i,player:a}=e;return t.length?(0,r.jsx)("ul",{children:t.map((e,t)=>{let o=i===e,s=void 0!==e.spineIndex&&n.includes(e),l=["text"];return s&&l.push("active"),e.href&&l.push("clickable"),o&&l.push("selected"),(0,r.jsxs)("li",{"data-href":e.href,"data-spine-index":e.spineIndex,children:[(0,r.jsx)("div",{className:"item",onClick:t=>{(0,L.lJ)(t),e.href&&a.gotoUrlPath(e.href).catch(console.error)},children:(0,r.jsx)("div",{className:l.join(" "),children:e.label})}),(0,r.jsx)(n8,{navs:e.children,activeNavs:n,selectedNav:i,player:a})]},t)})}):null}function n9(e){let{book:t,activeNavs:n,player:i}=e,{addHotkeys:a}=M(),o=(0,g.useRef)(null),[s,l]=(0,g.useState)(0),c=(0,g.useMemo)(()=>t.flattenedNavs[s],[t.flattenedNavs,s]);(0,g.useEffect)(()=>a([["p",(0,j.t)("hotkey.prevNav"),()=>{l(e=>e<=0?0:e-1)}],["n",(0,j.t)("hotkey.nextNav"),()=>{l(e=>e>=t.flattenedNavs.length-1?t.flattenedNavs.length-1:e+1)}],["enter",(0,j.t)("hotkey.gotoNav"),()=>{(null==c?void 0:c.href)&&i.gotoUrlPath(c.href).catch(console.error)}],[{shift:!0,key:"K"},(0,j.t)("hotkey.speakNav"),()=>{c&&i.utterer.speakText(c.label).catch(console.error)}]]),[a,t.flattenedNavs,i,c]);let d=(0,g.useMemo)(()=>null==n?void 0:n.at(-1),[n]);return(0,g.useEffect)(()=>{if(void 0===d)return;let e=t.flattenedNavs.indexOf(d);-1!==e&&l(e)},[t.flattenedNavs,d]),(0,g.useEffect)(()=>{if(!c)return;let e=o.current;if(!e)return;let t=e.querySelector("div.text.selected");null==t||t.scrollIntoView({block:"center"})},[c]),(0,r.jsx)("div",{ref:o,className:"panel-content book-nav",children:t.navs.length?(0,r.jsx)(n8,{navs:t.navs,activeNavs:n??[],selectedNav:c,player:i}):(0,j.t)("desc.navEmpty")})}var n5=n("6049");function n7(e){let{keyword:t,openEdit:n,isSelected:i,player:a}=e,o=nX(),s=["text","clickable"];i&&s.push("selected");let l=[{key:"note",icon:(0,r.jsx)(F,{icon:B.Ykk,size:"sm"}),label:(0,j.t)("note"),onClick:()=>{n(t,a)}},{key:"remove",icon:(0,r.jsx)(F,{icon:B.$aW,size:"sm"}),label:(0,j.t)("remove"),onClick:()=>{a.keywords.remove(t)}},{key:"search",icon:(0,r.jsx)(F,{icon:B.wn1,size:"sm"}),label:(0,j.t)("search"),onClick:()=>{o(t.keyword)}}];return(0,r.jsx)("li",{children:(0,r.jsx)(n2,{left:{node:(0,r.jsx)(F,{icon:B.Ykk,size:"sm"}),width:30,trigger:()=>{n(t,a)}},right:{node:(0,r.jsx)(F,{icon:B.$aW,size:"sm"}),width:30,trigger:()=>{a.keywords.remove(t)}},children:(0,r.jsx)(tc.Z,{menu:{items:l},trigger:["contextMenu"],children:(0,r.jsxs)("div",{className:"item",children:[(0,r.jsxs)("div",{className:s.join(" "),style:{fontSize:13},onClick:e=>{(0,L.lJ)(e),a.gotoSection(t.pos.section,t.pos.paragraph).catch(console.error)},children:[t.keyword,t.alias&&(0,r.jsx)("div",{className:"alias",children:(0,r.jsx)(k.Z,{wrap:!0,children:t.alias.map((e,t)=>(0,r.jsx)("span",{className:"selected-text",children:e},t))})}),(0,r.jsx)("div",{className:"range",children:(0,r.jsx)("span",{className:"selected-text",children:t.brief})}),t.note&&(0,r.jsxs)("div",{className:"note",children:["note: ",t.note]})]}),(0,r.jsx)("div",{className:"btn",children:(0,r.jsx)(tc.Z,{menu:{items:l},children:(0,r.jsx)("div",{children:(0,r.jsx)(F,{icon:B.Uwo,style:{paddingLeft:"8px",paddingRight:"8px"}})})})})]})})})})}function ie(e){let{keywords:t,player:n}=e,{addHotkeys:i}=M(),[a,o]=(0,g.useState)(0),s=(0,g.useRef)(null),{openEdit:l,EditDialog:c}=function(e){let{player:t}=e,[n,i]=(0,g.useState)(null),[a,o]=(0,g.useState)(),[s,l]=(0,g.useState)();(0,g.useEffect)(()=>{var e;n&&(o(null===(e=n.alias)||void 0===e?void 0:e.join("\n")),l(n.note))},[n]);let c=(0,g.useCallback)(()=>{n&&t.keywords.upsert({pos:n.pos,uuid:n.uuid,keyword:n.keyword},{color:n.color,note:s,alias:null==a?void 0:a.split("\n").map(e=>e.trim()).filter(e=>e)}),i(null)},[a,n,s,t.keywords]),d=(0,g.useCallback)(()=>{i(null)},[]);return{openEdit:i,EditDialog:(0,r.jsxs)(w.Z,{open:!!n,onCancel:d,footer:!1,title:`${(0,j.t)("keyword")} ${(0,j.t)("note")}`,children:[(0,r.jsx)(e0.Z,{children:null==n?void 0:n.keyword}),(0,r.jsxs)("form",{onSubmit:e=>{(0,L.lJ)(e),c()},children:[(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("alias"),children:(0,r.jsx)(ez,{gap:8,children:(0,r.jsx)(e9,{autoFocus:!0,value:a,onChange:e=>o(e.target.value)})})}),(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("note"),children:(0,r.jsx)(ez,{gap:8,children:(0,r.jsx)(e9,{value:s,onChange:e=>l(e.target.value)})})}),(0,r.jsx)(eU.Z.Item,{children:(0,r.jsx)(b.ZP,{type:"primary",htmlType:"submit",children:(0,j.t)("update")})})]})]})}}({player:n}),d=(0,g.useMemo)(()=>null==t?void 0:t.at(a),[t,a]),u=(0,g.useCallback)(async()=>{d&&await n.keywords.remove(d)},[n.keywords,d]);return(0,g.useEffect)(()=>i([["p",(0,j.t)("hotkey.prevKeyword"),()=>{o(e=>e<=0?0:e-1)}],["n",(0,j.t)("hotkey.nextKeyword"),()=>{t&&o(e=>e>=t.length-1?t.length-1:e+1)}],["enter",(0,j.t)("hotkey.gotoKeyword"),()=>{let e=null==t?void 0:t[a];e&&n.gotoSection(e.pos.section,e.pos.paragraph).catch(console.error)}],[["d","b"],(0,j.t)("hotkey.keywordRemoveSelected"),()=>u()],[["g","n"],(0,j.t)("hotkey.keywordNote"),()=>l(d??null)],[{shift:!0,key:"K"},(0,j.t)("hotkey.speakKeyword"),()=>{d&&n.utterer.speakText(d.keyword).catch(console.error)}]]),[i,t,l,n,u,d,a]),(0,g.useEffect)(()=>{if(!d)return;let e=s.current;if(!e)return;let t=e.querySelector("div.text.selected");null==t||t.scrollIntoView({block:"center"})},[d]),(0,r.jsxs)("div",{className:"panel-content book-keywords",ref:s,children:[(null==t?void 0:t.length)?(0,r.jsx)("ul",{children:t.map((e,t)=>(0,r.jsx)(n7,{keyword:e,openEdit:l,isSelected:a===t,player:n},t))}):(0,j.t)("desc.keywordsEmpty"),c]})}function it(e){return(0,r.jsx)(b.ZP,{style:{padding:"14px 4px"},size:"small",type:"primary",...e})}function ii(e){let{hotkey:t,description:n,...i}=e,a=(0,g.useMemo)(()=>(0,r.jsxs)(k.Z,{children:[n,t?(0,r.jsx)("span",{className:"keyboard",children:t}):null]}),[n,t]);return(0,r.jsx)(nP.Z,{style:{pointerEvents:"none"},content:ew.tq?null:a,placement:"top",children:(0,r.jsx)(it,{...i})})}function ia(e){let{started:t,player:n,stopTimerEnabled:i,stopTimerSeconds:a}=e,o=(0,g.useRef)(),[s,l]=(0,g.useState)(0),[c,d]=(0,g.useState)(a);(0,g.useEffect)(()=>{let e;if(!t||!i)return;if(!s)return l(e=>e+1);let r=o.current??0,c=Date.now()/1e3;let u=()=>{let t=Date.now()/1e3-c+r;o.current=t;let i=a-t;if(i<=0){n.pause(),o.current=0,e&&clearInterval(e),d(0);return}d(i)};return u(),e=setInterval(u,1e3),()=>{clearInterval(e)}},[s,n,t,i,a]);let u=(0,g.useMemo)(()=>`${Math.floor(c/60).toString().padStart(2,"0")}
      :${(c%60).toFixed(0).padStart(2,"0")}`,[c]);return i?(0,r.jsx)(tu.Z,{onClick:()=>{o.current=0,l(e=>e+1),d(a)},children:u}):(0,r.jsx)(r.Fragment,{})}function ir(){let{book:e,reload:t}=nr(),{openBookEdit:n}=to(t),{addHotkey:i}=M();return(0,g.useEffect)(()=>i("e",(0,j.t)("hotkey.editBook"),()=>{n(e.item.uuid)},{level:100}),[i,e.item.uuid,n]),(0,r.jsx)(b.ZP,{block:!0,type:"primary",onClick:()=>n(e.item.uuid),children:(0,j.t)("editBook")})}function io(){let{book:e}=nr(),{voiceURI:t,setVoiceURI:n,allSortedVoices:i}=e_(e.item),a=(0,g.useMemo)(()=>i.map(e=>({label:e.name,value:e.voiceURI})),[i]);return(0,r.jsx)(nI,{children:(0,r.jsx)(e2.Z,{showSearch:!0,filterOption:e6,popupMatchSelectWidth:!1,style:{width:"100%"},value:t,onChange:e=>n(e),options:a})})}var is=n("4450"),il=n.n(is),ic=n("2218"),id=n("8954");class iu{async upsert(e,t){var n;let{uuid:i,pos:a,range:r}=e,{note:o,color:s,group:l}=t,c=this.player.iframeCtrler.readableParts.at(a.paragraph);if(!c)return;if("text"!==c.type){(0,J.c1)().error((0,j.t)("desc.annotationNoSupported"));return}let d=c.text.slice(0,30),u=await id.I.action({annotations:[{uuid:i,pos:a,range:r??void 0,brief:d,type:"text",content:c.text,note:o||void 0,color:s,group:l}],uuid:this.uuid});return null===(n=this.reload)||void 0===n||n.call(this),(0,J.c1)().info(`${(0,j.t)("desc.annotationUpdated")} ${d}`),u.annotations.at(0)}async remove(e){var t;if(e.note||e.range){let t=e.color?il()(e.color,{black:"#3a3a3a",white:"#fafafa"}):"var(--main-fg-blue)";if(!await K({title:(0,j.t)("prompt.annotationRemoveConfirm"),description:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{children:e.brief}),e.note&&(0,r.jsxs)("p",{children:["Note: ",e.note]}),e.range&&(0,r.jsxs)("p",{children:["Selected:"," ",(0,r.jsx)("span",{style:{backgroundColor:e.color??"var(--main-bg-blue)",color:t},children:e.range.selectedText})]})]})}))return}await ic.v.action({uuid:this.uuid,annotationUuids:[e.uuid]}),null===(t=this.reload)||void 0===t||t.call(this),(0,J.c1)().info(`${(0,j.t)("desc.annotationDeleted")} ${e.brief}`)}indexByPos(e,t){let n=this.player.states.annotations;if(!n)return null;let i=n.findIndex(n=>{var i,a;return n.pos.section===e.section&&n.pos.paragraph===e.paragraph&&(null===(i=n.range)||void 0===i?void 0:i.start)===(null==t?void 0:t.start)&&(null===(a=n.range)||void 0===a?void 0:a.end)===(null==t?void 0:t.end)});return -1===i?null:i}closestIndexByPos(e){let t=this.player.states.annotations;if(!t)return null;let n=t.findLastIndex(t=>t.pos.section===e.section&&t.pos.paragraph<=e.paragraph);return -1===n?null:n}byPos(e,t){var n;let i=this.indexByPos(e,t);return null===i?null:(null===(n=this.player.states.annotations)||void 0===n?void 0:n.at(i))??null}async toggle(e,t){let n=this.byPos(e,t);n?await this.remove(n):await this.upsert({pos:e,range:t,uuid:null},{})}constructor(e){(0,tL._)(this,"player",void 0),(0,tL._)(this,"uuid",void 0),(0,tL._)(this,"reload",void 0),this.player=e,this.uuid=e.book.item.uuid}}var ih=n("4667");let ip=new tv.p("books/render",{method:"get",isDynamic:!0}).routeLogined(async e=>{let{req:t,res:n,userInfo:i}=e,[a,...r]=t.paths;if(!a)throw new ty.xx("uuid not found");let o=await tm.E.book(i.account,a),s=decodeURI(eq().join(...r)),l=await o.file(s);if(!l)throw new ty.xx("Path in book not found");let c=l.mediaType??ih.contentType(eq().basename(s));return c&&n.header("Content-Type",c),l.buffer}),ig=(e,t)=>eq().join(ip.fullRoutePath,e,t);var im=n("3309");async function iv(e,t){let{iteration:n=10,duration:i=100,abortCtrl:a}=e,r=!1;null==a||a.signal.addEventListener("abort",()=>{r=!0});let o=i/n;for(let e of(0,S.w6)(0,n+1)){if(await eQ(o),r)break;await t(e)}}var iy=n("7791");let ix=`
  :root {
    --main-bg: white;
    --main-bg-active: #ddd;
    --main-bg-hover: #e3e3e3;
    --main-fg: #111;
    --main-fg-active: #111;
    --main-fg-hover: #111;
    --main-border: #666;
    --main-bg-blue: #03c;
    --main-fg-blue: #DDD;
    --main-bg-highlight: rgba(10, 120, 220, 0.3);
    --main-fg-highlight: var(--main-fg);
  }
  :root.${y.JK}  {
    --main-bg: #1a1b1e;
    --main-bg-active: #555;
    --main-bg-hover: #444;
    --main-fg: #ccc;
    --main-fg-active: #ccc;
    --main-fg-hover: #ccc;
    --main-border: #777;
  }
`;var iw=n("1754"),ik=n("8669"),ib=new WeakMap,ij=new WeakMap,iC=new WeakSet,iS=new WeakSet,iL=new WeakMap,iP=new WeakSet,i_=new WeakSet,iE=new WeakSet;class iR{get doc(){return this.iframeCtrl.doc}reCreateRoot(e){e.querySelectorAll(`.${this.rootClass}`).forEach(e=>e.remove()),(0,nv._)(this,ib,e.createElement("div")),(0,ng._)(this,ib).classList.add(this.rootClass),e.documentElement.appendChild((0,ng._)(this,ib)),(0,ng._)(this,ij).clear()}highlight(e,t){this.iframeCtrl.tryManipulateDOM(()=>{(0,iw._)(this,iE,iM).call(this,e,t)}).catch(console.error)}highlightHide(){this.iframeCtrl.tryManipulateDOM(()=>{(0,iw._)(this,iC,iN).call(this)}).catch(console.error)}constructor(e,t){var n;let i;(0,ik._)(this,iC),(0,ik._)(this,iS),(0,ik._)(this,iP),(0,ik._)(this,i_),(0,ik._)(this,iE),(0,tL._)(this,"iframeCtrl",void 0),(0,tL._)(this,"states",void 0),(0,tL._)(this,"highlightedElems",void 0),(0,nm._)(this,ib,{writable:!0,value:void 0}),(0,nm._)(this,ij,{writable:!0,value:void 0}),(0,nm._)(this,iL,{writable:!0,value:void 0}),this.iframeCtrl=e,this.states=t,this.highlightedElems=[],(0,nv._)(this,ij,new Map);(0,nv._)(this,iL,(n=e=>{if(!!this.doc){if(e.length){if(this.iframeCtrl.enabledPageList){let t=(0,S.Sm)(e.map(e=>e.left))/e.length;this.iframeCtrl.pageListScrollToLeft(t).catch(console.error)}else if(this.iframeCtrl.isVertical){let t=(0,S.Sm)(e.map(e=>e.right))/e.length;this.iframeCtrl.scrollToRight(t).catch(console.error)}else{let t=(0,S.Sm)(e.map(e=>e.top))/e.length;this.iframeCtrl.scrollToTop(t).catch(console.error)}}}},i=!1,function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];if(!i){let e=n(...t);return i=!0,setTimeout(()=>i=!1,1e3),e}}))}}function iN(){let e=(0,ng._)(this,ib);e&&Array.from(e.children).forEach(e=>{e.style.display="none"})}function iA(e,t){let n=this.doc,i=(0,ng._)(this,ib);if(!n||!i)return;let a=(e,t)=>{let a=(0,ng._)(this,ij).get(e);return!a&&(a=n.createElement("div"),t&&(a.style.backgroundColor=t),(0,ng._)(this,ij).set(e,a),i.appendChild(a)),a},r=n.documentElement.getBoundingClientRect(),o=e.map(e=>[...e.range.getClientRects()].map(e=>({width:e.width,height:e.height,left:e.left-r.left,right:e.right-r.right,top:e.top-r.top,bottom:e.bottom-r.top}))).flat();for(let[e,t]of((0,iw._)(this,iC,iN).call(this),o.entries())){let n=a(e,t.color);n.style.display="block",n.style.top=`${t.top}px`,n.style.left=`${t.left}px`,n.style.width=`${t.width}px`,n.style.height=`${t.height}px`}t&&(0,ng._)(this,iL).call(this,o)}function iT(e,t){if(!e.childNodes.length)return{type:1,remainIndex:t};let n=t;for(let t of e.childNodes){if((0,L.BM)(t)){if(!t.textContent)continue;if(n<=t.textContent.length)return{type:0,node:t,index:n};n-=t.textContent.length;continue}if(this.ignoreClass&&(0,L.kK)(t)&&t.closest(`.${this.ignoreClass}`))continue;let e=(0,iw._)(this,iP,iT).call(this,t,n);switch(e.type){case 0:return e;case 1:n=e.remainIndex;continue}}return{type:1,remainIndex:n}}function iI(e,t){let n=(0,iw._)(this,iP,iT).call(this,e,t);return 0===n.type?n:null}function iM(e,t){if(!this.doc)return;let n=[];for(let t of e){let{node:e,charIndex:i,charLength:a,color:r}=t,o=document.createRange(),s=(0,iw._)(this,i_,iI).call(this,e.elem,i);if(!s)continue;let l=(0,iw._)(this,i_,iI).call(this,e.elem,i+a);if(l){try{o.setStart(s.node,s.index),o.setEnd(l.node,l.index)}catch(e){console.error(e);continue}n.push({range:o,color:r})}}(0,iw._)(this,iS,iA).call(this,n,t)}class iZ extends iR{constructor(...e){super(...e),(0,tL._)(this,"rootClass",y.pJ),(0,tL._)(this,"ignoreClass",null)}}class i$ extends iR{constructor(...e){super(...e),(0,tL._)(this,"rootClass",y.TO),(0,tL._)(this,"ignoreClass",null)}}var iO=new WeakMap,iW=new WeakMap,iF=new WeakMap;class iB{get book(){return this.player.book}get iframe(){return this.iframeRef.current}get enabledPageList(){return"none"!==this.states.pageList&&!this.isVertical}get isFirstPageList(){return this.pageListCurIndex<=0}get isLastPageList(){return!this.pageListCount||this.pageListCurIndex>=this.pageListCount-1}pageListType(){if("auto"===this.states.pageList)return this.win?this.win.innerWidth>700?"double":"single":"single";return this.states.pageList}async tryManipulateDOM(e){await Promise.race([e(),eQ(100)])}getReadablePartIndexByAnchorId(e){if(!e||!this.doc)return null;try{let t=this.readableParts.findIndex(t=>{var n;if(null===(n=t.anchorIds)||void 0===n?void 0:n.includes(e))return!0});return -1===t?null:t}catch{}return null}async scrollToCurParagraph(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=this.readableParts.at(this.states.pos.paragraph);t?await this.scrollToElem(t.elem,{animated:e}):this.enabledPageList&&await this.pageListScrollToLeft(this.pageListScrollLeft,{animated:e})}async scrollToElem(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await this.tryManipulateDOM(async()=>{if(!this.doc)return;let n=this.doc.documentElement.getBoundingClientRect(),i=e.getBoundingClientRect();if(this.enabledPageList){let a=i.left+e.offsetWidth/2-n.left;await this.pageListScrollToLeft(a,t)}else if(this.isVertical){let a=i.right+e.offsetWidth/2-n.right;await this.scrollToRight(a,t)}else{let e=i.top-n.top;await this.scrollToTop(e,t)}})}async scrollToRight(e){var t;let{iteration:n=10,duration:i=100,animated:a=!0,abortCtrl:r,position:o="center"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.win)return;let s=null===(t=this.doc)||void 0===t?void 0:t.scrollingElement;if(!s)return;let l="center"===o?e+this.win.innerWidth/2:e;if(a){let e=s.scrollLeft,t=(l-e)/n;await iv({duration:i,iteration:n,abortCtrl:r},n=>{s.scrollLeft=e+n*t})}else s.scrollLeft=l}async scrollToTop(e){var t;let{iteration:n=10,duration:i=100,animated:a=!0,abortCtrl:r,position:o="center"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.win)return;let s=null===(t=this.doc)||void 0===t?void 0:t.scrollingElement;if(!s)return;let l="center"===o?e-this.win.innerHeight/2:e;if(a){let e=s.scrollTop,t=(l-e)/n;await iv({duration:i,iteration:n,abortCtrl:r},n=>{s.scrollTop=e+n*t})}else s.scrollTop=l}pageListSetScrollLeft(e){this.doc&&(this.pageListScrollLeft=e,this.doc.documentElement.style.transform=`translateX(${-e}px)`,this.events.fire("scroll",null))}async pageListScrollToLeft(e){var t;let{iteration:n=10,duration:i=100,animated:a=!0,abortCtrl:r,userOperator:o=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.enabledPageList||!this.pageList)return;let s=null===(t=(0,S.dF)(this.pageList,t=>t.offsetLeft<=e))||void 0===t?void 0:t.offsetLeft;if(void 0!==s){if(a){let e=this.pageListScrollLeft,t=(s-e)/n;await iv({duration:i,iteration:n,abortCtrl:r},n=>{this.pageListSetScrollLeft(e+n*t)})}else this.pageListSetScrollLeft(s);this.viewOffsetWidth&&(this.pageListCurIndex=Math.round(this.pageListScrollLeft/this.viewOffsetWidth)),o&&this.updatePageListCurFocus()}}async pageListScrollToPage(e,t){var n;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.enabledPageList||!this.pageList)return;let a=this.pageList.at(e);a&&(t?await this.player.gotoParagraph((null===(n=a.topmost)||void 0===n?void 0:n.paragraph)??this.states.pos.paragraph):await this.pageListScrollToLeft(a.offsetLeft,i))}async pageListPushAdjust(e,t){var n;let i;if(!this.viewOffsetWidth||!this.pageListCount||!this.pageList)return;if(i=(0,ng._)(this,iO)?(0,ng._)(this,iO).pageIndex+e:this.pageListCurIndex+e,t){if(i<0)return await this.player.prevSection(-1);if(i>=this.pageListCount)return await this.player.nextSection()}else i<0?i=0:i>=this.pageListCount&&(i=this.pageListCount-1);null===(n=(0,ng._)(this,iO))||void 0===n||n.abortCtrl.abort();let a=new AbortController;(0,nv._)(this,iO,{abortCtrl:a,pageIndex:i});let r=i*this.viewOffsetWidth;if(await this.pageListScrollToLeft(r,{abortCtrl:a}),t){let e=this.pageList.at(i);(null==e?void 0:e.topmost)&&await this.player.gotoParagraph(e.topmost.paragraph,!1)}(0,nv._)(this,iO,void 0)}async scrollToPercent(e,t){var n;let i=null===(n=this.doc)||void 0===n?void 0:n.scrollingElement;if(console.debug(`scrollElement: ${(null==i?void 0:i.tagName)??"null"}`),!i)return;if(!this.enabledPageList){let t=(i.scrollHeight-i.clientHeight)*e;await this.scrollToTop(t,{position:"start"});return}if(!this.viewOffsetWidth)return;let a=Math.floor(this.pageListScrollWidth*e/this.viewOffsetWidth)-this.pageListCurIndex;await this.pageListPushAdjust(a,t)}async load(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.iframe;if(!t)return;let n=e.force??!1,i=e.section??this.states.pos.section,a=this.book.spines.at(i);if(!a&&(a=this.book.spines.at(0)),!a)return(0,J.c1)().error("book spine is empty");this.states.pos={...this.states.pos,section:i};let r=a.href,o=n||r!==(0,ng._)(this,iW);(0,nv._)(this,iW,r);try{if(o){this.states.loading=!0,this.iframe.style.opacity="0",this.unmount.fire();let e=new Promise(e=>{t.addEventListener("load",()=>{e()},{once:!0})});t.src=ig(this.book.item.uuid,r),await e;let n=t.contentDocument;if(!n)return(0,J.c1)().error("iframe load failed");let i=new im.b(n,this.book.flattenedNavs);this.readableParts=i.toReadableParts(),this.alias=i.alias(),await this.onLoaded(t)}let n=this.states.pos.paragraph;void 0!==e.paragraph?(n=e.paragraph<0?this.readableParts.length+e.paragraph:e.paragraph)<0?n=0:n>=this.readableParts.length&&(n=this.readableParts.length-1):e.anchorId&&(n=this.getReadablePartIndexByAnchorId(e.anchorId)??0),this.states.pos={...this.states.pos,paragraph:n},await this.scrollToCurParagraph(e.animated??!1)}finally{o&&(this.states.loading=!1,this.iframe.style.opacity="1")}}async gotoUrlPath(e){let[t,n]=(0,iy.c)(e),i=this.book.spines.findIndex(e=>e.href===t);-1!==i&&(n?await this.load({section:i,anchorId:n}):await this.load({section:i,paragraph:0}))}async onLoaded(e){let t=e.contentWindow,n=e.contentDocument;t&&n&&(this.win=t,this.doc=n,E.c.set(_,{win:t}),this.states.disabledVertical?this.isVertical=!1:this.isVertical=t.getComputedStyle(n.body).writingMode.startsWith("vertical"),this.updateColorTheme(this.colorScheme),this.injectCSS(n),this.updateFontSize(n),this.viewCalculate(n),this.hookResize(t,n),this.resizeImgs(n),this.hookTouch(),this.enabledPageList&&(await this.pageListCalculate(n),this.hookPageWheel(),this.hookSwipe()),this.isVertical&&this.hookVerticalWheel(),this.hookSelection(),this.hookScroll(),this.hookALinks(n),this.hookLinkClick(),this.hookImgs(n),this.hookParagraphClick(),this.player.utterer.hl.reCreateRoot(n),this.annotationHl.reCreateRoot(n),this.keywordHl.reCreateRoot(n),this.updateAnnotations(),this.updateKeywords())}updateColorTheme(e){this.colorScheme=e,this.doc&&("dark"===e?this.doc.documentElement.classList.add(y.JK):this.doc.documentElement.classList.remove(y.JK))}injectCSS(e){let t=e.createElement("style"),n="";this.enabledPageList?n+=`
        /* page list */
        html {
          width: 100% !important;
          height: 100% !important;
          box-sizing: border-box !important;
          margin: 0 !important;
          padding: 0 !important;
          overflow: hidden !important;
          will-change: transform !important;
        }
        body {
          width: auto !important;
          height: 100% !important;
          box-sizing: border-box !important;
          word-break: break-word !important;
          margin: 0 !important;
          padding: 0 !important;
          /* Safari iOS not support
            columns: var(--main-column-count) auto !important;
          */
          columns: var(--main-column-count) var(--main-column-width) !important;
          column-gap: ${this.pageListGap}px !important;
          column-fill: auto !important;
        }
        .${y.HQ} {
          content: ' ';
          break-before: column;
          ${ew.G6||ew.vU?"height: 100%":""}
        }
      `:n+=`
        html {
          width: 100%;
          height: 100%;
          box-sizing: border-box !important;
          margin: 0 !important;
          padding: 8px !important;
        }
        body {
          ${this.isVertical?`
                width: auto;
                height: 100%;
                overflow-y: hidden;
              `:`
                height: auto;
                width: 100%;
                overflow-x: hidden;
              `}
          box-sizing: border-box !important;
        }
      `,this.states.disabledVertical&&(n+=`
        body {
          writing-mode: initial !important;
        }
      `);let i="";!ew.tq&&(i=`
        .${y.b6}:hover {
          outline: 1px dashed var(--main-fg-hover);
        }
      `),t.innerHTML=`
      ${ix}
      ${n}

      /* scrollbar */
      ::-webkit-scrollbar-thumb {
        background: var(--main-fg);
      }

      /* wrap */
      pre {
        white-space: pre-wrap;
      }

      /* image */
      svg {
        max-width: 90% !important;
        max-height: 90vh;
      }
      img.${y.A4} {
        max-width: 90% !important;
        height: auto;
      }
      img.${y.jM} {
        width: auto;
        max-height: 90vh;
      }

      /* scheme */
      .${y.JK} body,
      .${y.JK} body * {
        background-color: var(--main-bg);
        color: var(--main-fg) !important;
      }

      /* paragraph */
      .${y.b6} {
        cursor: pointer;
      }

      .${y.b6}.${y.TX},
      .${y.b6}.${y.TX} * {
        background: var(--main-bg-active) !important;
      }

      ${i}

      .${y.is} > div, .${y.pJ} > div, .${y.TO} > div {
        background-color: var(--main-bg-highlight) !important;
        color: var(--main-fg-highlight) !important;
        position: absolute;
        user-select: none;
        pointer-events: none;
      }

      .${y.lc} {
        text-decoration-line: underline;
        text-decoration-style: solid;
        text-decoration-thickness: 2px;
        text-decoration-color: var(--main-bg-blue);
        text-underline-offset: 4px;
      }
    `,e.head.appendChild(t),e.querySelectorAll("svg").forEach(e=>{e.setAttribute("preserveAspectRatio","xMinYMin meet")})}updateFontSize(e){this.tryManipulateDOM(()=>{e.documentElement.style.fontSize=`${this.states.fontSize}px`}).catch(console.error)}hookResize(e,t){let n=()=>this.onResized(t);e.addEventListener("resize",n),this.unmount.on(()=>{e.removeEventListener("resize",n)})}resizeImgs(e){let t=[y.A4,y.jM],n=e.querySelectorAll("img");for(let e of n)e.classList.remove(...t);if(this.viewWidth&&"none"===this.pageListType())for(let e of n)e.width>this.viewWidth&&e.classList.add(y.A4)}hookTouch(){let e;if(!ew.oL)return;let t=this.doc,n=this.win,i=this.viewWidth;if(!t||!n||!i)return;let a=t=>{let n=t.touches[0];n&&(e={x:n.clientX,y:n.clientY,offsetLeft:this.pageListScrollLeft,timestamp:Date.now()})},r=n=>{if((0,L.lJ)(n),void 0===e)return;let i=t.getSelection();if((null==i?void 0:i.type)==="Range"){e=void 0;return}let a=n.touches[0];if(!a)return;let r=a.clientX-e.x;this.pageListSetScrollLeft(e.offsetLeft-r)},o=t=>{if(void 0===e)return;let n=t.changedTouches[0];if(!n)return;let a=n.clientX-e.x,r=a/(Date.now()-e.timestamp),o=.2*i;if(r<-.3||a<-o){if(!this.isLastPageList||!this.player.isLastSection){this.events.fire("swipeRight",null);return}}else if((r>.3||a>o)&&(!this.isFirstPageList||!this.player.isFirstSection)){this.events.fire("swipeLeft",null);return}this.pageListPushAdjust(0,!1)};t.addEventListener("touchstart",a),t.addEventListener("touchmove",r),t.addEventListener("touchend",o),this.unmount.on(()=>{t.removeEventListener("touchstart",a),t.removeEventListener("touchmove",r),t.removeEventListener("touchend",o)})}hookPageWheel(){let e=this.doc;if(!e)return;let t=e=>{if((0,L.lJ)(e),!(0,L.cK)(e.target))0!==e.deltaY&&(e.deltaY>0?this.events.fire("swipeRight",null):this.events.fire("swipeLeft",null))};e.documentElement.addEventListener("wheel",t),this.unmount.on(()=>{e.documentElement.removeEventListener("wheel",t)})}hookSwipe(){let e=this.events.on("swipeLeft",async()=>{await this.player.prevPage(1,!0)}),t=this.events.on("swipeRight",async()=>{await this.player.nextPage(1,!0)});this.unmount.on(()=>{e(),t()})}hookVerticalWheel(){var e;let t=this.doc,n=null===(e=this.doc)||void 0===e?void 0:e.scrollingElement;if(!t||!n)return;let i=e=>{if((0,L.lJ)(e),!(0,L.cK)(e.target))0!==e.deltaY&&(n.scrollLeft-=e.deltaY)};t.documentElement.addEventListener("wheel",i),this.unmount.on(()=>{t.documentElement.removeEventListener("wheel",i)})}hookSelection(){let e=this.win,t=this.doc;if(e&&t&&(t.addEventListener("selectionchange",()=>{let e=`.${y.b6}`,n=(()=>{let n=t.getSelection();if(!n||n.rangeCount<=0)return;let i=n.getRangeAt(0),a=i.toString(),r=a.length;if(!r)return;let o=i.commonAncestorContainer.parentElement;if(!o)return;let s=o.matches(e)?o:o.closest(e);if(!s)return;let l=this.readableParts.findIndex(e=>e.elem===s);if(-1===l)return;let c=i.cloneRange();c.selectNodeContents(s),c.setEnd(i.endContainer,i.endOffset);let d=c.toString().length-r;return{paragraph:l,start:d,end:d+r,selectedText:a}})();n?(this.states.pos={...this.states.pos,paragraph:n.paragraph},this.states.selection={start:n.start,end:n.end,selectedText:n.selectedText}):this.states.selection=void 0}),ew.tq)){let n=()=>{var e;null===(e=t.getSelection())||void 0===e||e.removeAllRanges()};e.addEventListener("blur",n),this.unmount.on(()=>{e.removeEventListener("blur",n)})}}hookScroll(){var e;let t=null===(e=this.doc)||void 0===e?void 0:e.scrollingElement;if(!this.doc||!t)return;let n=()=>{let e;e=this.enabledPageList?this.pageListScrollLeft/(this.pageListScrollWidth-t.clientWidth):this.isVertical?-t.scrollLeft/(t.scrollWidth-t.clientWidth):t.scrollTop/(t.scrollHeight-t.clientHeight),this.states.scrollPercent=100*e};n();let i=this.events.on("scroll",()=>n());this.doc.addEventListener("scroll",()=>this.events.fire("scroll",null),{passive:!0}),this.unmount.on(()=>{i()})}hookALinks(e){for(let t of e.querySelectorAll("a"))t.href&&t.addEventListener("click",e=>{(0,L.lJ)(e),this.events.fire("click",t)})}hookLinkClick(){let e=async e=>await K({title:(0,j.t)("confirm.openLink"),description:e}),t=async t=>{await e(t)&&window.open(t,"_blank","noopener,noreferrer")},n=this.events.on("click",n=>{eY(async()=>{let i;if(n.closest(eG.n)){let e=n.getAttribute("href");if(!e)return;i=eq().join("/",e)}else{let e=n.href;if(!e)return;if(!e.startsWith(this.mainContentRootUrl))return await t(e);i=e.substring(this.mainContentRootUrl.length)}await e(i)&&(await this.gotoUrlPath(i),this.player.utterer.cancel())})});this.unmount.on(()=>{n()})}hookImgs(e){for(let t of e.querySelectorAll("img"))t.addEventListener("click",e=>{let n=t.src;n&&((0,L.lJ)(e),E.c.set(er,n))});for(let t of e.querySelectorAll("svg"))t.addEventListener("click",n=>{(0,L.lJ)(n),eY(async()=>{let n=await (0,L.hO)(t,e.URL);E.c.set(er,n)})})}hookParagraphClick(){let e=this.win,t=this.doc;if(!e||!t)return;let n=(e,t)=>{(0,L.lJ)(e),this.player.gotoParagraph(t,!1)},i=(e,n)=>{var i;(0,L.lJ)(e),null===(i=t.getSelection())||void 0===i||i.removeAllRanges(),this.player.annotations.toggle({section:this.states.pos.section,paragraph:n},null)};this.readableParts.forEach((e,t)=>{"text"===e.type&&(e.elem.addEventListener("click",e=>n(e,t)),e.elem.addEventListener("dblclick",e=>i(e,t)))})}viewCalculate(e){let t=e.documentElement.getBoundingClientRect();this.viewWidth=t.width,this.viewOffsetWidth=t.width+this.pageListGap,this.viewHeight=t.height,console.debug(`viewWidth: ${this.viewWidth}`),console.debug(`viewOffsetWidth: ${this.viewOffsetWidth}`),console.debug(`viewHeight: ${this.viewHeight}`)}pageListScrollWidthCalculate(e,t){let n=1/0,i=-1/0;if(!this.readableParts.length)return e.scrollWidth;for(let e of[...this.readableParts.map(e=>e.elem),t]){if(!e)continue;let t=e.getBoundingClientRect();t.left<n&&(n=t.left),t.right>i&&(i=t.right)}return i-n}async pageListCalculate(e){var t;let n;if(!this.viewWidth||!this.viewOffsetWidth)return;let i=e.documentElement,a=this.pageListType(),r="single"===a?1:2,o=(this.viewWidth-this.pageListGap)/r;if(i.style.setProperty("--main-column-count",r.toString()),i.style.setProperty("--main-column-width",`${o}px`),this.pageListColumnWidth=o,this.pageListResizeImgs(e,this.pageListColumnWidth),this.pageListScrollWidth=this.pageListScrollWidthCalculate(i,null),null===(t=e.querySelector(`.${y.HQ}`))||void 0===t||t.remove(),"double"===a){if((n=Math.round(2*this.pageListScrollWidth/this.viewOffsetWidth))%2==1){n+=1;let t=e.createElement("p");t.classList.add(y.HQ),e.body.appendChild(t),this.pageListScrollWidth=this.pageListScrollWidthCalculate(i,t)}n/=2}else n=Math.round(this.pageListScrollWidth/this.viewOffsetWidth);n<1&&(n=1),this.pageListCount=n,console.debug(`pageListScrollWidth: ${this.pageListScrollWidth}`),console.debug(`pageListColumnWidth: ${this.pageListColumnWidth}`),console.debug(`pageListCount: ${this.pageListCount}`),this.parsePageList(i)}pageListResizeImgs(e,t){if(!this.viewHeight)return;let n=e.querySelectorAll("img"),i=t/this.viewHeight;for(let e of n)(e.width>t||e.height>this.viewHeight)&&e.classList.add(e.naturalWidth/e.naturalHeight>i?y.A4:y.jM)}parsePageList(e){let t=this.viewOffsetWidth;if(!t||!this.pageListCount)return;this.pageList=(0,S.w6)(0,this.pageListCount).map(e=>e*t).map(e=>({offsetLeft:e}));let n=e.getBoundingClientRect().left;for(let[e,t]of this.readableParts.entries()){let i=t.elem.getBoundingClientRect().left+t.elem.offsetWidth/2-n,a=(0,S.dF)(this.pageList,e=>e.offsetLeft<=i);a&&!a.topmost&&(a.topmost={readablePart:t,paragraph:e})}}updatePageListCurFocus(){if(!this.pageList)return;let e=this.states.pos.paragraph;if((0,S.qr)(this.pageList,t=>!!t.topmost&&t.topmost.paragraph<=e)===this.pageListCurIndex)this.pageListResizeCurFocusPart=this.readableParts.at(e);else{var t,n;this.pageListResizeCurFocusPart=null===(n=this.pageList.at(this.pageListCurIndex))||void 0===n?void 0:null===(t=n.topmost)||void 0===t?void 0:t.readablePart}}updateParagraphActive(){this.tryManipulateDOM(()=>{var e;let t=this.readableParts.at(this.states.pos.paragraph);!(!t||(0,ng._)(this,iF)&&t===(0,ng._)(this,iF))&&(null===(e=(0,ng._)(this,iF))||void 0===e||e.elem.classList.remove(y.TX),(0,nv._)(this,iF,t),t.elem.classList.add(y.TX))}).catch(console.error)}updateAnnotations(){this.tryManipulateDOM(()=>{if(!this.states.annotations||!this.doc)return;for(let e of Array.from(this.doc.querySelectorAll(`.${y.lc}`)))e.classList.remove(y.lc);let e=[];for(let t of this.states.annotations){if(t.pos.section!==this.states.pos.section)continue;let n=this.readableParts.at(t.pos.paragraph);if(n){if(!t.range){n.elem.classList.add(y.lc);continue}e.push({node:n,charIndex:t.range.start,charLength:t.range.end-t.range.start,color:"var(--main-bg-blue)"})}}this.annotationHl.highlight(e,!1)}).catch(console.error)}updateKeywords(){this.tryManipulateDOM(()=>{if(!this.states.keywords||!this.doc)return;let e=[];for(let t of this.states.keywords){let n=this.readableParts.filter(e=>"text"===e.type);if(n.length)for(let i of n){let n=(0,P.Rh)(i.text,t);if(n.length)for(let[t,a]of n)e.push({node:i,charIndex:t,charLength:a,color:"var(--main-bg-blue)"})}}this.keywordHl.highlight(e,!1)}).catch(console.error)}updateActiveNavs(){let e=this.book.flattenedNavs.filter(e=>e.spineIndex===this.states.pos.section),t=(()=>{var t;if(0===e.length)return(0,S.dF)(this.book.flattenedNavs,e=>!!e.spineIndex&&e.spineIndex<this.states.pos.section);let n=this.readableParts,i=null===(t=(0,S.dF)(n.slice(0,this.states.pos.paragraph+1),e=>!!e.navAnchorIds))||void 0===t?void 0:t.navAnchorIds,a=i&&i.length>0?i[i.length-1]:null;if(!a)return e[0];let r=(0,S.dF)(e,e=>e.hrefAnchor===a);return r?r:e[0]})();if(!t){this.states.activeNavs=[];return}let n=this.book.flattenedNavs.indexOf(t);if(-1===n){this.states.activeNavs=[];return}let i=[t],a=n-1,r=t.level-1;for(;a>=0&&r>0;){let[e,t]=(0,S.L_)(this.book.flattenedNavs,e=>e.level===r,a);if(e)a=t-1,r=e.level-1,i.unshift(e);else break}this.states.activeNavs=i}constructor(e,t,n){var i;let a;(0,tL._)(this,"player",void 0),(0,tL._)(this,"states",void 0),(0,tL._)(this,"iframeRef",void 0),(0,tL._)(this,"readableParts",void 0),(0,tL._)(this,"alias",void 0),(0,tL._)(this,"doc",void 0),(0,tL._)(this,"events",void 0),(0,tL._)(this,"unmount",void 0),(0,tL._)(this,"isVertical",void 0),(0,tL._)(this,"annotationHl",void 0),(0,tL._)(this,"keywordHl",void 0),(0,tL._)(this,"mainContentRootPath",void 0),(0,tL._)(this,"mainContentRootUrl",void 0),(0,tL._)(this,"colorScheme",void 0),(0,tL._)(this,"viewWidth",void 0),(0,tL._)(this,"viewOffsetWidth",void 0),(0,tL._)(this,"viewHeight",void 0),(0,tL._)(this,"pageList",void 0),(0,tL._)(this,"pageListGap",void 0),(0,tL._)(this,"pageListScrollWidth",void 0),(0,tL._)(this,"pageListScrollLeft",void 0),(0,tL._)(this,"pageListColumnWidth",void 0),(0,tL._)(this,"pageListCount",void 0),(0,tL._)(this,"pageListCurIndex",void 0),(0,tL._)(this,"pageListResizeCurFocusPart",void 0),(0,tL._)(this,"win",void 0),(0,nm._)(this,iO,{writable:!0,value:void 0}),(0,nm._)(this,iW,{writable:!0,value:void 0}),(0,tL._)(this,"onResized",void 0),(0,nm._)(this,iF,{writable:!0,value:void 0}),this.player=e,this.states=t,this.iframeRef=n,this.readableParts=[],this.alias=[],this.events=new nk,this.unmount=new nx({once:!0}),this.isVertical=!1,this.colorScheme="light",this.pageListGap=12,this.pageListScrollWidth=0,this.pageListScrollLeft=0,this.pageListCurIndex=0;this.onResized=(i=e=>{eY(async()=>{if(this.viewCalculate(e),this.resizeImgs(e),this.enabledPageList){await this.pageListCalculate(e);let t=this.pageListResizeCurFocusPart;t?await this.scrollToElem(t.elem,{animated:!1,userOperator:!1}):await this.pageListScrollToLeft(this.pageListScrollLeft,{animated:!1,userOperator:!1}),this.player.utterer.hl.highlightHide(),this.updateAnnotations(),this.updateKeywords()}})},function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];clearTimeout(a),a=setTimeout(()=>i(...t),300)}),this.mainContentRootPath=ig(this.book.item.uuid,""),this.mainContentRootUrl=new URL(this.mainContentRootPath,location.href).toString(),this.annotationHl=new iZ(this,t),this.keywordHl=new i$(this,t),this.states.events.on("pos",()=>{this.updateParagraphActive(),this.updateActiveNavs()}),this.states.events.on("started",e=>{!e&&this.player.utterer.hl.highlightHide()}),this.states.uiEvents.on("annotations",()=>{this.updateAnnotations()}),this.states.uiEvents.on("keywords",()=>{this.updateKeywords()});let r=!0;this.states.uiEvents.on("pageList",async()=>{if(r){r=!1;return}this.iframe&&await this.load({force:!0})});let o=!0;this.states.uiEvents.on("disabledVertical",async()=>{if(o){o=!1;return}this.iframe&&await this.load({force:!0})}),this.states.uiEvents.on("fontSize",async()=>{this.doc&&(this.updateFontSize(this.doc),this.onResized(this.doc))}),this.player.unmount.on(()=>this.unmount.fire())}}class iz extends iR{constructor(...e){super(...e),(0,tL._)(this,"rootClass",y.is),(0,tL._)(this,"ignoreClass",y.Xp)}}class iK{cancel(){this.speech.cancel()}async speakNode(e){return this.states.voice?this.speech.speak(e.text,{voice:this.states.voice,speed:this.states.speechSpeed,isPersonReplace:this.states.isPersonReplace,alias:this.player.iframeCtrler.alias,onBoundary:t=>{this.hl.highlight([{node:e,charIndex:t.charIndex,charLength:t.charLength}],!0)}}):"done"}async speakText(e){return this.states.voice?this.speech.speak(e,{voice:this.states.voice,speed:this.states.speechSpeed,isPersonReplace:this.states.isPersonReplace,alias:this.player.iframeCtrler.alias}):"done"}async nextPart(){this.states.pos.paragraph>=this.player.iframeCtrler.readableParts.length-1?this.states.pos.section<this.player.book.spines.length-1&&this.states.autoNextSection?(await this.player.nextSection(),await tO()):this.player.pause():(await this.player.nextParagraph(),await tZ())}async startLoop(){let e=0;for(;;){if(!this.states.started)return;try{let e=this.player.iframeCtrler.readableParts.at(this.states.pos.paragraph);if(e)switch(e.type){case"text":{let t=!1;for(let n=0;n<this.states.paragraphRepeat;n++){let i=await this.speakNode(e);if("cancel"===i){t=!0;break}n!==this.states.paragraphRepeat-1&&await tz()}if(t)continue;break}case"image":await tI()}await this.nextPart()}catch(t){console.error(t),(e+=1)>3&&(await this.nextPart(),e=0)}}}constructor(e,t,n){(0,tL._)(this,"player",void 0),(0,tL._)(this,"hl",void 0),(0,tL._)(this,"states",void 0),(0,tL._)(this,"speech",void 0),this.player=e,this.states=t,this.hl=new iz(n,t),this.speech=new tK}}var iD=n("3918"),iU=n("945");class iH{getBriefText(e){let t=this.player.iframeCtrler.readableParts.at(e.paragraph);if(!t)return;if("text"!==t.type)return(0,J.c1)().error((0,j.t)("desc.keywordNoSupported")),null;let n=t.text.slice(0,30);return{text:t.text,brief:n}}async add(e){var t;let{keyword:n,pos:i}=e,a=this.getBriefText(i);if(!a)return;let r=await iU.L.action({keywords:[{keyword:n,uuid:null,pos:i,brief:a.brief,content:a.text}],uuid:this.uuid});return null===(t=this.reload)||void 0===t||t.call(this),(0,J.c1)().info(`${(0,j.t)("desc.keywordUpdated")} ${n}`),r.keywords.at(0)}async upsert(e,t){var n;let{uuid:i,keyword:a,pos:r}=e,{alias:o,note:s,color:l}=t,c=this.getBriefText(r);if(!c)return;let d=await iU.L.action({keywords:[{uuid:i,keyword:a,pos:r,brief:c.brief,content:c.text,alias:o,note:s,color:l}],uuid:this.uuid});return null===(n=this.reload)||void 0===n||n.call(this),(0,J.c1)().info(`${(0,j.t)("desc.keywordUpdated")} ${a}`),d.keywords.at(0)}async remove(e){var t;let n=e.color?il()(e.color,{black:"#3a3a3a",white:"#fafafa"}):"var(--main-fg-blue)";await K({title:(0,j.t)("prompt.keywordRemoveConfirm"),description:(0,r.jsx)("span",{style:{backgroundColor:e.color??"var(--main-bg-blue)",color:n},children:e.keyword})})&&(await iD.p.action({uuid:this.uuid,keywordUuids:[e.uuid]}),null===(t=this.reload)||void 0===t||t.call(this),(0,J.c1)().info(`${(0,j.t)("desc.keywordDeleted")} ${e.keyword}`))}constructor(e){(0,tL._)(this,"player",void 0),(0,tL._)(this,"uuid",void 0),(0,tL._)(this,"reload",void 0),this.player=e,this.uuid=e.book.item.uuid}}class iV{start(){this.states.started=!0,this.utterer.startLoop().catch(console.error)}pause(){this.states.started=!1,this.utterer.cancel()}restart(e){this.pause(),e?setTimeout(()=>{this.start()},e):this.start()}toggle(){this.states.started?this.pause():this.start()}get isFirstSection(){return 0===this.states.pos.section}get isLastSection(){return this.states.pos.section===this.book.spines.length-1}async gotoPos(e){let{section:t,paragraph:n,scrollToParagraph:i=!0,animated:a=!0}=e;if(void 0===t||!(t<0)&&!(t>=this.book.spines.length)){if(t??(t=this.states.pos.section),n??(n=this.states.pos.paragraph),this.states.pos.section===t){if(this.states.pos.paragraph===n)return;this.states.pos={section:t,paragraph:n},i&&await this.iframeCtrler.scrollToCurParagraph(a)}else await this.iframeCtrler.load({section:t,paragraph:n,animated:a});this.utterer.cancel()}}async gotoSection(e,t){await this.gotoPos({section:e,paragraph:t})}async prevSection(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;await this.gotoPos({section:this.states.pos.section-1,paragraph:e,animated:!1})}async nextSection(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;await this.gotoPos({section:this.states.pos.section+1,paragraph:e,animated:!1})}async gotoUrlPath(e){await this.iframeCtrler.gotoUrlPath(e),this.utterer.cancel()}get isFirstPage(){return this.iframeCtrler.isFirstPageList}get isLastPage(){return this.iframeCtrler.isLastPageList}async gotoPage(e,t){await this.iframeCtrler.pageListScrollToPage(e,t)}async prevPage(e,t){await this.iframeCtrler.pageListPushAdjust(-e,t)}async nextPage(e,t){await this.iframeCtrler.pageListPushAdjust(e,t)}get isFirstParagraph(){return this.states.pos.paragraph<=0}get isLastParagraph(){return this.states.pos.paragraph>=this.iframeCtrler.readableParts.length-1}async gotoParagraph(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];await this.gotoPos({paragraph:e,scrollToParagraph:t})}async prevParagraph(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];0===this.states.pos.paragraph?await this.prevSection(-1):await this.gotoParagraph(this.states.pos.paragraph-1,e)}async nextParagraph(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.states.pos.paragraph>=this.iframeCtrler.readableParts.length-1?await this.nextSection():await this.gotoParagraph(this.states.pos.paragraph+1,e)}constructor(e,t,n){(0,tL._)(this,"book",void 0),(0,tL._)(this,"states",void 0),(0,tL._)(this,"utterer",void 0),(0,tL._)(this,"iframeCtrler",void 0),(0,tL._)(this,"annotations",void 0),(0,tL._)(this,"keywords",void 0),(0,tL._)(this,"unmount",void 0),this.book=e,this.unmount=new nx({once:!0}),this.states=new nL,this.states.pos=t,this.iframeCtrler=new iB(this,this.states,n),this.utterer=new iK(this,this.states,this.iframeCtrler),this.annotations=new iu(this),this.keywords=new iH(this);let i=()=>{eY(async()=>{let e;await (null==e?void 0:e.release().catch(console.error)),e=void 0,this.states.started&&this.states.docVisible&&(e=await navigator.wakeLock.request("screen"))})};i(),document.addEventListener("visibilitychange",i);let a=this.states.events.on("started",i);this.unmount.on(()=>{document.removeEventListener("visibilitychange",i),a()})}}function iq(e){let{player:t,scrollPercent:n}=e,i=(null==n?void 0:n.toFixed(2))??"0";return(0,r.jsx)("div",{style:{height:8,width:"100%",overflow:"hidden",borderRadius:8,background:"var(--main-bg-active)"},onClick:e=>{let n=e.currentTarget.getBoundingClientRect(),i=(e.clientX-n.left)/n.width;t.iframeCtrler.scrollToPercent(i,!0).catch(console.error)},title:`${i}%`,children:(0,r.jsx)("div",{style:{transition:"width 0.2s",width:`${i}%`,height:"100%",background:"var(--main-fg-active)"}})})}let iG=e=>{var t,n;let{data:i,error:a,reload:r}=(0,ex.BH)(ni.X,{uuid:e});let{data:o,error:s,reload:l}=(t=[i],n=async e=>{if(e)return nn.C.action({uuid:e.item.uuid})},function(e,t){let n=(0,g.useRef)(e),[i,a]=(0,g.useState)(),[r,o]=(0,g.useState)(),s=(0,g.useCallback)(e=>{n.current().then(t=>{!e.aborted&&a(t)}).catch(t=>{!e.aborted&&o(t)})},[]),l=(0,g.useCallback)(function(){let{signal:e,clean:t=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t&&a(void 0),o(void 0),s(e??new AbortController().signal)},[s]);return(0,g.useEffect)(()=>{n.current=e},[e]),(0,g.useEffect)(()=>{let e=new AbortController;return s(e.signal),()=>{e.abort()}},(null==t?void 0:t.deps)??[]),{data:i,error:r,reload:l}}(()=>n(...t),{deps:[JSON.stringify(t)]})),[c,d]=(0,g.useState)(),u=null==c?void 0:c.section,h=null==c?void 0:c.paragraph,p=(0,g.useMemo)(()=>{if(!i)return;let e=[],t=[...i.navs];for(;t.length;){let n=t.shift();e.push(n),t.unshift(...n.children)}return{...i,flattenedNavs:e}},[i]);return(0,g.useEffect)(()=>{o&&d(o)},[o]),(0,g.useEffect)(()=>{void 0!==p&&void 0!==u&&void 0!==h&&nt.u.action({uuid:p.item.uuid,pos:{section:u,paragraph:h}}).catch(console.error)},[p,h,u]),{error:a||s,pos:c,setPos:d,book:p,reload:(0,g.useCallback)(()=>{r(),l()},[r,l])}};function iJ(){let{book:e}=nr(),{BookPanelView:t,MainContent:n,activeNavs:i}=function(){let{book:e,pos:t,setPos:n}=nr(),i=(0,g.useRef)(null),[a,o]=(0,g.useState)(!1),[s,l]=(0,g.useState)(),[c,d]=(0,g.useState)(!1),[u,h]=(0,g.useState)(),[p,f]=(0,g.useState)(),{addHotkeys:m}=M(),[,v]=eC(),y=(0,em.s0)(),x=function(e,t,n){var i;let a=(0,g.useRef)();return!a.current&&(a.current=new iV(e,t,n)),(0,tU.z)(()=>{var e;null===(e=a.current)||void 0===e||e.unmount.fire()}),i=a.current,(0,ed.n)(async()=>{await i.iframeCtrler.load()}),a.current}(e,t,i);!function(e,t){let{setPos:n,setStarted:i,setActiveNavs:a,setLoading:r,setScrollPercent:o,setSelection:s}=t;(0,g.useEffect)(()=>{let t=e.states.events,l=[t.on("pos",e=>{n(e)}),t.on("started",e=>{i(e)}),t.on("activeNavs",e=>{a(e)}),t.on("loading",e=>{r(e)}),t.on("scrollPercent",e=>{o(e)}),t.on("selection",e=>{s(e)})];return()=>{l.forEach(e=>e())}},[e,n,i,a,r,o,s])}(x,{setPos:n,setStarted:o,setActiveNavs:l,setLoading:d,setScrollPercent:h,setSelection:f});let w=np();(0,g.useEffect)(()=>{x.iframeCtrler.updateColorTheme(w)},[x.iframeCtrler,w]);let{BookPanelView:C}=function(e){let{player:t,started:n,activeNavs:i,selection:a}=e,{book:o,pos:s}=nr(),l=(0,em.s0)(),{annotations:c,keywords:d,setViewPanelType:u,BookPanelView:h}=function(e,t,n,i,a){var o,s,l;let[c,d]=eC();let{NavTreeView:u}=(o=e,s=t,l=n,{NavTreeView:(0,r.jsx)(n9,{book:o,player:s,activeNavs:l})}),{annotations:h,AnnotationView:p}=function(e,t,n,i){let a=e.item.uuid,{data:o,reload:s}=(0,ex.BH)(n1.i,{uuid:a},{clearWhenReload:!1});(0,g.useEffect)(()=>(t.annotations.reload=s,()=>{t.annotations.reload=void 0}),[t.annotations,s]);let l=(0,g.useMemo)(()=>t.annotations.indexByPos(n,i??null),[t.annotations,n,i]),c=(0,g.useMemo)(()=>t.annotations.closestIndexByPos(n),[t.annotations,n]);(0,g.useMemo)(()=>null!==l?null==o?void 0:o.at(l):void 0,[o,l]);let d=(0,g.useMemo)(()=>null!==c?null==o?void 0:o.at(c):void 0,[o,c]);return{annotations:o,AnnotationView:(0,r.jsx)(n4,{annotations:o,closestAnnotationIndex:c,activeAnnotationIndex:l,player:t}),closestAnnotation:d}}(e,t,i,a),{keywords:f,KeywordView:m}=function(e,t){let n=e.item.uuid,{data:i,reload:a}=(0,ex.BH)(n5.a,{uuid:n},{clearWhenReload:!1});return(0,g.useEffect)(()=>(t.keywords.reload=a,()=>{t.keywords.reload=void 0}),[t.keywords,a]),{keywords:i,KeywordView:(0,r.jsx)(ie,{keywords:i,player:t})}}(e,t),v=(0,g.useMemo)(()=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:["book-panel","none"===c?"hidden":""].join(" "),children:["nav"===c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:(0,j.t)("nav")}),u]}),"annotation"===c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:(0,j.t)("annotation")}),p]}),"keyword"===c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:(0,j.t)("keyword")}),m]})]}),(0,r.jsx)("div",{className:["book-panel-overlay","none"===c?"hidden":""].join(" "),onClick:()=>d("none")})]}),[p,m,u,d,c]);return(0,g.useMemo)(()=>({annotations:h,keywords:f,setViewPanelType:d,BookPanelView:v}),[h,f,d,v])}(o,t,i,s,a),{voice:p}=e_(o.item),[f]=eE(),[m]=eA(),[v]=eR(),[y]=eN(),[x]=eT(),[w]=eZ(),[C]=eO(),[S]=eW(),[L]=eF(),[P,_]=(0,g.useState)(ew.tq),{isFirstSection:E,isLastSection:R,isFirstParagraph:N,isLastParagraph:A}=function(e,t){let{annotations:n,keywords:i,isPersonReplace:a,speechSpeed:r,voice:o,autoNextSection:s,paragraphRepeat:l,pageList:c,fontSize:d,disabledVertical:u}=t;(0,g.useEffect)(()=>{e.states.syncUIState("annotations",n)},[e,n]),(0,g.useEffect)(()=>{e.states.syncUIState("keywords",i)},[e,i]),(0,g.useEffect)(()=>{e.states.syncUIState("isPersonReplace",a)},[e,a]),(0,g.useEffect)(()=>{e.states.syncUIState("speechSpeed",r)},[e,r]),(0,g.useEffect)(()=>{e.states.syncUIState("voice",o)},[e,o]),(0,g.useEffect)(()=>{e.states.syncUIState("autoNextSection",s)},[e,s]),(0,g.useEffect)(()=>{e.states.syncUIState("paragraphRepeat",l)},[e,l]),(0,g.useEffect)(()=>{e.states.syncUIState("pageList",c)},[e,c]),(0,g.useEffect)(()=>{e.states.syncUIState("fontSize",d)},[e,d]),(0,g.useEffect)(()=>{e.states.syncUIState("disabledVertical",u)},[e,u]);let h=(0,g.useMemo)(()=>e.isFirstSection,[e.isFirstSection]),p=(0,g.useMemo)(()=>e.isLastSection,[e.isLastSection]),f=(0,g.useMemo)(()=>e.isFirstParagraph,[e.isFirstParagraph]);return{isFirstSection:h,isLastSection:p,isFirstParagraph:f,isLastParagraph:(0,g.useMemo)(()=>e.isLastParagraph,[e.isLastParagraph])}}(t,{annotations:c,keywords:d,autoNextSection:f,isPersonReplace:m,speechSpeed:x,voice:p,paragraphRepeat:w,pageList:C,fontSize:S,disabledVertical:L}),T=(0,g.useMemo)(()=>{let e=[(0,r.jsx)(ii,{hotkey:"t",description:(0,j.t)("nav"),onClick:()=>{u(e=>"nav"===e?"none":"nav")},children:(0,r.jsx)(F,{icon:B.lCn})},"nav"),c&&c.length>0?(0,r.jsx)(ii,{hotkey:"m",description:(0,j.t)("annotation"),onClick:()=>{u(e=>"annotation"===e?"none":"annotation")},children:(0,r.jsx)(F,{icon:B.ZWV})},"annotations"):null,(0,r.jsx)(ii,{description:(0,j.t)("hotkey.annotationToggle"),hotkey:"b",onClick:()=>{t.annotations.toggle(s,a??null)},children:(0,r.jsx)(F,{icon:B.xVw})},"annotation"),d&&d.length>0?(0,r.jsx)(ii,{description:(0,j.t)("keyword"),hotkey:"M",onClick:()=>{u(e=>"keyword"===e?"none":"keyword")},children:(0,r.jsx)(F,{icon:B.nfZ})},"keywords"):null,(null==a?void 0:a.selectedText)?(0,r.jsx)(ii,{description:(0,j.t)("hotkey.keywordAdd"),hotkey:"B",onClick:()=>{t.keywords.add({pos:s,keyword:a.selectedText})},children:(0,r.jsx)(F,{icon:B.Elr})},"keyword"):null];return!P&&e.push((0,r.jsx)(ii,{hotkey:"shift + ←",description:(0,j.t)("hotkey.prevSection"),disabled:E,onClick:()=>{t.prevSection().catch(console.error)},children:(0,r.jsx)(F,{icon:B.x$5})},"prev-section"),(0,r.jsx)(ii,{hotkey:"↑",description:(0,j.t)("hotkey.prevParagraph"),disabled:E&&N,onClick:()=>{t.prevParagraph().catch(console.error)},children:(0,r.jsx)(F,{icon:B.DYF})},"prev-paragraph")),e.push((0,r.jsx)(ii,{hotkey:"Space",description:(0,j.t)("hotkey.playToggle"),onClick:()=>{n?t.pause():t.start()},children:n?(0,r.jsx)(F,{icon:B.XQY}):(0,r.jsx)(F,{icon:B.zc})},"play")),!P&&e.push((0,r.jsx)(ii,{hotkey:"↓",description:(0,j.t)("hotkey.nextParagraph"),disabled:R&&A,onClick:()=>{t.nextParagraph().catch(console.error)},children:(0,r.jsx)(F,{icon:B.irl})},"next-paragraph"),(0,r.jsx)(ii,{hotkey:"shift + →",description:(0,j.t)("hotkey.nextSection"),disabled:R,onClick:()=>{t.nextSection().catch(console.error)},children:(0,r.jsx)(F,{icon:B.cZy})},"next-section")),ew.tq&&e.push((0,r.jsx)(it,{onClick:()=>{_(e=>!e)},children:P?(0,r.jsx)(F,{icon:B.K96}):(0,r.jsx)(F,{icon:B.Qbq})},"collapse")),(0,r.jsx)(b.ZP.Group,{children:e.filter(Boolean)})},[c,P,N,E,A,R,d,t,s,a,u,n]),I=(0,g.useMemo)(()=>(0,r.jsx)(ia,{player:t,started:n,stopTimerEnabled:v,stopTimerSeconds:y},"timer-remain-ui"),[t,n,v,y]),M=(0,g.useMemo)(()=>(0,r.jsx)(b.ZP,{shape:"circle",type:"text",title:(0,j.t)("tmpStore"),onClick:()=>{eY(async()=>{let e=await n_.F.action({});l(`/books/added-successful/${e.uuid}`)})},icon:(0,r.jsx)(F,{icon:B.EdJ})}),[l]),Z=(0,g.useMemo)(()=>(0,r.jsx)(r.Fragment,{children:I}),[I]),$=(0,g.useMemo)(()=>(0,r.jsx)(r.Fragment,{children:T}),[T]),O=(0,g.useMemo)(()=>(0,r.jsx)(r.Fragment,{children:o.item.isTmp&&M}),[M,o.item.isTmp]);return tV({topRight:Z,bottomLeft:$,bottomRight:O,settings:(0,g.useMemo)(()=>(0,r.jsxs)(k.Z,{direction:"vertical",children:[(0,r.jsx)(n0,{player:t}),(0,r.jsx)(ir,{}),(0,r.jsx)(io,{})]}),[t])}),{voice:p,speechSpeed:x,autoNextSection:f,isPersonReplace:m,BookPanelView:h}}({player:x,started:a,activeNavs:s,selection:p}),S=(0,g.useMemo)(()=>(0,r.jsxs)(ez,{flex:1,style:{position:"relative"},children:[c&&(0,r.jsx)("div",{style:{position:"absolute",zIndex:2,width:"100%",display:"flex",justifyContent:"center"},children:(0,r.jsx)(ec,{})}),(0,r.jsx)("iframe",{style:{padding:"0 4px"},title:"viewer",ref:i}),(0,r.jsx)(iq,{player:x,scrollPercent:u})]}),[c,u,x]);return(0,g.useEffect)(()=>{let e=()=>x.prevPage(1,!0),n=()=>x.nextPage(1,!0),i=()=>x.prevSection(),a=()=>x.nextSection(),r=()=>x.prevParagraph(),o=()=>x.nextParagraph();return m([["t",(0,j.t)("hotkey.navToggle"),()=>v(e=>"nav"===e?"none":"nav")],["m",(0,j.t)("hotkey.annotationsPanelToggle"),()=>v(e=>"annotation"===e?"none":"annotation")],["b",(0,j.t)("hotkey.annotationToggle"),()=>x.annotations.toggle(t,p??null)],[{shift:!0,key:"m"},(0,j.t)("hotkey.keywordPanelToggle"),()=>v(e=>"keyword"===e?"none":"keyword")],[{shift:!0,key:"b"},(0,j.t)("hotkey.keywordAdd"),()=>(null==p?void 0:p.selectedText)&&x.keywords.add({pos:t,keyword:p.selectedText})],["u",(0,j.t)("hotkey.goBack"),()=>y("../")],[" ",(0,j.t)("hotkey.playToggle"),()=>x.toggle()],[{shift:!0,key:"h"},(0,j.t)("hotkey.prevSection"),i],[{shift:!0,key:"l"},(0,j.t)("hotkey.nextSection"),a],[{shift:!0,key:"ArrowLeft"},(0,j.t)("hotkey.prevSection"),i],[{shift:!0,key:"ArrowRight"},(0,j.t)("hotkey.nextSection"),a],["h",(0,j.t)("hotkey.jumpPrevPage"),e],["l",(0,j.t)("hotkey.jumpNextPage"),n],["k",(0,j.t)("hotkey.prevParagraph"),r],["j",(0,j.t)("hotkey.nextParagraph"),o],["ArrowLeft",(0,j.t)("hotkey.jumpPrevPage"),e],["ArrowRight",(0,j.t)("hotkey.jumpNextPage"),n],["ArrowUp",(0,j.t)("hotkey.prevParagraph"),r],["ArrowDown",(0,j.t)("hotkey.nextParagraph"),o],["Home",(0,j.t)("hotkey.firstPage"),()=>x.gotoPage(0,!0)],["End",(0,j.t)("hotkey.lastPage"),()=>x.gotoPage(-1,!0)],["PageUp",(0,j.t)("hotkey.prevPage"),()=>x.prevPage(1,!1)],["PageDown",(0,j.t)("hotkey.nextPage"),()=>x.nextPage(1,!1)],[["g","g"],(0,j.t)("hotkey.firstParagraph"),()=>x.gotoParagraph(0)],[{shift:!0,key:"G"},(0,j.t)("hotkey.lastParagraph"),()=>x.gotoParagraph(-1)]])},[m,e,y,x,t,p,v]),(0,tU.z)(()=>{x.pause()}),{activeNavs:s,BookPanelView:C,MainContent:S}}(),a=function(){let e=(0,g.useId)(),[,t]=(0,f.KO)(eh);return(0,g.useEffect)(()=>()=>{t(t=>t.filter(t=>e!==t.id))},[e,t]),(0,g.useCallback)(n=>{t(t=>[{title:n,id:e},...t])},[e,t])}(),o=(0,g.useMemo)(()=>null==i?void 0:i.at(-1),[i]);return(0,g.useEffect)(()=>{let t=`${e.item.name}`;o&&(t=`${o.label} - ${t}`),a(t)},[e,o,a]),(0,r.jsxs)(ez,{dir:"row",className:no,children:[t,n]})}function iX(e){let{uuid:t}=e,{error:n,pos:i,setPos:a,book:o,reload:s}=iG(t),[l,c]=(0,f.KO)(na);return((0,g.useEffect)(()=>{o&&i?c({uuid:o.item.uuid,book:o,pos:i,setPos:a,reload:s}):c(null)},[o,i,s,c,a]),n)?(0,r.jsx)(eB,{title:"book"}):o&&i&&l?(0,r.jsx)(iJ,{}):(0,r.jsx)(ec,{})}function iY(){let{uuid:e}=(0,em.UO)();return e?(0,r.jsx)(iX,{uuid:e}):(0,r.jsx)(eB,{title:"book"})}function iQ(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ts,{}),(0,r.jsxs)(em.Z5,{children:[(0,r.jsx)(em.AW,{path:"/",element:(0,r.jsx)(ne,{})}),(0,r.jsx)(em.AW,{path:"/add",element:(0,r.jsx)(tt,{})}),(0,r.jsx)(em.AW,{path:"/added-successful/:uuid",element:(0,r.jsx)(eD,{})}),(0,r.jsx)(em.AW,{path:"/view/:uuid",element:(0,r.jsx)(iY,{})}),(0,r.jsx)(em.AW,{path:"*",element:(0,r.jsx)(eB,{title:"page"})})]})]})}var i0=n("7497"),i1=n("6340");function i3(e){return!!i2(e).length}function i2(e){return[...e.dataTransfer.items].filter(e=>"file"===e.kind||"string"===e.kind&&"text/uri-list"===e.type||!1)}function i6(e){let{children:t}=e,[n,i]=(0,g.useState)(0),[a,o]=(0,g.useState)(null),[d,u]=(0,g.useState)(!1),[h,p]=(0,g.useState)(!1),f=(0,em.s0)();return((0,g.useEffect)(()=>{eY(async()=>{if(a){if(!a.langCode){u(!0);return}switch(p(!0),a.type){case"file-epub":await l.Z.action({bufferBase64:a.bufferBase64,langCode:a.langCode,name:a.title,type:"epub",isTmp:!0});break;case"file-text":await l.Z.action({bufferBase64:a.bufferBase64,langCode:a.langCode,name:a.title,type:"text",isTmp:!0});break;case"url":await s.f.action({url:a.url,langCode:a.langCode,name:a.title,isTmp:!0})}p(!1),o(null),f(`/books/view/${y.n1}`)}})},[a,f]),h)?(0,r.jsx)(el,{}):(0,r.jsxs)(ez,{style:{width:"100%",height:"100%",position:"relative"},gap:0,onDragEnter:e=>{i3(e)&&i(e=>e+1)},onDragLeave:e=>{i3(e)&&i(e=>e-1)},onDragOver:e=>{(0,L.lJ)(e)},onDrop:e=>{e.preventDefault(),eY(async()=>{i(0),p(!0);try{for(let t of i2(e))if("file"===t.kind){let e=t.getAsFile();if(!e)continue;let n=await e.arrayBuffer(),i=await eG.P.read(n);if(!i)continue;let a=(0,eJ.Wx)(i.language),r=eq().extname(e.name),s=eq().basename(e.name,r),l=(0,eX.sM)(n);if(".epub"===r)return o({bufferBase64:l,title:i.title??s,type:"file-epub",langCode:a});if(".txt"===r||".text"===r)return o({bufferBase64:l,title:s,type:"file-text",langCode:a})}else if("string"===t.kind){let e=await new Promise(e=>{t.getAsString(e)});if(!(0,iy.C)(e))continue;let n=await c.z.action({url:e});return o({type:"url",url:e,title:n.title,langCode:n.lang})}}finally{p(!1)}})},children:[!!n&&(0,r.jsx)(ez,{style:{width:"100%",height:"100%",position:"absolute",justifyContent:"center",alignItems:"center",zIndex:1,backgroundColor:"var(--main-bg)"},children:(0,j.t)("prompt.dropHere")}),d&&(0,r.jsxs)("div",{style:{width:"100%",height:"100%",position:"absolute",zIndex:2,backgroundColor:"var(--main-bg)",padding:40},children:[(0,r.jsxs)(ez,{dir:"row",children:[(0,r.jsx)(e0.Z,{style:{flex:1},children:(0,j.t)("prompt.selectLanguage")}),(0,r.jsx)(b.ZP,{shape:"circle",type:"text",onClick:()=>{o(null),u(!1)},icon:(0,r.jsx)(F,{icon:B.YIN})})]}),(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("language"),name:"langCode",required:!0,children:(0,r.jsx)(e4,{onChange:e=>{a&&e&&(o({...a,langCode:e}),u(!1))}})})]}),t]})}let i4="appBar-h5IaFg",i8=e=>{let{children:t}=e,n=ef()??eu,[i]=(0,f.KO)(tH),[a,o]=(0,g.useState)(!1),s=(0,em.s0)(),[l,c]=(0,g.useState)(!1),d=(0,r.jsxs)(ez,{className:[i4,"top"].join(" "),dir:"row",style:{justifyContent:"end"},gap:4,children:[(0,r.jsxs)(ez,{dir:"row",style:{overflow:"hidden",alignItems:"center"},gap:4,children:[(0,r.jsx)(eK,{to:"/books",children:e=>(0,r.jsx)(b.ZP,{type:"link",size:"small",href:e,children:(0,r.jsx)(F,{size:"2xl",icon:B.FL8})})}),(0,r.jsx)(e0.Z,{style:{flex:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",cursor:"pointer"},title:n,onClick:()=>{c(!0)},children:n}),(0,r.jsx)(w.Z,{title:(0,j.t)("bookName"),open:l,footer:!1,onCancel:()=>c(!1),children:(0,r.jsx)(e0.Z,{children:n})})]}),(0,r.jsx)(ez,{dir:"row",style:{alignItems:"center",flex:1},gap:4,children:i.topLeft}),(0,r.jsx)(ez,{dir:"row",style:{alignItems:"center"},gap:4,children:i.topRight})]}),u=(0,r.jsxs)(ez,{className:[i4,"bottom"].join(" "),dir:"row",style:{flexWrap:"wrap",justifyContent:"end"},gap:4,children:[(0,r.jsx)(ez,{dir:"row",style:{alignItems:"center",flex:1},gap:4,children:i.bottomLeft}),(0,r.jsxs)(ez,{dir:"row",style:{alignItems:"center"},gap:4,children:[i.bottomRight,(0,r.jsxs)(ez,{dir:"row",style:{alignItems:"center"},gap:4,children:[(0,r.jsx)(b.ZP,{shape:"circle",type:"text",onClick:()=>{o(e=>!e)},icon:(0,r.jsx)(F,{icon:B.gr5})}),(0,r.jsx)(nV.Z,{placement:"right",open:a,onClose:()=>o(!1),title:(0,j.t)("setting.title"),forceRender:!0,children:(0,r.jsxs)(ez,{style:{flex:1,minWidth:300,gap:6},children:[(0,r.jsxs)(ez,{style:{flex:1,gap:6},children:[i.settings,(0,r.jsx)(nH,{})]}),(0,r.jsx)(ez,{children:"server"===i1.O.appMode&&(0,r.jsx)(nI,{children:(0,r.jsx)(b.ZP,{type:"primary",block:!0,onClick:()=>{i0.Z.action().then(()=>{s("/")}).catch(console.error)},children:(0,j.t)("logout")})})})]})})]})]})]});return(0,r.jsx)(i6,{children:(0,r.jsxs)(ez,{style:{width:"100%",height:"100%",alignContent:"space-around",justifyContent:"space-around"},children:[d,(0,r.jsx)("div",{style:{flex:1,padding:8,overflow:"hidden",overflowY:"auto"},children:t}),u]})})};var i9=n("6107");function i5(){let e=(0,em.s0)(),[t,n]=(0,g.useState)(),{data:i}=(0,ex.BH)(ey.O,null),[a]=eU.Z.useForm();return(0,g.useEffect)(()=>{i&&i.info&&e("/")},[e,i]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{style:{maxWidth:300,margin:"50px auto 0"},children:[(0,r.jsx)("h2",{children:"Auditory Reader"}),(0,r.jsx)("h4",{children:(0,j.t)("login")}),(0,r.jsxs)(eU.Z,{form:a,initialValues:{account:"",password:""},onFinish:t=>{i9.t.action(t).then(async t=>{t.ok?e("/"):n((0,j.t)("error.login"))}).catch(console.error)},children:[(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("account"),name:"account",rules:[{required:!0}],children:(0,r.jsx)(eH.Z,{placeholder:(0,j.t)("prompt.inputAccount")})}),(0,r.jsx)(eU.Z.Item,{label:(0,j.t)("password"),name:"password",rules:[{required:!0}],validateStatus:t?"error":void 0,help:t,children:(0,r.jsx)(eH.Z,{type:"password",placeholder:(0,j.t)("prompt.inputPassword")})}),(0,r.jsx)(eU.Z.Item,{children:(0,r.jsx)(b.ZP,{type:"primary",block:!0,htmlType:"submit",children:(0,j.t)("submit")})})]})]})})}function i7(){let{data:e}=(0,ex.BH)(ey.O,null),t=(0,em.s0)();return(0,g.useEffect)(()=>{e&&!e.info&&t("/login")},[t,e]),(0,r.jsx)(i8,{children:(0,r.jsx)(iQ,{})})}function ae(){let[,e]=eT(),[,t]=eW(),{addHotkeys:n}=M(),{openHint:i}=function(){let[,e]=(0,f.KO)(q),t=(0,g.useCallback)(function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};clearTimeout(a);let i=n.timeout??3;e(t),a=setTimeout(()=>{e(null)},1e3*i)},[e]);return(0,g.useMemo)(()=>({openHint:t}),[t])}();return(0,g.useEffect)(()=>n([["[",(0,j.t)("hotkey.speedDown"),()=>e(e=>{let t=(10*e-1)/10;return i(`${(0,j.t)("speed")}: ${t}`),t})],["]",(0,j.t)("hotkey.speedUp"),()=>e(e=>{let t=(10*e+1)/10;return i(`${(0,j.t)("speed")}: ${t}`),t})],["-",(0,j.t)("hotkey.fontSizeDown"),()=>t(e=>{let t=e-1;return i(`${(0,j.t)("fontSize")}: ${t}`),t})],["=",(0,j.t)("hotkey.fontSizeUp"),()=>t(e=>{let t=e+1;return i(`${(0,j.t)("fontSize")}: ${t}`),t})],["r",(0,j.t)("hotkey.reload"),()=>{location.reload()}]]),[n,i,t,e]),(0,r.jsxs)(em.Z5,{children:[(0,r.jsx)(em.AW,{path:"/login",element:(0,r.jsx)(i5,{})}),(0,r.jsx)(em.AW,{path:"/books/*",element:(0,r.jsx)(i7,{})}),(0,r.jsx)(em.AW,{path:"/",element:(0,r.jsx)(em.Fg,{to:"/books"})}),(0,r.jsx)(em.AW,{path:"*",element:(0,r.jsx)(i8,{children:(0,r.jsx)(eB,{title:"page"})})})]})}function at(){return(0,r.jsx)(ev.UT,{children:(0,r.jsx)(ae,{})})}async function an(){if("serviceWorker"in navigator)for(let e of(await navigator.serviceWorker.getRegistrations()))await e.unregister()}async function ai(){if("server"===i1.O.appMode)return await an(),"successful";if(!("serviceWorker"in navigator))return console.log("service-worker: unsupported"),"unsupported";await an();let e=i1.O.appPublicRoot,t=await navigator.serviceWorker.register(new URL(n.p+n.u("177"),n.b),Object.assign({},{scope:e},{type:void 0}));return(await navigator.serviceWorker.ready,t.active)?(console.log("service-worker: registered"),"successful"):"failed"}function aa(){var e;let t=np(),[n,i]=(0,g.useState)(!1);return(0,g.useEffect)(()=>{ai().then(e=>{"unsupported"===e?i("Service worker is unsupported"):"failed"===e?i("Service worker load failed"):i(!0)}).catch(e=>{i("Service worker load failed"),console.error(e)})},[]),(0,g.useEffect)(()=>{"dark"===t?document.documentElement.classList.add(y.JK):document.documentElement.classList.remove(y.JK)},[t]),e=ix,(0,ed.n)(()=>{let t=document.createElement("style");t.innerHTML=e;let n=document.head.querySelector("title");n&&n.nextSibling?document.head.insertBefore(t,n.nextSibling):document.head.prepend(t)}),(0,r.jsxs)(r.Fragment,{children:[!0===n&&(0,r.jsx)(at,{}),!1===n&&(0,r.jsx)(el,{}),"string"==typeof n&&(0,r.jsx)(p.Z,{type:"error",message:n})]})}function ar(){return(0,r.jsx)(nf,{children:(0,r.jsxs)(m.W,{backend:v.PD,children:[(0,r.jsx)(aa,{}),(0,r.jsx)(J.JB,{}),(0,r.jsx)(J.x1,{}),(0,r.jsx)(G,{}),(0,r.jsx)(eo,{}),(0,r.jsx)(H,{}),(0,r.jsx)(eg,{}),(0,r.jsx)($,{})]})})}j.ZP.init({resources:{en:{translation:{setting:{title:"Settings",autoNextSection:"Auto Next Section",timer:"Timer (Minute)",personReplace:"中文人称替换",speed:"$t(speed)",userColorScheme:"Color Scheme",paragraphRepeat:"Paragraph Repeat",disabledVertical:"Disable Vertical Direction",pageList:"Split Page",pageListType:{none:"None",auto:"Auto",single:"Single",double:"Double"},fontSize:"Font Size"},hotkey:{title:"Hotkeys",escape:"Quit / Cancel",ok:"Ok",speedUp:"Increase speed",speedDown:"Decrease speed",fontSizeUp:"Increase font size",fontSizeDown:"Decrease font size",reload:"Reload",helper:"Show the hotkeys",speakBookName:"Speak selected book name",playToggle:"Play / Pause",navToggle:"Toggle table contents panel",prevNav:"Select previous nav",nextNav:"Select next nav",gotoNav:"Go to selected nav",speakNav:"Speak selected nav",annotationsPanelToggle:"Toggle annotations panel",annotationToggle:"Add / Remove annotation for current paragraph",annotationNote:"Note current annotation",annotationRemoveSelected:"Remove selected annotation",prevAnnotation:"Select previous annotation",nextAnnotation:"Select next annotation",gotoAnnotation:"Go to selected annotation",speakAnnotation:"Speak selected annotation",keywordPanelToggle:"Toggle keywords panel",keywordAdd:"Add current selected keyword",keywordNote:"Note current keyword",keywordRemoveSelected:"Remove selected keyword",prevKeyword:"Select previous keyword",nextKeyword:"Select next keyword",gotoKeyword:"Go to selected keyword",speakKeyword:"Speak selected keyword",goBack:"Go back books index",prevSection:"Go to previous book section",nextSection:"Go to next book section",firstPage:"Scroll to first book page",lastPage:"Scroll to last book page",jumpPrevPage:"Go to previous book page",jumpNextPage:"Go to next book page",prevPage:"Scroll to previous book page",nextPage:"Scroll to next book page",firstParagraph:"Go to first paragraph",lastParagraph:"Go to last paragraph",prevParagraph:"Go to previous paragraph",nextParagraph:"Go to next paragraph",prevSearchResult:"Go to previous search result",nextSearchResult:"Go to next search result",gotoSearchResult:"Go to selected search result",goPrev:"Go to previous",goNext:"Go to next",goTop:"Go to the top",goBottom:"Move selection to bottom",goPagePrev:"Go to previous page",goPageNext:"Go to next page",goPageFirst:"Go to first page",goPageLast:"Go to last page",goMovePrev:"Move selection to previous",goMoveNext:"Move selection to next",goMoveTop:"Move selection to top",listArchive:"Toggle display of list archived books",listFavorite:"Toggle display of list favorited books",archive:"Toggle archive",favorite:"Toggle favorite",search:"Focus to search input",sortOrder:"Select sort order",edit:"Edit current selection",select:"Toggle select",selectShift:"Mark from last select to current as selected",selectAll:"Toggle select all",open:"Open current selection",editBook:"Edit book",remove:"Remove current selection",pinchUp:"Move up",pinchDown:"Move down",pinchLeft:"Move left",pinchRight:"Move right",pinchZoomOut:"Zoom out",pinchZoomIn:"Zoom in",pinchReset:"Reset zoom"},confirm:{ok:"Ok",cancel:"Cancel",openLink:"$t(open) $t(link)?"},desc:{bookAddedSuccessful:"Successfully added a new book",annotationUpdated:"Updated a $t(annotation)",annotationDeleted:"Deleted a $t(annotation)",annotationNoSupported:"No support $t(annotation) type",annotationsEmpty:"$t(annotation)s empty",keywordUpdated:"Updated a $t(keyword)",keywordDeleted:"Deleted a $t(keyword)",keywordNoSupported:"No support $t(keyword) type",keywordsEmpty:"$t(keywords) empty",navEmpty:"$t(nav) empty"},prompt:{inputBookName:"Please input $t(bookName).",selectLanguage:"Please select the $t(language).",inputAccount:"Please input your $t(account).",inputPassword:"Please input your $t(password).",dropHere:"drop .epub file、.txt file、text or URL to here.",dropHereToRemove:"Drop here to remove it.",annotationRemoveConfirm:"Remove this $t(annotation) with $t(note)?",keywordRemoveConfirm:"Remove this $t(keyword) with $t(note)?",uploadBook:"Support .epub and .txt.",noBooks:"No books here, Add your first book.",noSearchMatches:"No search matches"},sortOrder:{label:"Sort order",item:{default:"Default",reverse:"Reverse",name:"Name",nameReverse:"Name reverse"}},error:{login:"$t(account) or $t(password) error"},title:"Title",note:"Note",speed:"Speed",fontSize:"Font Size",view:"View",account:"Account",password:"Password",login:"Login",logout:"Logout",submit:"Submit",select:"Select",add:"Add",tmpStore:"Store temporary file",top:"Top",edit:"Edit",editBook:"Edit book",remove:"Remove",update:"Update",export:"Export",bookName:"Book name",favorite:"Favorite",archive:"Archive",unarchive:"Unarchive",search:"Search",cover:"Cover",nav:"Table contents",annotation:"Annotation",keyword:"Keyword",alias:"Alias",open:"open",url:"URL",extractUrlInfo:"Extract URL info",bookContent:"Book content",language:"Language",empty:"Empty",file:"File",text:"Text",system:"System",dark:"Dark",light:"Light",cancel:"Cancel",all:"All"}},zh:{translation:{setting:{title:"设置",autoNextSection:"自动下一章节",timer:"计时器 (分钟)",personReplace:"中文人称替换",speed:"$t(speed)",userColorScheme:"颜色主题",paragraphRepeat:"段落重复",disabledVertical:"禁用垂直方向",pageList:"分页",pageListType:{none:"无",auto:"自动",single:"单页",double:"双页"},fontSize:"字体大小"},hotkey:{title:"快捷键",escape:"退出 / 取消",ok:"确定",speedUp:"提高速度",speedDown:"降低速度",fontSizeUp:"提高字体大小",fontSizeDown:"降低字体大小",reload:"刷新页面",helper:"显示快捷键",speakBookName:"朗读选择的书名",playToggle:"播放 / 暂停",navToggle:"开关显示导航",prevNav:"选择上一个导航",nextNav:"选择下一个导航",gotoNav:"跳转到选择的导航",speakNav:"朗读选择的导航",annotationsPanelToggle:"开关显示注解",annotationToggle:"添加或删除当前段落的注解",annotationNote:"添加当前段落的注解的备注",annotationRemoveSelected:"删除选择的注解",prevAnnotation:"选择上一个注解",nextAnnotation:"选择下一个注解",gotoAnnotation:"跳转到选择的注解",speakAnnotation:"朗读选择的注解",keywordPanelToggle:"开关显示关键字",keywordAdd:"添加当前选择关键字",keywordNote:"添加当前关键字的备注",keywordRemoveSelected:"删除选择的关键字",prevKeyword:"选择上一个关键字",nextKeyword:"选择下一个关键字",gotoKeyword:"跳转到选择的关键字",speakKeyword:"朗读选择的关键字",goBack:"回到书本目录",prevSection:"跳到本书上一部份",nextSection:"跳到本书下一部份",firstPage:"滚动到本书第一页",lastPage:"滚动到本书最后一页",jumpPrevPage:"跳到本书上一页面",jumpNextPage:"跳到本书下一页面",prevPage:"滚动到本书上一页面",nextPage:"滚动到本书下一页面",firstParagraph:"跳到本书第一段落",lastParagraph:"跳到本书最后一段落",prevParagraph:"跳到本书上一段落",nextParagraph:"跳到本书下一段落",prevSearchResult:"选择上一个搜索结果",nextSearchResult:"选择下一个搜索结果",gotoSearchResult:"跳转到选择的搜索结果",goPrev:"去到上一个",goNext:"去到下一个",goTop:"去到顶部",goBottom:"去到底部",goPagePrev:"去到上一页面",goPageNext:"去到下一页面",goPageFirst:"去到第一页",goPageLast:"去到最后一页",goMovePrev:"挪到上一个",goMoveNext:"挪到下一个",goMoveTop:"挪到顶部",listArchive:"开关显示存档列表",listFavorite:"开关显示喜欢列表",archive:"开关存档",favorite:"开关喜欢",search:"聚焦到搜索输入框",sortOrder:"选择排序",edit:"编辑当前选择",select:"开关选择",selectShift:"把最后一次选择至当位置的标记为选择",selectAll:"开关选择全部",open:"打开当前选择",editBook:"编辑本书",remove:"删除当前选择",pinchUp:"上移",pinchDown:"下移",pinchLeft:"左移",pinchRight:"右移",pinchZoomOut:"缩小",pinchZoomIn:"放大",pinchReset:"重置"},confirm:{ok:"确定",cancel:"取消",openLink:"$t(open)$t(link)?"},desc:{bookAddedSuccessful:"成功添加了一本新书",annotationUpdated:"更新了一个$t(annotation)",annotationDeleted:"删除了一个$t(annotation)",annotationNoSupported:"不支持的$t(annotation)类型",annotationsEmpty:"$t(annotation)为空",keywordUpdated:"更新了一个$t(keyword)",keywordDeleted:"删除了一个$t(keyword)",keywordNoSupported:"No support $t(keyword) type",keywordsEmpty:"$t(keyword)为空",navEmpty:"$t(nav)为空"},prompt:{inputBookName:"请输入$t(bookName)",selectLanguage:"请选择$t(language)",inputAccount:"请输入$t(account)",inputPassword:"请输入$t(password)",dropHere:"拖动 .epub 文件、.txt 文件、文本或 URL 到这里。",dropHereToRemove:"拖放到这里删除。",annotationRemoveConfirm:"删除此$t(annotation)和$t(note)吗?",keywordRemoveConfirm:"删除此$t(keyword)吗?",uploadBook:"支持 .epub 和 .txt",noBooks:"这里没有书籍，添加你的第一本书吧。",noSearchMatches:"没有找到匹配项"},sortOrder:{label:"排序",item:{default:"默认",reverse:"反序",name:"名称",nameReverse:"名称反序"}},error:{login:"$t(account)或$t(password)错误"},title:"标题",note:"备注",speed:"速度",fontSize:"字体大小",view:"浏览",account:"帐号",password:"密码",login:"登录",logout:"登出",submit:"提交",select:"选择",add:"添加",tmpStore:"存储临时文件",top:"置顶",edit:"编辑",editBook:"编辑本书",remove:"删除",update:"更新",export:"导出",bookName:"书名",favorite:"喜欢",archive:"存档",unarchive:"取消存档",search:"搜索",cover:"封面",nav:"导航",annotation:"注解",keyword:"关键词",alias:"别名",open:"打开",url:"URL",extractUrlInfo:"提取URL信息",bookContent:"文本内容",language:"语言",empty:"空",file:"文件",text:"文本",system:"系统",dark:"暗色",light:"亮色",cancel:"取消",all:"全部"}}},lng:n.g.navigator.languages.at(0)??"en"}).catch(console.error),o.createRoot(document.getElementById("root")).render((0,r.jsx)(function(){return(0,r.jsx)(f.zt,{store:E.c,children:(0,r.jsx)(ar,{})})},{}))},2854:function(e,t,n){n.d(t,{c:function(){return i}});let i=(0,n(2743).MT)()}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,n),r.exports}n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(i,a){if(1&a&&(i=this(i)),8&a||"object"==typeof i&&i&&(4&a&&i.__esModule||16&a&&"function"==typeof i.then))return i;var r=Object.create(null);n.r(r);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&a&&i;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(function(e){o[e]=function(){return i[e]}});return o.default=function(){return i},n.d(r,o),r}})(),n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.u=function(e){return""+e+".ba5c7ed9.js"},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];n.O=function(t,i,a,r){if(i){r=r||0;for(var o=e.length;o>0&&e[o-1][2]>r;o--)e[o]=e[o-1];e[o]=[i,a,r];return}for(var s=1/0,o=0;o<e.length;o++){for(var i=e[o][0],a=e[o][1],r=e[o][2],l=!0,c=0;c<i.length;c++)(!1&r||s>=r)&&Object.keys(n.O).every(function(e){return n.O[e](i[c])})?i.splice(c--,1):(l=!1,r<s&&(s=r));if(l){e.splice(o--,1);var d=a();void 0!==d&&(t=d)}}return t}})(),n.p="/auditory-reader/",n.rv=function(){return"1.0.8"},(()=>{n.b=document.baseURI||self.location.href;var e={980:0};n.O.j=function(t){return 0===e[t]};var t=function(t,i){var a=i[0],r=i[1],o=i[2],s,l,c=0;if(a.some(function(t){return 0!==e[t]})){for(s in r)n.o(r,s)&&(n.m[s]=r[s]);if(o)var d=o(n)}for(t&&t(i);c<a.length;c++)l=a[c],n.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return n.O(d)},i=self.webpackChunkauditory_reader=self.webpackChunkauditory_reader||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),n.ruid="bundler=rspack@1.0.8";var i=n.O(void 0,["361","118","233","869","617"],function(){return n("9860")});i=n.O(i)})();