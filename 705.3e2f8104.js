(()=>{"use strict";var e,t,a,n,r,o,i,s={4150(e,t,a){a.d(t,{s:()=>k});var n=a(9511),r=a(5129),o=a(547),i=a(1454),s=a(5555),d=a.n(s),c=a(9001),l=a.n(c),u=a(8825),m=a(5157);function*h(e,t,a){let[n,...r]=t;if(!n){if(a)for(let t of e.querySelectorAll(a))yield t;else yield e;return}for(let t of e.children)("*"===n||t.tagName.toLowerCase()===n.toLowerCase())&&(yield*h(t,r,a))}var f=new WeakMap,p=new WeakMap,g=new WeakMap,v=new WeakMap,w=new WeakMap,y=new WeakMap,b=new WeakMap,_=new WeakMap;class k{static async getRootPath(e){var t;let a=await e.htmlDom("META-INF/container.xml");if(!a)return void console.error("Parse META-INF/container.xml error");let n=null==(t=a.querySelector("rootfile"))?void 0:t.getAttribute("full-path");return n?d().join("/",n):void console.error("rootfile full-path not found")}static async read(e){let t=await l().loadAsync(e),a=new m.PD(t),n=await this.getRootPath(a);if(!n)return void console.error(`epub root-path(${n}) not found`);let r=await a.xmlDom(n);return r?new k(t,a,r,d().dirname(n)):void console.error("epub root document not found")}get version(){if(!(0,n._)(this,f)){let e=this.rootPkg.getAttribute("version")??"2.0";(0,o._)(this,f,parseFloat(e)>=3?3:2)}return(0,n._)(this,f)}get title(){if(!(0,n._)(this,p)){var e,t;let a=null==(e=this.rootPkg.findDescendant("metadata"))?void 0:e.findDescendant("dc:title");(0,o._)(this,p,(null==a||null==(t=a.text())?void 0:t.trim())??null)}return(0,n._)(this,p)}get language(){if(!(0,n._)(this,g)){var e,t;let a=null==(e=this.rootPkg.findDescendant("metadata"))?void 0:e.findDescendant("dc:language");(0,o._)(this,g,(null==a||null==(t=a.text())?void 0:t.trim())??null)}return(0,n._)(this,g)}get manifestItems(){if(!(0,n._)(this,v)){var e;let t=(null==(e=this.rootPkg.findDescendant("manifest"))?void 0:e.childrenFilter("item"))??[];(0,o._)(this,v,t.map(e=>({id:e.getAttribute("id"),href:d().join(this.rootDir,e.getAttribute("href")),mediaType:e.getAttribute("media-type"),properties:e.getAttribute("properties")??void 0})))}return(0,n._)(this,v)}get spine(){if(!(0,n._)(this,w)&&((0,o._)(this,w,this.rootPkg.findDescendant("spine")??void 0),!(0,n._)(this,w)))throw Error("spine not found");return(0,n._)(this,w)}get spineItems(){return(0,n._)(this,y)||(0,o._)(this,y,(0,u.oE)([...this.spine.childrenFilter("itemref")].map(e=>{let t=e.getAttribute("idref"),a=this.manifestItems.find(e=>e.id===t);if(a)return{manifest:a,idref:t,linear:e.getAttribute("linear")}}))),(0,n._)(this,y)}get spines(){return(0,n._)(this,b)||(0,o._)(this,b,this.spineItems.map(e=>({href:e.manifest.href,id:e.idref}))),(0,n._)(this,b)}async file(e){let t=await this.xmlLoader.file(e);if(!t)return;let a=await t.arrayBuffer(),n=e.startsWith("/")?e:`/${e}`,r=this.manifestItems.find(e=>e.href==n);return{buffer:a,mediaType:null==r?void 0:r.mediaType}}async cover(){var e;let t=null==(e=this.rootPkg.findDescendant("metadata"))?void 0:e.findDescendants("meta").find(e=>"cover"===e.getAttribute("name"));if(!t)return;let a=t.getAttribute("content");if(!a)return;let n=this.manifestItems.find(e=>e.id===a);if(!(null==n?void 0:n.href))return;let r=await this.xmlLoader.file(n.href);if(r)return{buffer:await r.arrayBuffer(),mediaType:n.mediaType}}async content(e){return this.xmlLoader.content(e)}async xmlDom(e){return this.xmlLoader.xmlDom(e)}async htmlDom(e){return this.xmlLoader.htmlDom(e)}dirBySpineIndex(e){let t=this.spineItems[e];if(t)return d().dirname(t.manifest.href)}getSpineIndexByHref(e){let t=this.spineItems.findIndex(t=>t.manifest.href===e);if(-1!==t)return t}async loadNav3(){let e=this.manifestItems.find(e=>"nav"===e.properties);if(!e)return this.loadNav2();let t=await this.htmlDom(e.href),a=d().dirname(e.href);if(!t)return[];let n=t.querySelector('nav[epub\\:type="toc"]>ol');return n?this.parseNav3(n,a):[]}parseNav3(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,u.oE)(Array.from(h(e,["li"])).map(e=>{let n,r,o,i,s=Array.from(e.children).find(e=>"ol"!==e.tagName.toLowerCase());if(!s)return;let c=s.textContent??"";if("a"===s.tagName.toLowerCase()){let e=s.getAttribute("href");e&&(n=d().join(t,e),[r,o]=n.split("#",2),r&&(i=this.getSpineIndexByHref(r)))}let l=h(e,["ol"],void 0).next().value??null;return{level:a,label:c,href:n,hrefBase:r,hrefAnchor:o,spineIndex:i,children:l?this.parseNav3(l,t,a+1):[]}}))}async loadNav2(){let e=this.spine.getAttribute("toc")??"ncx",t=this.manifestItems.find(t=>t.id===e);if(!t)return[];let a=await this.xmlDom(t.href),n=d().dirname(t.href);if(!a)return[];let r=a.findDescendant("navMap");return r?this.parseNav2(r,n):[]}parseNav2(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,u.oE)(e.childrenFilter("navPoint").map(e=>{var n,r,o;let i,s,c,l,u=null==(r=e.findChild("navLabel"))||null==(n=r.findChild("text"))?void 0:n.text();if(!u)return;let m=null==(o=e.findChild("content"))?void 0:o.getAttribute("src");return m&&(i=d().join(t,m),[s,c]=i.split("#",2),s&&(l=this.getSpineIndexByHref(s))),{level:a,label:u,href:i,hrefBase:s,hrefAnchor:c,spineIndex:l,children:this.parseNav2(e,t,a+1)}}))}async navs(){return(0,n._)(this,_)||(this.version>=3?(0,o._)(this,_,await this.loadNav3()):(0,o._)(this,_,await this.loadNav2())),(0,n._)(this,_)}constructor(e,t,a,n){(0,i._)(this,"zip",void 0),(0,i._)(this,"xmlLoader",void 0),(0,i._)(this,"rootPkg",void 0),(0,i._)(this,"rootDir",void 0),(0,r._)(this,f,{writable:!0,value:void 0}),(0,r._)(this,p,{writable:!0,value:void 0}),(0,r._)(this,g,{writable:!0,value:void 0}),(0,r._)(this,v,{writable:!0,value:void 0}),(0,r._)(this,w,{writable:!0,value:void 0}),(0,r._)(this,y,{writable:!0,value:void 0}),(0,r._)(this,b,{writable:!0,value:void 0}),(0,r._)(this,_,{writable:!0,value:void 0}),this.zip=e,this.xmlLoader=t,this.rootPkg=a,this.rootDir=n}}},6026(e,t,a){a.d(t,{JB:()=>n,JQ:()=>o,kG:()=>r});let n="auditory-reader",r="__para_box__",o="__para_ignore__"},5165(e,t,a){a.d(t,{r:()=>s});var n=a(2895),r=a(529),o=a(4533),i=a(6026);async function s(e,t,a){let s=(0,r.Ph)(e),d=await (0,r._0)(s.doc),c=(0,n.A)(),l=new Date;return await new o.n({title:s.doc.title,date:l,htmlContent:d,lang:t,publisher:i.JB,sourceURL:a,uuid:c}).gen()}},254(e,t,a){a.d(t,{R_:()=>r}),a(758);let n=[{code:"ab",name:"Abkhazian"},{code:"aa",name:"Afar"},{code:"af",name:"Afrikaans"},{code:"ak",name:"Akan"},{code:"sq",name:"Albanian"},{code:"am",name:"Amharic"},{code:"ar",name:"Arabic"},{code:"an",name:"Aragonese"},{code:"hy",name:"Armenian"},{code:"as",name:"Assamese"},{code:"av",name:"Avaric"},{code:"ae",name:"Avestan"},{code:"ay",name:"Aymara"},{code:"az",name:"Azerbaijani"},{code:"bm",name:"Bambara"},{code:"ba",name:"Bashkir"},{code:"eu",name:"Basque"},{code:"be",name:"Belarusian"},{code:"bn",name:"Bengali (Bangla)"},{code:"bh",name:"Bihari"},{code:"bi",name:"Bislama"},{code:"bs",name:"Bosnian"},{code:"br",name:"Breton"},{code:"bg",name:"Bulgarian"},{code:"my",name:"Burmese"},{code:"ca",name:"Catalan"},{code:"ch",name:"Chamorro"},{code:"ce",name:"Chechen"},{code:"ny",name:"Chichewa, Chewa, Nyanja"},{code:"zh",name:"Chinese"},{code:"cv",name:"Chuvash"},{code:"kw",name:"Cornish"},{code:"co",name:"Corsican"},{code:"cr",name:"Cree"},{code:"hr",name:"Croatian"},{code:"cs",name:"Czech"},{code:"da",name:"Danish"},{code:"dv",name:"Divehi, Dhivehi, Maldivian"},{code:"nl",name:"Dutch"},{code:"dz",name:"Dzongkha"},{code:"en",name:"English"},{code:"eo",name:"Esperanto"},{code:"et",name:"Estonian"},{code:"ee",name:"Ewe"},{code:"fo",name:"Faroese"},{code:"fj",name:"Fijian"},{code:"fi",name:"Finnish"},{code:"fr",name:"French"},{code:"ff",name:"Fula, Fulah, Pulaar, Pular"},{code:"gl",name:"Galician"},{code:"gd",name:"Gaelic (Scottish)"},{code:"gv",name:"Gaelic (Manx)"},{code:"ka",name:"Georgian"},{code:"de",name:"German"},{code:"el",name:"Greek"},{code:"kl",name:"Greenlandic"},{code:"gn",name:"Guarani"},{code:"gu",name:"Gujarati"},{code:"ht",name:"Haitian Creole"},{code:"ha",name:"Hausa"},{code:"he",name:"Hebrew"},{code:"hz",name:"Herero"},{code:"hi",name:"Hindi"},{code:"ho",name:"Hiri Motu"},{code:"hu",name:"Hungarian"},{code:"is",name:"Icelandic"},{code:"io",name:"Ido"},{code:"ig",name:"Igbo"},{code:"id, in",name:"Indonesian"},{code:"ia",name:"Interlingua"},{code:"ie",name:"Interlingue"},{code:"iu",name:"Inuktitut"},{code:"ik",name:"Inupiak"},{code:"ga",name:"Irish"},{code:"it",name:"Italian"},{code:"ja",name:"Japanese"},{code:"jv",name:"Javanese"},{code:"kl",name:"Kalaallisut, Greenlandic"},{code:"kn",name:"Kannada"},{code:"kr",name:"Kanuri"},{code:"ks",name:"Kashmiri"},{code:"kk",name:"Kazakh"},{code:"km",name:"Khmer"},{code:"ki",name:"Kikuyu"},{code:"rw",name:"Kinyarwanda (Rwanda)"},{code:"rn",name:"Kirundi"},{code:"ky",name:"Kyrgyz"},{code:"kv",name:"Komi"},{code:"kg",name:"Kongo"},{code:"ko",name:"Korean"},{code:"ku",name:"Kurdish"},{code:"kj",name:"Kwanyama"},{code:"lo",name:"Lao"},{code:"la",name:"Latin"},{code:"lv",name:"Latvian (Lettish)"},{code:"li",name:"Limburgish ( Limburger)"},{code:"ln",name:"Lingala"},{code:"lt",name:"Lithuanian"},{code:"lu",name:"Luga-Katanga"},{code:"lg",name:"Luganda, Ganda"},{code:"lb",name:"Luxembourgish"},{code:"gv",name:"Manx"},{code:"mk",name:"Macedonian"},{code:"mg",name:"Malagasy"},{code:"ms",name:"Malay"},{code:"ml",name:"Malayalam"},{code:"mt",name:"Maltese"},{code:"mi",name:"Maori"},{code:"mr",name:"Marathi"},{code:"mh",name:"Marshallese"},{code:"mo",name:"Moldavian"},{code:"mn",name:"Mongolian"},{code:"na",name:"Nauru"},{code:"nv",name:"Navajo"},{code:"ng",name:"Ndonga"},{code:"nd",name:"Northern Ndebele"},{code:"ne",name:"Nepali"},{code:"no",name:"Norwegian"},{code:"nb",name:"Norwegian bokm\xe5l"},{code:"nn",name:"Norwegian nynorsk"},{code:"ii",name:"Nuosu"},{code:"oc",name:"Occitan"},{code:"oj",name:"Ojibwe"},{code:"cu",name:"Old Church Slavonic, Old Bulgarian"},{code:"or",name:"Oriya"},{code:"om",name:"Oromo (Afaan Oromo)"},{code:"os",name:"Ossetian"},{code:"pi",name:"PÄli"},{code:"ps",name:"Pashto, Pushto"},{code:"fa",name:"Persian (Farsi)"},{code:"pl",name:"Polish"},{code:"pt",name:"Portuguese"},{code:"pa",name:"Punjabi (Eastern)"},{code:"qu",name:"Quechua"},{code:"rm",name:"Romansh"},{code:"ro",name:"Romanian"},{code:"ru",name:"Russian"},{code:"se",name:"Sami"},{code:"sm",name:"Samoan"},{code:"sg",name:"Sango"},{code:"sa",name:"Sanskrit"},{code:"sr",name:"Serbian"},{code:"sh",name:"Serbo-Croatian"},{code:"st",name:"Sesotho"},{code:"tn",name:"Setswana"},{code:"sn",name:"Shona"},{code:"ii",name:"Sichuan Yi"},{code:"sd",name:"Sindhi"},{code:"si",name:"Sinhalese"},{code:"ss",name:"Siswati"},{code:"sk",name:"Slovak"},{code:"sl",name:"Slovenian"},{code:"so",name:"Somali"},{code:"nr",name:"Southern Ndebele"},{code:"es",name:"Spanish"},{code:"su",name:"Sundanese"},{code:"sw",name:"Swahili (Kiswahili)"},{code:"ss",name:"Swati"},{code:"sv",name:"Swedish"},{code:"tl",name:"Tagalog"},{code:"ty",name:"Tahitian"},{code:"tg",name:"Tajik"},{code:"ta",name:"Tamil"},{code:"tt",name:"Tatar"},{code:"te",name:"Telugu"},{code:"th",name:"Thai"},{code:"bo",name:"Tibetan"},{code:"ti",name:"Tigrinya"},{code:"to",name:"Tonga"},{code:"ts",name:"Tsonga"},{code:"tr",name:"Turkish"},{code:"tk",name:"Turkmen"},{code:"tw",name:"Twi"},{code:"ug",name:"Uyghur"},{code:"uk",name:"Ukrainian"},{code:"ur",name:"Urdu"},{code:"uz",name:"Uzbek"},{code:"ve",name:"Venda"},{code:"vi",name:"Vietnamese"},{code:"vo",name:"Volap\xfck"},{code:"wa",name:"Wallon"},{code:"cy",name:"Welsh"},{code:"wo",name:"Wolof"},{code:"fy",name:"Western Frisian"},{code:"xh",name:"Xhosa"},{code:"yi",name:"Yiddish"},{code:"ji",name:"Yiddish"},{code:"yo",name:"Yoruba"},{code:"za",name:"Zhuang, Chuang"},{code:"zu",name:"Zulu"}].map(e=>e.code),r=e=>{if(e&&(e.includes("-")&&(e=e.split("-")[0]),e)){if((e.includes("_")&&(e=e.split("_")[0]),e)&&(e=e.toLowerCase(),n.includes(e)))return e}}},7666(e,t,a){a.d(t,{Hb:()=>s,KT:()=>d,lZ:()=>c,wg:()=>l});var n=a(1454),r=a(5555),o=a.n(r);a(758);var i=a(9648);class s extends Error{constructor(){super()}}class d extends Error{constructor(e){super(),(0,n._)(this,"message",void 0),this.message=e}}class c extends Error{constructor(e){super(),(0,n._)(this,"data",void 0),this.data=e}}function l(e){return o().join(i._.appApiRoot,e)}},8930(e,t,a){a.d(t,{Cm:()=>i,li:()=>o});var n=a(1454),r=a(9648);class o extends Error{}class i{static fromNode(e){return new this(e,null)}static fromBrowser(){return new this(null,{account:"anonymous"})}userInfo(){return this.browserUser?this.browserUser:this.nodeSession&&this.nodeSession.user?{account:this.nodeSession.user}:void 0}async userLogin(e,t){return!!this.nodeSession&&!!r._.accounts.find(a=>a.account===e&&a.password===t)&&(this.nodeSession.user=e,this.nodeSession.save(),!0)}async userLogout(){this.nodeSession&&(this.nodeSession.user=void 0,this.nodeSession.save())}userLogined(){return!!this.userInfo()}async save(){this.nodeSession&&this.nodeSession.save()}constructor(e,t){(0,n._)(this,"nodeSession",void 0),(0,n._)(this,"browserUser",void 0),this.nodeSession=e,this.browserUser=t}}},4576(e,t,a){a.d(t,{TI:()=>r,_b:()=>o,h8:()=>i});var n=a(8825);function r(){return".epub"}function o(e){return{name:e.name,langCode:e.langCode,isFavorited:e.isFavorited,isArchived:!!e.isArchived,uuid:e.uuid,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),isTmp:e.isTmp,position:e.position??null,pageParagraphCounts:e.pageParagraphCounts??null}}function i(e){var t,a;let r,o=null;return e.position&&e.pageParagraphCounts&&(t=e.pageParagraphCounts,r=(a=e.position).section,o=((0,n.cz)(t.slice(0,r))+a.paragraph)/(0,n.cz)(t)),{name:e.name,langCode:e.langCode,isFavorited:e.isFavorited,isArchived:!!e.isArchived,uuid:e.uuid,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),isTmp:e.isTmp,position:e.position,progress:o}}a(529)},1421(e,t,a){a.d(t,{Bd:()=>r});var n=a(9738);let r="u">typeof self;r&&(0,n.A)(navigator.userAgent).any,r&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r&&navigator.userAgent.toLowerCase().includes("firefox")},8825(e,t,a){function n(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e<t?1:-1,n=[];if(a>0)for(let r=e;r<t;r+=a)n.push(r);else if(a<0)for(let r=e;r>t;r+=a)n.push(r);return n}function r(e){return e.filter(e=>!!e)}function o(e,t,a){let n=[...e.entries()],r=(e,t)=>{if("string"==typeof e&&"string"==typeof t)return e.localeCompare(t);if("number"==typeof e&&"number"==typeof t)return e-t;if("boolean"==typeof e&&"boolean"==typeof t)return Number(e)-Number(t);if(Array.isArray(e)&&Array.isArray(t)){for(let[a,n]of e.entries()){let e=t.at(a);if(void 0===e)break;let o=r(n,e);if(0!==o)return o}return 0}throw Error(`no support order by type(${typeof e} vs ${typeof t})`)};return n.sort((t,n)=>{let[o,i]=t,[s,d]=n;return r(a(i,o,e),a(d,s,e))}),"desc"===t&&n.reverse(),n.map(e=>e[1])}function i(e){return e.reduce((e,t)=>e+t,0)}a.d(t,{My:()=>o,cz:()=>i,oE:()=>r,y1:()=>n})},529(e,t,a){a.d(t,{A6:()=>h,DE:()=>function e(t){for(let a of t.childNodes)if(m(a)&&("br"===a.tagName.toLowerCase()||e(a)))return!0;return!1},N8:()=>l,Ph:()=>d,_0:()=>f,ir:()=>u,m3:()=>function e(t){let a=[],n=[];for(let r of t.childNodes)n.push(r),m(r)&&("br"===r.tagName.toLowerCase()?(a.push(n),n=[]):(n.pop(),a.push(...e(r))));return n.length>0&&a.push(n),a},nN:()=>g,vq:()=>m});var n=a(8678),r=a(9648),o=a(9105),i=a(8820);let s=Symbol("DOMView");function d(e){let t=new globalThis.JSDOM("",{pretendToBeVisual:!0}),a=new t.window.DOMParser().parseFromString(e,"text/html");return a[s]=t.window,{view:t.window,doc:a}}function c(e){var t,a;return(null==e?void 0:e.defaultView)||(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||(null==e||null==(a=e.ownerDocument)?void 0:a[s])}function l(e){let t=c(e);if(!t)throw Error("no dom view");return t}function u(e){let t=c(e);return!!t&&e instanceof t.Text}function m(e){let t=c(e);return!!t&&e instanceof t.HTMLElement}function h(e){let t=c(e);return!!t&&e instanceof t.HTMLImageElement}async function f(e,t){let a=new n.Readability(e).parse();if(!a)throw Error("parse article error");let o=d(a.content),i=o.doc;return"server"===r._.appMode&&await p(i.body,{baseURL:t}),function(e){let{view:t,doc:a}=e,n=Array.from(a.body.childNodes),r="";for(let e of n)e.nodeType===t.Node.TEXT_NODE?r+=e.textContent:r+=new t.XMLSerializer().serializeToString(e);return r}(o)}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.baseURL?new URL(t.baseURL):void 0,n=[...e.querySelectorAll("img")],r=new Headers({...t.referrer?{Referer:t.referrer??void 0}:{}});for(let e of n){let t=e.src||e.getAttribute("data-src")||e.getAttribute("data-original");if(t&&!t.startsWith("data:"))try{if(t.startsWith("//")&&a&&(t=`${a.protocol}:${t}`),!(0,i.g)(t))return;let n=await fetch(t,{headers:r}),s=n.headers.get("Content-Type"),d=await n.arrayBuffer();e.src=`data:${s};base64,${(0,o.Yi)(d)}`}catch(e){console.error(e)}}}function g(e,t){if(!e[0])throw Error("no nodes");let a=c(e[0]);if(!a)throw Error("no dom view");let n=a.document.createElement(t);for(let t of(e[0].before(n),e))n.appendChild(t);return n}},9035(e,t,a){a.d(t,{TP:()=>d});var n=a(9511),r=a(5129),o=a(547),i=a(1454),s=new WeakMap;class d{on(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={cb:e,options:{...this.defaultOptions,...t}};return(0,n._)(this,s).push(a),()=>{this.off(a)}}fire(e){for(let t of[...(0,n._)(this,s)])t.options.once&&this.off(t),Promise.resolve(t.cb(e)).catch(console.error)}off(e){let t=(0,n._)(this,s).findIndex(()=>e);-1!==t&&(0,n._)(this,s).splice(t,1)}constructor(e={}){(0,i._)(this,"defaultOptions",void 0),(0,r._)(this,s,{writable:!0,value:void 0}),this.defaultOptions=e,(0,o._)(this,s,[])}}},692(e,t,a){a.d(t,{dY:()=>n});let n=()=>new Promise(e=>{setTimeout(()=>{e()})})},8820(e,t,a){a.d(t,{g:()=>n});function n(e){try{return new URL(e),!0}catch{return!1}}},5938(e,t,a){a.d(t,{OT:()=>s});var n=a(8507),r=a(3202),o=a(697);a(758);let i=(0,n.eU)(null),s=()=>{let e=o.J.get(i);return e||r.Ay};(0,n.eU)(null)},1660(e,t,a){a(2200);var n=a(8855),r=a(7782),o=a(3281),i=a(56),s=a(9432),d=a(4121),c=a(8930);let l=new d.F("books/cover",{method:"get"}).routeLogined(async e=>{let{req:t,res:a,userInfo:n}=e,r=t.searchParams.get("uuid");if(!r)throw new c.li("uuid parameter required");let o=await s.J.book(n.account,r),i=await o.cover();if(!i)throw new c.li("cover in book not found");return i.mediaType&&a.header("Content-Type",i.mediaType.toString()),i.buffer});var u=a(4972),m=a(7848),h=a(2868),f=a(4624),p=a(2475),g=a(2895),v=a(4576),w=a(9105);let y=new d.F("books/import").routeLogined(async e=>{let{req:t,userInfo:a}=e,n=await t.body,r=(0,v._b)(n.entity);r.uuid=(0,g.A)();let o=(0,w.Ms)(n.bufferBase64);if(await s.J.list(a.account).add(r,o),n.property){let e=await s.J.entity(a.account,r.uuid);await e.writeProp(n.property)}return{ok:!0}});var b=a(2410),_=a(4138),k=a(2332),A=a(2543),S=a(3226),P=a(3867),T=a(6255),C=a(6931),x=a(7523),N=a(2409),L=a(8311),O=a(1976),D=a(5555),M=a.n(D);let j=new d.F("books/render",{method:"get",isDynamic:!0}).routeLogined(async e=>{let{req:t,res:a,userInfo:n}=e,[r,...o]=t.paths;if(!r)throw new c.li("uuid not found");let i=await s.J.book(n.account,r),d=decodeURI(M().join(...o)),l=await i.file(d);if(!l)throw new c.li("Path in book not found");let u=l.mediaType??O.contentType(M().basename(d));return u&&a.header("Content-Type",u),l.buffer});var I=a(8368),E=a(8877),B=a(9355),F=a(5397),U=a(1689),z=a(1466),R=a(5681),K=a(8240),W=a(3537);let H=[z.H,R.S,K.h,h.G,p.h,B.Q,m.K,u.k,S.l,P.K,T.n,A.u,L.I,E.z,f.u,y,x.Z,C.i,N.f,i.U,o.h,r.l,k.y,_.f,b.Z,F.N,U.T,W.U,l,j,I.O];var J=a(7666),G=a(1454);class q{static fromNode(e,t){let a=new URLSearchParams;for(let[t,n]of Object.entries(e.query))if("string"==typeof n)a.append(t,n);else if(Array.isArray(n))for(let e of n)"string"==typeof e&&a.append(t,e);return new this({searchParams:()=>a,body:()=>e.body,url:()=>e.url,session:()=>c.Cm.fromNode(e.session),paths:()=>t})}static fromBrowser(e,t){return new this({searchParams:()=>new URLSearchParams(e.url.split("?")[1]),body:async()=>await e.json(),url:()=>e.url,session:()=>c.Cm.fromBrowser(),paths:()=>t})}get searchParams(){return this.getter.searchParams()}get body(){return this.getter.body()}get url(){return this.getter.url()}get paths(){return this.getter.paths()}get session(){return this.getter.session()}constructor(e){(0,G._)(this,"getter",void 0),this.getter=e}}class ${constructor(){(0,G._)(this,"headers",{}),(0,G._)(this,"status",void 0)}}class V{static fromNode(e){return new this({header:(t,a)=>e.setHeader(t,a),status:t=>e.status(t)})}static fromBrowser(e){return new this({header:(t,a)=>e.headers[t]=a.toString(),status:t=>e.status=t})}header(e,t){return this.setter.header(e,t),this}status(e){return this.setter.status(e),this}constructor(e){(0,G._)(this,"setter",void 0),this.setter=e}}self.addEventListener("install",e=>{console.log("service-worker: installed"),e.waitUntil(self.skipWaiting())}),self.addEventListener("activate",e=>{console.log("service-worker: activate event in progress."),e.waitUntil(self.clients.claim())}),self.addEventListener("fetch",e=>{let t=e.request,a=new URL(t.url);if(a.hostname!==location.hostname||!a.pathname.startsWith((0,J.wg)("")))return;let r=H.find(e=>e.isMatch({method:t.method,pathname:a.pathname}));if(null==r?void 0:r.handler){let o=new $;e.respondWith(Promise.resolve(r.handler({req:q.fromBrowser(t,r.getDynamicPaths(a.pathname)),res:V.fromBrowser(o)})).then(e=>new Response((0,n.A)(e)?JSON.stringify(e):e,{status:o.status??200,headers:o.headers})).catch(e=>{if(e instanceof c.li)return new Response(JSON.stringify({message:e.message}),{status:400,headers:o.headers});{let t=e instanceof Error?e.message:null==e?void 0:e.toString();return console.error(e),new Response(JSON.stringify({message:t}),{status:500,headers:o.headers})}}))}})},697(e,t,a){a.d(t,{J:()=>n});let n=(0,a(8507).y$)()}},d={};function c(e){var t=d[e];if(void 0!==t)return t.exports;var a=d[e]={exports:{}};return s[e](a,a.exports,c),a.exports}c.m=s,c.x=()=>{var e=c.O(void 0,["783","551","115","718"],()=>c(1660));return c.O(e)},c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,c.t=function(a,n){if(1&n&&(a=this(a)),8&n||"object"==typeof a&&a&&(4&n&&a.__esModule||16&n&&"function"==typeof a.then))return a;var r=Object.create(null);c.r(r);var o={};e=e||[null,t({}),t([]),t(t)];for(var i=2&n&&a;("object"==typeof i||"function"==typeof i)&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach(e=>{o[e]=()=>a[e]});return o.default=()=>a,c.d(r,o),r},c.d=(e,t)=>{for(var a in t)c.o(t,a)&&!c.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},c.f={},c.e=e=>Promise.all(Object.keys(c.f).reduce((t,a)=>(c.f[a](e,t),t),[])),c.u=e=>""+("783"===e?"lib-react":e)+"."+({115:"dd10d384",551:"8216ae5d",718:"62a01a9f",783:"cd5b4325"})[e]+".js",c.miniCssF=e=>""+e+".css",c.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"u">typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a=[],c.O=(e,t,n,r)=>{if(t){r=r||0;for(var o=a.length;o>0&&a[o-1][2]>r;o--)a[o]=a[o-1];a[o]=[t,n,r];return}for(var i=1/0,o=0;o<a.length;o++){for(var[t,n,r]=a[o],s=!0,d=0;d<t.length;d++)(!1&r||i>=r)&&Object.keys(c.O).every(e=>c.O[e](t[d]))?t.splice(d--,1):(s=!1,r<i&&(i=r));if(s){a.splice(o--,1);var l=n();void 0!==l&&(e=l)}}return e},c.p="/auditory-reader/",n=c.x,c.x=()=>Promise.all(["783","551","115","718"].map(c.e,c)).then(n),r={705:1},c.f.i=(e,t)=>{r[e]||importScripts(c.p+c.u(e))},i=(o=self.webpackChunkauditory_reader=self.webpackChunkauditory_reader||[]).push.bind(o),o.push=e=>{var[t,a,n]=e;for(var o in a)c.o(a,o)&&(c.m[o]=a[o]);for(n&&n(c);t.length;)r[t.pop()]=1;i(e)},c.x()})();